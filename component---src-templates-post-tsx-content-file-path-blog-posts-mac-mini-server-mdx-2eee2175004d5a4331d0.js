"use strict";(self.webpackChunkhomepage=self.webpackChunkhomepage||[]).push([[6314],{6408:function(e,a,n){n.r(a),n.d(a,{Head:function(){return k},default:function(){return A}});var t=n(8453),s=n(6540);function l(e){const a=Object.assign({p:"p",h2:"h2",ol:"ol",li:"li",strong:"strong",a:"a",span:"span",blockquote:"blockquote",h3:"h3"},(0,t.R)(),e.components);return s.createElement(s.Fragment,null,s.createElement(a.p,null,"去年笔者拿 N100 小型主机安装 OpenWRT 系统作主路由服务器，又塞进去一些笔者自己部署的应用服务。后来 Mac Mini 4 发售了，评测得到的功耗与性能令人惊叹，最重要的是定价很不苹果，让我这个苹果小黑子也想要入手一台玩玩。"),"\n",s.createElement(a.p,null,"当然，笔者在逛 V2EX 的时候也看了大量劝退购入 Mac Mini 4 的帖子，尤其是像笔者这样只是拿来做轻量级应用服务器的用途 —— 大炮打蚊子。但是你知道的，即使并不需要，但是笔者可以拿它为自己的灵魂制造全新的刺激来充实生活。"),"\n",s.createElement(a.p,null,"时间来到 2025 年 03 月，Mac Mini 4 已经有大量现货而无需蹲点抢购了，国家补贴叠加学生补贴，在京东上花 2999 元下单入手了最低配置（但最高性价比）的版本。"),"\n",s.createElement(a.p,null,"这篇博客将记录笔者从零开始折腾 Mac Mini 4 做轻量级应用服务器的全过程，包括从原来的服务器上迁移已有 Docker 容器和应用服务的操作步骤。"),"\n",s.createElement(a.h2,null,"首次启动 Mac Mini"),"\n",s.createElement(a.p,null,"这是笔者第一次购买 Mac Mini，在首次启动主机的时候，会需要连接鼠标与键盘。由于 Mac Mini 4 上只有 Type-C 接口，所以可以提前准备拓展坞或者 Type-C 连接线。"),"\n",s.createElement(a.p,null,"如果有蓝牙鼠标和蓝牙键盘，就不需要用到这些硬件了：只需要把蓝牙鼠标和蓝牙键盘置于配对模式下，Mac Mini 就会自动配对并连接。"),"\n",s.createElement(a.h2,null,"面向服务器的 Mac Mini 配置"),"\n",s.createElement(a.p,null,"参考网上其它教程指出的细节，在“设置”里对 Mac Mini 进行配置："),"\n",s.createElement(a.ol,null,"\n",s.createElement(a.li,null,s.createElement(a.strong,null,"保持服务器运行状态"),"：在“能源”里设置“显示器关闭时，防止自动进入睡眠”和“断电后自动启动”；在“锁定屏幕”里禁用屏幕保护程序。"),"\n",s.createElement(a.li,null,s.createElement(a.strong,null,"保持用户的登录状态"),"：在“用户与群组”里设置“自动以此身份登录”，保障各种软件在主机启动后正常运行。"),"\n",s.createElement(a.li,null,s.createElement(a.strong,null,"避免系统更新自动重启"),"：在“通用 - 软件更新”里关闭自动检查、下载和安装更新的功能。"),"\n"),"\n",s.createElement(a.p,null,"这样，Mac Mini 就满足作为常时运转的服务器的基本配置需要了。"),"\n",s.createElement(a.h2,null,"基于 Rust Desk 的远程桌面连接"),"\n",s.createElement(a.p,null,"笔者目前只有局域网访问主机的需求，而且不想用包含中继服务器等增值服务在内的各类远程桌面软件，因此选用了 Github 上星标最多的开源远程桌面客户端 ",s.createElement(a.a,{href:"https://github.com/rustdesk/rustdesk"},"Rust Desk"),"。"),"\n",s.createElement(a.p,null,"不想付一分钱就想体验完整的 Rust Desk 能力的话，可以选择在本地部署 Rust Desk 的中继服务器。"),"\n",s.createElement(a.p,null,"Docker 是管理本地服务的无二之选，首先在 Mac Mini 上下载并安装 Docker Desktop。设置国内镜像仓库，在 “Settings - Docker Engine” 里添加："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token string">"https://docker-0.unsee.tech"</span><span class="token punctuation">,</span>\n    <span class="token string">"https://hub.fast360.xyz"</span><span class="token punctuation">,</span>\n    <span class="token string">"https://dockerpull.cn"</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",s.createElement(a.p,null,"不保证上述镜像仓库始终可用，如失效，可以在网上找到最新有效的地址。"),"\n",s.createElement(a.p,null,"拉取 Rust Desk 的服务端镜像 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">rustdesk/rustdesk-server</code>'}}),"，运行 hbbs 和 hbbr 容器服务："),"\n",s.createElement(a.blockquote,null,"\n",s.createElement(a.p,null,"官方文档使用“Host”网络模式来免除一个一个手动设置端口号的麻烦，但是 MacOS 系统并不支持这种网络模式。"),"\n"),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># RustDesk 的中介服务器，用于管理和协调客户端连接</span>\n<span class="token function">docker</span> run <span class="token parameter variable">--name</span> hbbs <span class="token parameter variable">-p</span> <span class="token number">21115</span>:21115 <span class="token parameter variable">-p</span> <span class="token number">21116</span>:21116 <span class="token parameter variable">-p</span> <span class="token number">21116</span>:21116/udp <span class="token parameter variable">-p</span> <span class="token number">21118</span>:21118 <span class="token parameter variable">-v</span> path/to/rustdesk/data:/root <span class="token parameter variable">-td</span> rustdesk/rustdesk-server hbbs\n<span class="token comment"># RustDesk 的中继服务器，用于在两台客户端之间进行连接中继</span>\n<span class="token function">docker</span> run <span class="token parameter variable">--name</span> hbbr <span class="token parameter variable">-p</span> <span class="token number">21117</span>:21117 <span class="token parameter variable">-p</span> <span class="token number">21119</span>:21119 <span class="token parameter variable">-v</span> path/to/rustdesk/data:/root <span class="token parameter variable">-td</span> rustdesk/rustdesk-server hbbr</code></pre></div>'}}),"\n",s.createElement(a.p,null,"获取 Rust Desk 中介服务器公钥，打印 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">path/to/rustdesk/data</code>'}})," 目录下自动生成的 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">id_ed25519.pub</code>'}})," 文件内容："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">cat</span> path/to/rustdesk/data/id_ed25519.pub</code></pre></div>'}}),"\n",s.createElement(a.p,null,"分别在主控端（笔者为 Windows）和被控端（即 Mac Mini）上安装 Rust Desk 客户端，在客户端的“设置 - 网络 - ID/中继服务器”处配置中继服务器相关内容。这里填写主路由自动为 Mac Mini 的分配的 IP 地址 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">192.168.100.239</code>'}}),"，如果在启动中继服务器容器时没有自行修改暴露的端口，那么 Rust Desk 会自动访问到对应的端口，无需单独指定端口号，同时将上一步得到公钥填写到 “Key” 里："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/4fe9c7c1ff8deecac7229bcf59ee3310/416ee/rustdesk-public-key.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 83.97435897435898%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACeElEQVR42o2UaVMbMQyGM9MPnSnk2LX3vs8chASalCQkLASY9v+0nenPfyspIRAoQz+8Y6+tfSRLsls6yOF6CVwngGFFCOMcSlkwTAumsqG086Fs24NF8vwILeWkMOwEWjnQmuWi11MIgxiO48vcMAhuvi92bhga2nLRct2AfgwExLIsXzb9KIfvU+RueLT/UpblHeaKArLJrpVlFaIok03TtMmbjU6nh65dIAxzFEWNmPe190YMUYqB3ktgScBUPtKsRt0fi9K0pNzG78oPUrKhYOJC/uUoBai8CqbDwBCT6Qyr6wZ32++YTGaUcE/WLZvS4kUH2ZSGgKLuD8YoqiHlzqNca4G22IPvx5KnLO9LdAzg9enFFTn5RpqjrM6QF8MjZfmAxoFU+uS0g56h0IrjjHK1O/L4/BKLxRohFYQNm9tHbG7uRWfjSwyGUwxHFweNznbjK2COiICW7ZPBFLP5EgnlJs1rOv4tlqsGy2VDzr4ScILBYPI87udHwCBI5Lg2HXM4YuAKSVIhiWuC3eJqscH1+g7rzVagRTlCVY8lBWV9TnoFfOoh7reyGkkRHJqPZ0Nsmi2a5hGL5Y1Am+ZBwBz5er3FzWqB+fRcgKftPVCac99DcVLKNYzzFP1JgYocsJOiHB5GLsTF5RXGkznqH7+QPfyUm3IM5B6iHHJ0LreGE9FaCE1rXPGXUtqXdsmKEaKH3/Dv/xBIvwXuun7X+V26v+1Ol9T7p76ctCVnp58/idrdHgG7x0AeWRwpb7DBe8BO19iJHHe6psx53TD1c1F2suXFYYOnKP5XbM//tfiWHCuBRc+WsugttJwPpfdS2qYaePgLLHPCjWjJ40MAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="配置 Rust Desk 客户端的中继服务器"\n        title=""\n        src="/static/4fe9c7c1ff8deecac7229bcf59ee3310/39c09/rustdesk-public-key.png"\n        srcset="/static/4fe9c7c1ff8deecac7229bcf59ee3310/680fe/rustdesk-public-key.png 156w,\n/static/4fe9c7c1ff8deecac7229bcf59ee3310/17474/rustdesk-public-key.png 312w,\n/static/4fe9c7c1ff8deecac7229bcf59ee3310/39c09/rustdesk-public-key.png 624w,\n/static/4fe9c7c1ff8deecac7229bcf59ee3310/416ee/rustdesk-public-key.png 930w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",s.createElement(a.p,null,"在主控端输入被控端的 ID 与连接密码，即可连接到远程桌面："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/0c30094d54bb69c64e9da66e64b3ff0a/947d2/connect-to-mac-mini.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC90lEQVR42h2TWW8iRxSF+yFKPHgwSy/QO4sxBoNtlmYxNGY10GA8XsAYO2MnUWbEQ5SJkrxFo/yC/OUvPTwcnVJJde5X91YJTqfB9bjL4uaG2fKJ4XRMfzql0+9RqZeZza9wm3XqFw2m/Rb5wimdrod7NaM96OO4XapOg3Kl4p+ZIOhpkU33mM8bj7/+3bLdjvn1tw1/fFkzmRf57+srf65qPD6U+HvpYGshZl6T6WbOzdJl8vRIr9vGqZWZDAcIhbzCk3vE86zOYHZNZ3xLtTPzdUeyNGV284l+f43Te8TtPqMeL0hXNmQGX0iXcrz+/sb6Q5uMrTMedBF6TYOXiyRD5wgtWSJqNXknnRE1G0SsNoF4naB+wXuttfOg0fLXLgemi5lP8Lbd8OSVSSv7bBZXCHeXSV5qFuW8jm7byHGdQDCEaicxkhlk1SQqx5E0k7hhERElJFlFt1SqjTTjcYF5wyYhBVhduQgPHYN1zSTl9zISUxFljXfvI4jxBLKW8kMO/UJZYr7HrWPEWMKXvStUrSVpNTIMT1XU0B7eZQvhY8+im41g6BL7YZFgSPIDo0QUE8VIoWg+aSLrEx4ip6rI1sluLywbZHM2dsqgYIo7Qs9tIkyKCgV5j1xe8wOjfPd9kB8CYYJRlZCoE5b0nR+IJhHZ3AV9oxfjNue1ErlKnTv/6iUzwH2/jXB6rpBKHtCbZ9ESJvs+YUSU0c0UMfVbz1SUuIGsxDgIKwR9haNxitlDVg8Lfnpb8fMwRzyyx3zYR9AqCtmuRKZtkXWKlHpZWl6a2a3DpVek0k+zeDxn0LIxxTCGGOTEkni7G3H/YcrybsCn0TGSGGK9vEXIXITJXhwQLe6jlGLo/sSPOilOBhlKozStRY75pk6tlCSpRNGiQXJ6xB/IGafNCvNRg5f+GQFRZHXrP5uzToLypU3GMci7Bbwff6H79Ir3vPG/4CWrz/ds//nKy8dnvNGA08IZ8+mI69s55+0yq+s25WIR0U6xWAz4H0dJdvKbw6BmAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="连接到 Mac Mini 远程桌面"\n        title=""\n        src="/static/0c30094d54bb69c64e9da66e64b3ff0a/39c09/connect-to-mac-mini.png"\n        srcset="/static/0c30094d54bb69c64e9da66e64b3ff0a/680fe/connect-to-mac-mini.png 156w,\n/static/0c30094d54bb69c64e9da66e64b3ff0a/17474/connect-to-mac-mini.png 312w,\n/static/0c30094d54bb69c64e9da66e64b3ff0a/39c09/connect-to-mac-mini.png 624w,\n/static/0c30094d54bb69c64e9da66e64b3ff0a/6d2da/connect-to-mac-mini.png 936w,\n/static/0c30094d54bb69c64e9da66e64b3ff0a/5a791/connect-to-mac-mini.png 1248w,\n/static/0c30094d54bb69c64e9da66e64b3ff0a/947d2/connect-to-mac-mini.png 1773w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",s.createElement(a.p,null,"在默认情况下，远程桌面将使用不可变更的 1920 * 1080 分辨率，可以使用 Better Dummy 软件为 Mac Mini 虚拟一个显示屏，就可以自定义分辨率与启用 HiDPI 功能了。"),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 381px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/40b05150b2b4c10cf88b879014d24f83/2add2/with-better-dummy.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 135.25641025641028%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEz0lEQVR42pVVS28bVRT2X0Ciok38Gj/G9nj8jjMe2zN+jh0/azuu6ySN4zR1ng4JadM2pQUqVqFFgBALED+BDQs2SKwRP4Q1XdFNpI9zrx1CRUmLpc/n+s6Zb875znfHJqP0ANu7y7i5cgOtbh1ffvU5MsUMFm92cHD0PoxaEU+ePiZ8iO7SItY2BkjnUmj3WtgabyJXyqJUM9BYbEDNqDAp+h4KtTaShTbimSpurO5Ans9DL3fQWtpEOFXG9f4Ijd4G5vQqKp0BZKVIuXVkKj0EVYNDydYxl67ANBsaIaDvQ28+hNZ4AKV8yNep2jHmFz6Afv0R1PoxR5r2E9W70FqP+FqlHL1xwiEn93BN3oZJiG3h519+A/u8ePEHXr78E//nc3Z2xuOPP/2Ka9JtmKzBIbK1I6xtn2KwdYq1nVOs7z3D+u4Ue88nGL+KIe0Ndp5hsP0ZhhRz1IEQGcFklvr45rsfcHTyNSLpdaRLu0gWd/6GSkhMo2rQ2tiFQmutcoBy5xjF5l0sdO4jro8w410hQncOz7/4HvceniKe7iNTGkIr0iQLA2jGGvKVDRSqdyaoTZCndbm5jXb/EI3uGB2KyewAs648ETpi8EcX4JIyZJce0vku8uUlssIqMkYfbjkHszMBi0uFxXkBs0PFrJDArCOBGbsChzcDu5ggDYUAUmSHKFml0V5GpdZDk+LKYAvt7iqkYBIWRwg2V+RfsJ+vnWG4JQWCGIXJYvchkSogGtdRqrRQrpInNQPvXLHiqlmERZBgdfhfA3kKP89xeaMQXEFG6MF8IoNITEXeqEDLlZAvVuD2BqkCiZ7ug81xDu8/cLFnFTyTfMolQjd0IpmbT6G/tIrVtQ3cGe2gWKriylUL3eB5I6yCCI8vCIdbYoQi4oqGUDQBo1yDlinwSlN6HoqqQfQF+A3/Tcgq9MEpylShd0KoqDpi8TS6vWU0ri/yWG92UKm3IIdiMFMXlxN66cEh0pBanrW6aLItIs2g2eqi0+3zGIoqvOXLq7sgdHunhEzDtF7gLVfrbSxUm8gVyvAHY3B5ZJ70NoQuT2DSMqugvNAg62TR69/C8PYm+ssDLPaW6D25D5X2ZywOnnwZoUcKT4ZiJQ1Ze8GwAj1rIKXlkKbBJLU8ypUGAuG5N2jo4faxO8liZB8T+wrPJcnYKa5lrrBAQ1nhQxmuj/jAzDYXb51V+XpIdF3ievMKFUVFkKbZ6twkHVvI5ks09STefc/MyZjOl0Ocwg2Tg54cznYRTRpUVQsFo8pPCmvZK4XgkyNvBSkQnWgYiKpwfvI7EqNvcXwwxs7+ET76+FNsbo8xItw9PsHa+iZKNLhSpfl60DXmkHCM3jZusoZH69EfUxHJZBrzdDqUhIY4HUXWdowiO5YRSg6G4zSkOORpPAfbD0fmuc1MNocIwWqD3e6c6EUwW508WmxOzJgFhCg5TE5gezZBfEU/K3MAM/8UJoGm5JWjXAd2zOQgA/32hzlcbj8E8hrLc5JGTHPHdOJsj3XI9l2if3JSrIIbu+MDPH7yFPfun+D4/iPsjQ+xdGtI2o0gyUxsH7/hnEyYkjGU6K0k00AE6pQRm+z0dKYD0ytIrYUiyrRK+mugShmRU5Q4LggvIHoDPMftnRzTvwDA360bFDCZkgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="使用 Better Dummy 虚拟显示屏"\n        title=""\n        src="/static/40b05150b2b4c10cf88b879014d24f83/2add2/with-better-dummy.png"\n        srcset="/static/40b05150b2b4c10cf88b879014d24f83/680fe/with-better-dummy.png 156w,\n/static/40b05150b2b4c10cf88b879014d24f83/17474/with-better-dummy.png 312w,\n/static/40b05150b2b4c10cf88b879014d24f83/2add2/with-better-dummy.png 381w"\n        sizes="(max-width: 381px) 100vw, 381px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",s.createElement(a.p,null,"最后，在 OpenWRT 的控制面板里将 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">192.168.100.239</code>'}})," 绑定为分配给 Mac Mini 的固定 IPv4 地址，以后就无需在主控端重新配置中继服务器的相关内容啦。"),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/c971a9eb6f030897f9b06de371564485/d7ba6/dhcp-static-ipv4.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 74.35897435897436%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABx0lEQVR42pVTy47UMBCcb4DDasCvOHHivF8MI1ZacRlxhSvih/gpbvxX4XLwsKOdIO2h1G3HXV0udw5rf8Tj/IClO0JJBSkllGLcoJR+FQ6ZkSCMDjHLUJZliAbWWuR5Hslfg0NUEhIhZCRblgVVVWGapgjnHLTWV0itcJRin/D5ggWMxphIygbe+7imFVJJOG0w6xzaqA2hgdJbfkPIAhZTIVUVhYOrPMqqRuVrNE2HoyvwvZzw68NXrE85loButWjnDNMni3rMbhUmUJErqwAfyazNYU2Gt1rgh5vw++M3dEuG4WxDtGjGLff9DiGvXgZ1vm5QuDI+lgl7D+HKX4oOP8fP8F0GP4RHbE1EHXLnzX1Cgh52bXttQJBU2gxvxDuI92qDCHaJLZfhYXcV0k+StoGUj5PmM1ry9/G2s8mmrekLQhZyBodhQNd1cXSYr+sa877vMY4j5nm+fuM5rini7tjQs7quryoJFlJt0zTxG5HWPEcRNwqpjONCJUVRxL+EV+VewtZQbzMZIIS4icTu2CQVBBVSSVJDZenb81u88JCd6AUPUiEPsYBK/zXL/v8v39tMHiafSHg+n3G5XHA6nWLjPcI/IWWn2MfRziIAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="为 Mac Mini 绑定静态 IPv4 地址"\n        title=""\n        src="/static/c971a9eb6f030897f9b06de371564485/39c09/dhcp-static-ipv4.png"\n        srcset="/static/c971a9eb6f030897f9b06de371564485/680fe/dhcp-static-ipv4.png 156w,\n/static/c971a9eb6f030897f9b06de371564485/17474/dhcp-static-ipv4.png 312w,\n/static/c971a9eb6f030897f9b06de371564485/39c09/dhcp-static-ipv4.png 624w,\n/static/c971a9eb6f030897f9b06de371564485/6d2da/dhcp-static-ipv4.png 936w,\n/static/c971a9eb6f030897f9b06de371564485/d7ba6/dhcp-static-ipv4.png 1107w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",s.createElement(a.p,null,"如上图所示，笔者同时将 Mac Mini 无线网卡的 MAC 地址和以太网卡的 MAC 地址绑定给 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">192.168.100.239</code>'}}),"，为之后断开 WiFi 使用网线做好了铺垫。"),"\n",s.createElement(a.h2,null,"迁移 Docker 里的容器"),"\n",s.createElement(a.h3,null,"迁移数据库"),"\n",s.createElement(a.p,null,"数据库是笔者其它应用服务的基石，首先应当迁移这些容器服务。"),"\n",s.createElement(a.p,null,"这里以 PostgreSQL 数据库为例，首先应当调用 PostgreSQL 官方提供的备份工具，备份数据库里的所有数据表："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 进入名为 postgres 的 PostgreSQL 数据库容器</span>\n<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> postgres <span class="token function">bash</span>\n<span class="token comment"># 以 postgres 的身份备份数据库里的所有数据表</span>\npg_dumpall <span class="token parameter variable">-U</span> postgres <span class="token operator">></span> /path/to/all_databases.sql\n<span class="token comment"># 退出容器</span>\n<span class="token builtin class-name">exit</span></code></pre></div>'}}),"\n",s.createElement(a.p,null,"接着，将数据表备份文件 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">all_databases.sql</code>'}})," 复制到主机上："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">cp</span> postgres:/path/to/all_databases.sql /local/path/to/all_databases.sql</code></pre></div>'}}),"\n",s.createElement(a.p,null,"然后，将主机上的数据表备份文件传输到 Mac Mini 上："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">scp</span> /local/path/to/all_databases.sql username@192.168.100.239:/Users/username/PostgreSQL/all_databases.sql</code></pre></div>'}}),"\n",s.createElement(a.p,null,"在 Mac Mini 上拉取最新版本的 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">postgres</code>'}})," 镜像，启动新的 PostgreSQL 容器："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> postgres <span class="token parameter variable">--restart</span> unless-stopped <span class="token parameter variable">-e</span> <span class="token assign-left variable">POSTGRES_PASSWORD</span><span class="token operator">=</span>SECRET_PASSWORD <span class="token parameter variable">-v</span> /Users/username/PostgreSQL/data:/var/lib/postgresql/data <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">5432</span>:5432 postgres:latest</code></pre></div>'}}),"\n",s.createElement(a.p,null,"将数据表备份文件复制到 PostgreSQL 容器里："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">cp</span> /Users/username/PostgreSQL/all_databases.sql postgres:/path/to/all_databases.sql</code></pre></div>'}}),"\n",s.createElement(a.p,null,"最后，进入到新的 PostgreSQL 容器里，还原数据表："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> postgres <span class="token function">bash</span>\npsql <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-f</span> /path/to/all_databases.sql</code></pre></div>'}}),"\n",s.createElement(a.p,null,"这样，对 PostgreSQL 数据库容器的迁移就完成了！"),"\n",s.createElement(a.p,null,"笔者基于 frpc 实现内网穿透，因此还需要在 OpenWRT 控制面板里配置 frpc 客户端，修改 PostgreSQL 数据库的内网地址，从原来主路由服务器所在的 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">192.168.100.1</code>'}}),"，改到 Mac Mini 所在的 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">192.168.100.239</code>'}}),"。这样，外网也能正常访问新的 PostgreSQL 数据库了。"),"\n",s.createElement(a.h3,null,"迁移 Minecraft 游戏服务器到 Docker 容器"),"\n",s.createElement(a.p,null,"去年笔者在主路由上部署了 Minecraft 服务器，这次决定一并迁移到 Mac Mini 里来，作为 Docker 容器继续对外提供服务。"),"\n",s.createElement(a.p,null,"打包现有的 Minecraft 数据文件，包括模组生成的文件等。对于笔者，执行了如下命令："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">tar</span> <span class="token parameter variable">-czf</span> mc-server.tar.gz banned-ips.json banned-players.json config dynmap journeymap mods ops.json server-icon.png server.properties usercache.json whitelist.json world</code></pre></div>'}}),"\n",s.createElement(a.p,null,"将打包后的文件传输到 Mac Mini 上："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">scp</span> mc-server.tar.gz username@192.168.100.239:/path/to/mc-server.tar.gz</code></pre></div>'}}),"\n",s.createElement(a.p,null,"解压到数据文件夹中："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">tar</span> <span class="token parameter variable">-zxf</span> /path/to/mc-server.tar.gz <span class="token parameter variable">-C</span> /path/to/mc-server-data</code></pre></div>'}}),"\n",s.createElement(a.p,null,"拉取最新版本的 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">itzg/minecraft-server</code>'}})," 镜像，基于它运行 Minecraft 容器："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> mc-server-fabric <span class="token parameter variable">--restart</span> unless-stopped <span class="token parameter variable">-v</span> /path/to/mc-server-data:/data <span class="token parameter variable">-e</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span>FABRIC <span class="token parameter variable">-e</span> <span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token number">1.20</span>.4 <span class="token parameter variable">-e</span> <span class="token assign-left variable">FABRIC_LOADER_VERSION</span><span class="token operator">=</span><span class="token number">0.15</span>.10 <span class="token parameter variable">-e</span> <span class="token assign-left variable">FABRIC_LAUNCHER_VERSION</span><span class="token operator">=</span><span class="token number">1.0</span>.1 <span class="token parameter variable">-e</span> <span class="token assign-left variable">EULA</span><span class="token operator">=</span>TRUE <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">25565</span>:25565 <span class="token parameter variable">-p</span> <span class="token number">8123</span>:8123 itzg/minecraft-server:latest</code></pre></div>'}}),"\n",s.createElement(a.p,null,"上面的环境变量表示，启用一个 Fabric 模组服务器，Minecraft 版本为 1.20.4，Fabric loader 版本为 0.15.10，Fabric launcher 版本为 1.0.1。笔者的 Minecraft 服务器对外提供了 Dynmap 在线地图服务，因此除了 Minecraft 主服务端口 25565 外，还对外暴露了 8123 地图服务端口。"),"\n",s.createElement(a.p,null,"这样，容器会在初始化时自动下载对应版本的 Fabric 加载器即 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">fabric-server-mc.1.20.4-loader.0.15.10-launcher.1.0.1.jar</code>'}}),"，最后像原来一样运行起来 Minecraft 服务器，完成对 Minecraft 服务器的迁移！"),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/3e3bbcedae3ea417923130d73c62ed06/ad00e/docker-minecraft-initialize.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 57.05128205128205%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB40lEQVR42o2RSVPbQBBGx4tkLNlaLVmjfQEJgzeMURUxqVSCIVUEOKTg//+UL62xikAOSQ6vuvswb3phNs9gehV4XKKoFsjKhYg8zKHbHMbEJ4L/hpm2Dy07QbGssb3eo1rUKBfXiMorGLyEFcxgugkMIadH9rsPRN5iH2CWm8JKSpi8gMUrOOEpDO8Y1jTFxDtgOiFJo984LW1tufEbrJhtsK6/4nx5iTQ/QRxn8IMIfpiCB4nAsFwMh2MMFY0YQx0ZhC5qRdVElGQF8kAB29Q7fH9+xZf7Z1RnS4QkjJIcYZQiow+mng/HmcK0JtA0HeOxBsOwYBo21QZ0vcHEQB6g3+uDra92uHt6wef9I8rTOWKSxUkB7kdC7FFM0kLkjUBRRjg6UjAaaSJX1bEQdTtddFj3o3B2vkJEHcYkaKSeF4humkfKUG0f9tDrHmjyLsUO67zB1ttP2D++4Gb/A/PlBkl2jCBMBI7rwTRt2p8iECMx9kHwJ4cOG+EtCVeXtLeSDhLTqCF1m5M4hccjSH3pnzIhvKhvcP/0Kkaer7bIi6rtMBbyNGsun4vFj2h0WRr8VcxWNPLtw0/svj3gbHEhlt8cxCdp05lF13VcDnsyhUpHkCSZupXRo/H7PUns8b3wF8vzGMVxFCn1AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="初始化 Minecraft 服务器"\n        title=""\n        src="/static/3e3bbcedae3ea417923130d73c62ed06/39c09/docker-minecraft-initialize.png"\n        srcset="/static/3e3bbcedae3ea417923130d73c62ed06/680fe/docker-minecraft-initialize.png 156w,\n/static/3e3bbcedae3ea417923130d73c62ed06/17474/docker-minecraft-initialize.png 312w,\n/static/3e3bbcedae3ea417923130d73c62ed06/39c09/docker-minecraft-initialize.png 624w,\n/static/3e3bbcedae3ea417923130d73c62ed06/6d2da/docker-minecraft-initialize.png 936w,\n/static/3e3bbcedae3ea417923130d73c62ed06/5a791/docker-minecraft-initialize.png 1248w,\n/static/3e3bbcedae3ea417923130d73c62ed06/ad00e/docker-minecraft-initialize.png 1366w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",s.createElement(a.p,null,"从刀耕火种的 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">screen</code>'}})," 后台应用，到如今的 Docker 容器服务，也算是一次小型的 Minecraft 服务端架构升级吧~"),"\n",s.createElement(a.h2,null,"开始漫长的工作"),"\n",s.createElement(a.p,null,"最初对 Mac Mini 的配置与调教依赖于 WiFi 和显示屏，在远程桌面就绪后，就可以将它移动到无线 AP 旁边，作为一台沉默的服务器开始漫长的工作啦！"),"\n",s.createElement(a.p,null,"关闭 Mac Mini 的 WiFi 功能，关闭主机，将主机移动到无线 AP 旁边，使用网线将两者连接。"),"\n",s.createElement(a.p,null,"启动 Mac Mini，主路由服务器的 DHCP 服务将会自动为 Mac Mini 分配前面笔者固定好的 IPv4 地址。"),"\n",s.createElement(a.p,null,"通过主控端 Rust Desk 访问 Mac Mini，顺利连接到远程桌面，一切搞定！"),"\n",s.createElement(a.h2,null,"写在最后"),"\n",s.createElement(a.p,null,"兜兜转转折折腾腾两天时间，终于把所有应用服务从主路由服务器上迁移到了 Mac Mini 上，可喜可贺可喜可贺！"),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/27737ec8a9661eba51a327ffc0d9dd5d/da994/docker-containers.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 48.71794871794871%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqElEQVR42nVS0Y6cMAzkC3oLgSyEhCQQFnaX3kmt2j63//9P07E5VVepfbBMiD3jGafajy+I5UA93GDcisYG1IyLjbh0Hpd2/G+8SJi//1Uh3zGmDdavaN2CzmW0w4zabQRNLHL/BKtJZhg6wAfiqp0KwvJA7xeYazyZDUHMwHD6/TGUgNn4GW47kKiu7eP7HQFtWGHHBQ3BTJ+YJ0qe/pzlrnUzmxInT/x3Nn+S6EbNem4GzVXvC9prgptubMjMK1y8KZhnDnnDEIr6ascZnvY4niU6go9xxZU2Se2V95Uw1kPUwqYLiPOOsr+qfBsPdOGJ1t91QTUnEmtyeaJsr/otZKk8tOcEpIxa/CCDbG2a75hvB82OaDz9yd/RbT9hwqHeCYDUJIJaTiYDhbwjcg/iZSXSLi6dUihX2KRYfDSe0+VvsPsvmOmzLkRqAlXk9VDAjgMJoPQImU74QsDEAikW9rK/nUuZ3gj4Fe38g7YU3aIASPNCyVafWOI7fuo/mbaSd1ePGfIepXikdLlse8oR/zQeSiBvruPipnlXJfZ9+zKhDCP3vwGmKghn+hdOeAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Docker 容器服务列表"\n        title=""\n        src="/static/27737ec8a9661eba51a327ffc0d9dd5d/39c09/docker-containers.png"\n        srcset="/static/27737ec8a9661eba51a327ffc0d9dd5d/680fe/docker-containers.png 156w,\n/static/27737ec8a9661eba51a327ffc0d9dd5d/17474/docker-containers.png 312w,\n/static/27737ec8a9661eba51a327ffc0d9dd5d/39c09/docker-containers.png 624w,\n/static/27737ec8a9661eba51a327ffc0d9dd5d/6d2da/docker-containers.png 936w,\n/static/27737ec8a9661eba51a327ffc0d9dd5d/5a791/docker-containers.png 1248w,\n/static/27737ec8a9661eba51a327ffc0d9dd5d/da994/docker-containers.png 1487w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",s.createElement(a.p,null,"过程总体来说是相当顺利的，没有遇到什么疑难杂症或不兼容的问题，迁移到 Docker 里的应用服务也都一次正常跑通，不由让我对 Docker 依赖愈陷愈深。"),"\n",s.createElement(a.p,null,"其实笔者购买 Mac Mini 4 的另一个初衷是拿它做旁路由，替换目前的 OpenWRT 主路由，但是又觉得过于繁琐（源于过去心血的积累），最终搁浅了这个计划。"),"\n",s.createElement(a.p,null,"现在在笔者的家里，就由 N100 主路由服务器与 Mac Mini 4 轻量级应用服务器相辅相成，共同承载笔者捣腾的心理需要。"))}var c=function(e){void 0===e&&(e={});const{wrapper:a}=Object.assign({},(0,t.R)(),e.components);return a?s.createElement(a,e,s.createElement(l,e)):l(e)},r=n(197),i=n(4353),p=n.n(i),o=n(4794),g=n(6947),d=n(4017),m=n(1042),b=n(1038);const u={a:e=>{let{href:a="",children:n}=e;const t=!(null!=a&&a.startsWith("#")),l=t?a:`#${encodeURIComponent(a.slice(1))}`;return s.createElement("a",{href:l,target:t?"_blank":void 0,rel:"noreferrer"},n)},img:e=>{const{alt:a="The author is too lazy to give an alt",src:n,...t}=e;return s.createElement("a",{href:n,"data-fancybox":"gallery","data-caption":a},s.createElement("img",Object.assign({src:n,alt:a},t)))},Card:g.A,Link:o.Link},h=e=>{let{children:a,data:n}=e;const{mdx:{frontmatter:{title:l,date:c,updated:i,categories:o,tags:g,timeliness:m=!0}}}=n,h=s.useRef(null),k=p()(c),A=i?p()(i):k,f=p()().diff(A,"days");return s.useEffect((()=>{var e;const a=null===(e=h.current)||void 0===e?void 0:e.querySelectorAll("a.gatsby-resp-image-link");return null==a||a.forEach((e=>{const a=e.children.item(1);e.setAttribute("data-fancybox","gallery"),e.setAttribute("data-caption",a.alt)})),r.lX.bind("[data-fancybox]"),()=>r.lX.unbind("[data-fancybox]")}),[]),s.createElement("div",{className:"mx-auto flex max-w-xl flex-col gap-y-12"},s.createElement("div",{className:"flex flex-col gap-4"},(null==o?void 0:o.length)&&s.createElement(d.A,{name:o[0],className:"item-selectable"}),s.createElement("h1",{className:"text-3xl font-bold"},l),s.createElement("div",{className:"item-secondary flex flex-col gap-2 lg:flex-row"},c&&s.createElement("span",{title:`首次发布于：${k.toString()}\n最后更新于：${A.toString()}`},k.format("MM 月 DD 日 YYYY 年")),(null==g?void 0:g.length)&&s.createElement("div",{className:"flex flex-1 flex-wrap gap-2 lg:before:content-['•']"},g.map((e=>s.createElement(b.A,{key:e,name:e,className:"item-secondary item-selectable"})))))),s.createElement("article",{ref:h,className:"heti post-entry"},m&&f>365&&s.createElement("blockquote",{className:"border-l-4 border-orange-400"},"这是一篇",s.createElement("strong",null,"最后更新于 ",f," 天前"),"的博客，内容可能随着时间的推移而变得不再适用，建议您仔细评估信息的有效性。"),s.createElement(t.x,{components:u},a)))},k=e=>{let{data:a}=e;return s.createElement(m.A,{title:String(a.mdx.frontmatter.title)})};function A(e){return s.createElement(h,e,s.createElement(c,e))}}}]);
//# sourceMappingURL=component---src-templates-post-tsx-content-file-path-blog-posts-mac-mini-server-mdx-2eee2175004d5a4331d0.js.map