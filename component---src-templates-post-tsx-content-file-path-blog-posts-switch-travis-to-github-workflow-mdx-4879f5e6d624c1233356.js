"use strict";(self.webpackChunkhomepage=self.webpackChunkhomepage||[]).push([[2711],{5125:function(n,a,e){e.r(a),e.d(a,{Head:function(){return h},default:function(){return b}});var s=e(8453),t=e(6540);function l(n){const a=Object.assign({p:"p",h2:"h2",span:"span",a:"a"},(0,s.R)(),n.components);return t.createElement(t.Fragment,null,t.createElement(a.p,null,"我真傻，真的，单单受文档的推荐就选择了 Travis 作为部分项目的持续集成工具，没有料到它早已于 2020 年 12 月更换了免费政策，不再为开源项目提供免费的用于持续集成使用的 Credits 了。当赠送的 10000 个点数用完，就需要付费才能进行构建了。"),"\n",t.createElement(a.p,null,"当然，作为经济驱动的公司，近些天来又受 Github Actions 等其它持续集成工具打压了盈利空间，抛弃开源用户选择转型做起了商人事业也并非不可理解。感谢它曾为开发者提供的便利，不过作为一个佛系开发者，终于还是需要转投到别的免费工具上去了——Gihub Actions。"),"\n",t.createElement(a.h2,null,"编写新的 workflow.yml"),"\n",t.createElement(a.p,null,"那么首先，我们就需要将为 Travis 编写的命名为 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">.travis.yml</code>'}})," 的配置文件，翻译成 Github Actions 能识别的 workflow.yml 配置文件。"),"\n",t.createElement(a.p,null,"以",t.createElement(a.a,{href:"https://github.com/LolipopJ/design-patterns-for-humans-zh"},"献给中文读者的设计模式教程"),"这个项目为例，原有的 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">.travis.yml</code>'}})," 内容如下："),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">language</span><span class="token punctuation">:</span> node_js\n<span class="token key atrule">node_js</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> lts/*\n<span class="token key atrule">branches</span><span class="token punctuation">:</span>\n  <span class="token key atrule">only</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> main\n<span class="token key atrule">install</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> cd vuepress\n  <span class="token punctuation">-</span> yarn install\n<span class="token key atrule">script</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> yarn build\n<span class="token key atrule">deploy</span><span class="token punctuation">:</span>\n  <span class="token key atrule">provider</span><span class="token punctuation">:</span> pages\n  <span class="token key atrule">skip_cleanup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n  <span class="token key atrule">local_dir</span><span class="token punctuation">:</span> vuepress/docs/.vuepress/dist\n  <span class="token key atrule">github_token</span><span class="token punctuation">:</span> $CI_DEPLOY_TOKEN\n  <span class="token key atrule">keep_history</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n  <span class="token key atrule">on</span><span class="token punctuation">:</span>\n    <span class="token key atrule">branch</span><span class="token punctuation">:</span> main</code></pre></div>'}}),"\n",t.createElement(a.p,null,"当检测到 main 分支代码更新后，启动持续集成工具。克隆项目，进入到项目的 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">vuepress</code>'}})," 目录下执行安装依赖和生成静态文件操作，最后将 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/vuepress/docs/.vuepress/dist</code>'}})," 目录下的静态文件，上传到 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">gh-pages</code>'}})," 分支，交给 Github 部署。"),"\n",t.createElement(a.p,null,"使用 Github Actions 实现上面的过程，首先在项目根目录创建 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">.github/workflows</code>'}})," 文件夹，在文件夹内创建 workflow 配置文件，例如 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">deploy.yml</code>'}}),"，编写内容如下："),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Vuepress Deployment\n\n<span class="token key atrule">on</span><span class="token punctuation">:</span>\n  <span class="token key atrule">push</span><span class="token punctuation">:</span>\n    <span class="token key atrule">branches</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> main\n\n<span class="token key atrule">jobs</span><span class="token punctuation">:</span>\n  <span class="token key atrule">pages</span><span class="token punctuation">:</span>\n    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest\n    <span class="token key atrule">steps</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Use Node.js 14.x\n        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1\n        <span class="token key atrule">with</span><span class="token punctuation">:</span>\n          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">"14.x"</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cache NPM dependencies\n        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v2\n        <span class="token key atrule">with</span><span class="token punctuation">:</span>\n          <span class="token key atrule">path</span><span class="token punctuation">:</span> node_modules\n          <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.OS <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>npm<span class="token punctuation">-</span>cache\n          <span class="token key atrule">restore-keys</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">\n            ${{ runner.OS }}-npm-cache</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Dependencies\n        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">\n          cd vuepress\n          npm install</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build\n        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">\n          cd vuepress\n          npm run build</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy\n        <span class="token key atrule">uses</span><span class="token punctuation">:</span> peaceiris/actions<span class="token punctuation">-</span>gh<span class="token punctuation">-</span>pages@v3\n        <span class="token key atrule">with</span><span class="token punctuation">:</span>\n          <span class="token key atrule">github_token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHUB_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>\n          <span class="token key atrule">deploy_key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.ACCESS_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>\n          <span class="token key atrule">publish_dir</span><span class="token punctuation">:</span> vuepress/docs/.vuepress/dist\n          <span class="token key atrule">publish_branch</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages</code></pre></div>'}}),"\n",t.createElement(a.h2,null,"创建 SSH Deploy Key"),"\n",t.createElement(a.p,null,"这一步是为了给 Github Actions 远程服务器访问我的 Github 账号提供凭证。如果没有设置 Github 账户双重验证或其它安全验证，可以移除上面脚本中的 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">deploy_key</code>'}})," 属性然后跳过这一步。但是假如以后设置了安全验证，回来改又会很麻烦，不如一步到位了吧 🤗。"),"\n",t.createElement(a.p,null,"您也可以生成 Personal access token 作为替代，不过前面的脚本中的 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">deploy_key</code>'}})," 应该修改为 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">personal_token</code>'}}),"。"),"\n",t.createElement(a.p,null,"启动命令行工具，创建 SSH 部署密钥："),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 进入到当前用户的 .ssh 目录下</span>\n<span class="token builtin class-name">cd</span> ~/.ssh\n<span class="token comment"># 创建 SSH 密钥</span>\nssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-b</span> <span class="token number">4096</span> <span class="token parameter variable">-C</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> config user.email<span class="token variable">)</span></span>"</span> <span class="token parameter variable">-f</span> design-patterns-for-humans-zh-gh-pages</code></pre></div>'}}),"\n",t.createElement(a.p,null,"其中，",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">design-patterns-for-humans-zh-gh-pages.pub</code>'}})," 为公钥，应上传到 ",t.createElement(a.a,{href:"https://github.com/settings/keys"},"Github 账户 SSH keys 设置"),"中；不带后缀的为私钥，应作为 ",t.createElement(a.a,{href:"https://github.com/LolipopJ/design-patterns-for-humans-zh/settings/secrets/actions"},"Github 项目仓库的 Secret"),"，根据前面的配置，这里命名为 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">ACCESS_TOKEN</code>'}}),"。"),"\n",t.createElement(a.h2,null,"最后一步"),"\n",t.createElement(a.p,null,"最后，移除 Github 仓库中用于 Travis 的删除原有部署密钥，例如 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">CI_DEPLOY_TOKEN</code>'}}),"，删除项目中的 ",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">.travis.yml</code>'}})," 文件，提交代码到 Github 即可。"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/011718c56e8455246852c7dac3517bfa/a88f6/deploy-finished.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 46.794871794871796%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABJ0AAASdAHeZh94AAABpUlEQVR42n2RX0/TYBSH+0UUAttY2/Xf2q5lbAPmNBqN38wP4IV8BeOFMUHnxkaIl94YvTAMo1FCFiGQrTBwj+dtnVkUbfKkOW9On/7OebWj5Ijj4SHJ6ASmE5JkTLe3y8t2h1evFd1/0u7s0Nnpy7vH8xfbdLp9tN77M7bfDmm/O+HNwRXP9gY4YY286bFUtFnMlwSThV9ktZAzyekuRStkpeSzWLCoN++ibfW/s9U/5nF3yJPdUx49/YC/ukFUa1KOGphuhOlFlLyYUjnGcCq/0Z0Q3Q6lp5LKW/ceosEViun0EvV8O/wqf/Wx/CpBdYNy3MCr1LCDKra/KqJMkhGktWIhZ7B+SxKejScoTkcXnIvz4+BL2uCKJG608ON1XFmBkqkkiplkJlRny7Kezdv30cbnExSj5ILLHzD49Dlt8Cp1PJEVZD95w6MgO1XJV4Sc7qSCGaq+sVSkoRL+LcwSWmGdoNbCjTdl/DU5C1LpTDBP3nC5uaxnI1+XUI1nyQWUo3qKYWcy9eGfsnnhtSPvi1BJ3HANRy5CpZ0f7X/C5p0H/ASsZ5PHuhEOnwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="CI 部署成功"\n        title=""\n        src="/static/011718c56e8455246852c7dac3517bfa/39c09/deploy-finished.png"\n        srcset="/static/011718c56e8455246852c7dac3517bfa/680fe/deploy-finished.png 156w,\n/static/011718c56e8455246852c7dac3517bfa/17474/deploy-finished.png 312w,\n/static/011718c56e8455246852c7dac3517bfa/39c09/deploy-finished.png 624w,\n/static/011718c56e8455246852c7dac3517bfa/6d2da/deploy-finished.png 936w,\n/static/011718c56e8455246852c7dac3517bfa/5a791/deploy-finished.png 1248w,\n/static/011718c56e8455246852c7dac3517bfa/a88f6/deploy-finished.png 1900w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}))}var p=function(n){void 0===n&&(n={});const{wrapper:a}=Object.assign({},(0,s.R)(),n.components);return a?t.createElement(a,n,t.createElement(l,n)):l(n)},c=e(197),o=e(4353),u=e.n(o),r=e(4794),i=e(6947),k=e(4017),d=e(1042),m=e(1038);const g={a:n=>{let{href:a="",children:e}=n;const s=!(null!=a&&a.startsWith("#")),l=s?a:`#${encodeURIComponent(a.slice(1))}`;return t.createElement("a",{href:l,target:s?"_blank":void 0,rel:"noreferrer"},e)},img:n=>{const{alt:a="The author is too lazy to give an alt",src:e,...s}=n;return t.createElement("a",{href:e,"data-fancybox":"gallery","data-caption":a},t.createElement("img",Object.assign({src:e,alt:a},s)))},Card:i.A,Link:r.Link},y=n=>{let{children:a,data:e}=n;const{mdx:{fields:{isDraft:l},frontmatter:{title:p,date:o,updated:r,categories:i,tags:d,timeliness:y}}}=e,h=t.useRef(null),b=u()(o),f=r?u()(r):b,E=u()().diff(f,"days");return t.useEffect((()=>{var n;const a=null===(n=h.current)||void 0===n?void 0:n.querySelectorAll("a.gatsby-resp-image-link");return null==a||a.forEach((n=>{const a=n.children.item(1);n.setAttribute("data-fancybox","gallery"),n.setAttribute("data-caption",a.alt)})),c.lX.bind("[data-fancybox]"),()=>c.lX.unbind("[data-fancybox]")}),[]),t.createElement("div",{className:"mx-auto flex max-w-xl flex-col gap-y-12"},t.createElement("div",{className:"flex flex-col gap-4"},(null==i?void 0:i.length)&&t.createElement(k.A,{name:i[0],className:"item-selectable"}),t.createElement("h1",{className:"text-3xl font-bold"},p),t.createElement("div",{className:"item-secondary flex flex-col gap-2 lg:flex-row"},o&&t.createElement("span",{title:`首次发布于：${b.toString()}\n最后更新于：${f.toString()}`},b.format("MM 月 DD 日 YYYY 年")),(null==d?void 0:d.length)&&t.createElement("div",{className:"flex flex-1 flex-wrap gap-2 lg:before:content-['•']"},d.map((n=>t.createElement(m.A,{key:n,name:n,className:"item-secondary item-selectable"})))))),t.createElement("article",{ref:h,className:"heti post-entry"},l&&t.createElement("blockquote",{className:"!border-red-400"},"这是一篇",t.createElement("strong",null,"未正式发布"),"的博客，内容可能尚未撰写完全或存在一些纰漏，建议您仔细评估信息的有效性。"),!1!==y&&E>365&&t.createElement("blockquote",{className:"!border-orange-400"},"这是一篇",t.createElement("strong",null,"最后更新于 ",E," 天前"),"的博客，内容可能随着时间的推移而变得不再适用，建议您仔细评估信息的有效性。"),t.createElement(s.x,{components:g},a)))},h=n=>{let{data:a}=n;return t.createElement(d.A,{title:String(a.mdx.frontmatter.title)})};function b(n){return t.createElement(y,n,t.createElement(p,n))}}}]);
//# sourceMappingURL=component---src-templates-post-tsx-content-file-path-blog-posts-switch-travis-to-github-workflow-mdx-4879f5e6d624c1233356.js.map