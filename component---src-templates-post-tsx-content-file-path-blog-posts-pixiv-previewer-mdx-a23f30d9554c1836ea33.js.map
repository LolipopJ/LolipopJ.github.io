{"version":3,"file":"component---src-templates-post-tsx-content-file-path-blog-posts-pixiv-previewer-mdx-a23f30d9554c1836ea33.js","mappings":"yMAGA,SAASA,EAAkBC,GACzB,MAAMC,EAAcC,OAAOC,OAAO,CAChCC,EAAG,IACHC,GAAI,KACJC,GAAI,KACJC,OAAQ,SACRC,EAAG,IACHC,GAAI,KACJC,GAAI,KACJC,KAAM,OACNC,WAAY,aACZC,GAAI,OACHC,EAAAA,EAAAA,KAAsBd,EAAMe,YAC/B,OAAOC,EAAAA,cAAoBA,EAAAA,SAAgB,KAAMA,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,6EAA8E,KAAMY,EAAAA,cAAoBf,EAAYI,GAAI,KAAM,KAAMW,EAAAA,cAAoBf,EAAYK,GAAI,KAAMU,EAAAA,cAAoBf,EAAYM,OAAQ,KAAM,QAAS,0CAA2C,KAAMS,EAAAA,cAAoBf,EAAYK,GAAI,KAAMU,EAAAA,cAAoBf,EAAYM,OAAQ,KAAM,QAAS,gDAAiD,MAAO,KAAMS,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,WAAYY,EAAAA,cAAoBf,EAAYO,EAAG,CACrmBS,KAAM,8CACL,QAAS,yCAA0C,KAAMD,EAAAA,cAAoBf,EAAYQ,GAAI,KAAM,SAAU,KAAMO,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,6KAA8K,KAAMY,EAAAA,cAAoBf,EAAYS,GAAI,KAAM,gBAAiB,KAAMM,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,OAAQY,EAAAA,cAAoBf,EAAYU,KAAM,CACzeO,wBAAyB,CACvBC,OAAQ,qDAER,sFAAuFH,EAAAA,cAAoBf,EAAYO,EAAG,CAC5HS,KAAM,kCACL,QAAS,KAAM,KAAMD,EAAAA,cAAoBf,EAAYU,KAAM,CAC5DO,wBAAyB,CACvBC,OAAQ,yQAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,iBAAkBY,EAAAA,cAAoBf,EAAYU,KAAM,CACzGO,wBAAyB,CACvBC,OAAQ,uDAER,KAAM,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CACpDO,wBAAyB,CACvBC,OAAQ,wvMAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,yBAA0BY,EAAAA,cAAoBf,EAAYU,KAAM,CACjHO,wBAAyB,CACvBC,OAAQ,qDAER,YAAaH,EAAAA,cAAoBf,EAAYU,KAAM,CACrDO,wBAAyB,CACvBC,OAAQ,sDAER,SAAUH,EAAAA,cAAoBf,EAAYU,KAAM,CAClDO,wBAAyB,CACvBC,OAAQ,sDAER,aAAcH,EAAAA,cAAoBf,EAAYU,KAAM,CACtDO,wBAAyB,CACvBC,OAAQ,qDAER,4DAA6D,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,UAAWY,EAAAA,cAAoBf,EAAYU,KAAM,CAC/JO,wBAAyB,CACvBC,OAAQ,6CAER,iBAAkB,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CAChEO,wBAAyB,CACvBC,OAAQ,ikEAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,sBAAuBY,EAAAA,cAAoBf,EAAYU,KAAM,CAC9GO,wBAAyB,CACvBC,OAAQ,sDAER,6CAA8CH,EAAAA,cAAoBf,EAAYU,KAAM,CACtFO,wBAAyB,CACvBC,OAAQ,sDAER,UAAW,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CACzDO,wBAAyB,CACvBC,OAAQ,uxEAER,KAAMH,EAAAA,cAAoBf,EAAYS,GAAI,KAAM,gBAAiB,KAAMM,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,oFAAqFY,EAAAA,cAAoBf,EAAYO,EAAG,CAC1OS,KAAM,0DACLD,EAAAA,cAAoBf,EAAYU,KAAM,CACvCO,wBAAyB,CACvBC,OAAQ,2DAEP,kBAAmBH,EAAAA,cAAoBf,EAAYU,KAAM,CAC5DO,wBAAyB,CACvBC,OAAQ,0DAER,KAAM,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CACpDO,wBAAyB,CACvBC,OAAQ,sTAER,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CAC9CO,wBAAyB,CACvBC,OAAQ,gnCAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,QAASY,EAAAA,cAAoBf,EAAYU,KAAM,CAChGO,wBAAyB,CACvBC,OAAQ,yDAER,cAAeH,EAAAA,cAAoBf,EAAYU,KAAM,CACvDO,wBAAyB,CACvBC,OAAQ,6CAER,kBAAmB,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,8EAA+EY,EAAAA,cAAoBf,EAAYU,KAAM,CACzLO,wBAAyB,CACvBC,OAAQ,yDAER,iCAAkCH,EAAAA,cAAoBf,EAAYO,EAAG,CACvES,KAAM,sDACLD,EAAAA,cAAoBf,EAAYU,KAAM,CACvCO,wBAAyB,CACvBC,OAAQ,gEAEP,6BAA8BH,EAAAA,cAAoBf,EAAYU,KAAM,CACvEO,wBAAyB,CACvBC,OAAQ,0DAER,KAAM,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CACpDO,wBAAyB,CACvBC,OAAQ,2TAER,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CAC9CO,wBAAyB,CACvBC,OAAQ,65CAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,kEAAmE,KAAMY,EAAAA,cAAoBf,EAAYU,KAAM,CAChKO,wBAAyB,CACvBC,OAAQ,0RAER,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CAC9CO,wBAAyB,CACvBC,OAAQ,i8EAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,+EAAgFY,EAAAA,cAAoBf,EAAYU,KAAM,CACvKO,wBAAyB,CACvBC,OAAQ,qDAER,oBAAqB,KAAMH,EAAAA,cAAoBf,EAAYQ,GAAI,KAAM,UAAW,KAAMO,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,oEAAqEY,EAAAA,cAAoBf,EAAYU,KAAM,CAC5OO,wBAAyB,CACvBC,OAAQ,iDAER,8EAA+E,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,yCAA0CY,EAAAA,cAAoBf,EAAYU,KAAM,CAChNO,wBAAyB,CACvBC,OAAQ,iDAER,mCAAoCH,EAAAA,cAAoBf,EAAYU,KAAM,CAC5EO,wBAAyB,CACvBC,OAAQ,iDAER,wBAAyBH,EAAAA,cAAoBf,EAAYU,KAAM,CACjEO,wBAAyB,CACvBC,OAAQ,+DAER,2BAA4B,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CAC1EO,wBAAyB,CACvBC,OAAQ,ghGAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,gCAAiCY,EAAAA,cAAoBf,EAAYU,KAAM,CACxHO,wBAAyB,CACvBC,OAAQ,iDAER,uBAAwB,KAAMH,EAAAA,cAAoBf,EAAYW,WAAY,KAAM,KAAMI,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,iHAAkH,MAAO,KAAMY,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,mBAAoBY,EAAAA,cAAoBf,EAAYU,KAAM,CACnWO,wBAAyB,CACvBC,OAAQ,iDAER,mDAAoD,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CAClGO,wBAAyB,CACvBC,OAAQ,qwCAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,8BAA+BY,EAAAA,cAAoBf,EAAYU,KAAM,CACtHO,wBAAyB,CACvBC,OAAQ,kDAER,mBAAoBH,EAAAA,cAAoBf,EAAYU,KAAM,CAC5DO,wBAAyB,CACvBC,OAAQ,kEAER,UAAWH,EAAAA,cAAoBf,EAAYU,KAAM,CACnDO,wBAAyB,CACvBC,OAAQ,+CAER,uBAAwBH,EAAAA,cAAoBf,EAAYU,KAAM,CAChEO,wBAAyB,CACvBC,OAAQ,kDAER,kCAAmCH,EAAAA,cAAoBf,EAAYU,KAAM,CAC3EO,wBAAyB,CACvBC,OAAQ,kDAER,aAAcH,EAAAA,cAAoBf,EAAYU,KAAM,CACtDO,wBAAyB,CACvBC,OAAQ,gDAER,6BAA8BH,EAAAA,cAAoBf,EAAYU,KAAM,CACtEO,wBAAyB,CACvBC,OAAQ,kDAER,QAAS,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,iDAAkD,KAAMY,EAAAA,cAAoBf,EAAYU,KAAM,CACxJO,wBAAyB,CACvBC,OAAQ,u3EAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,mBAAoBY,EAAAA,cAAoBf,EAAYU,KAAM,CAC3GO,wBAAyB,CACvBC,OAAQ,iDAER,oBAAqBH,EAAAA,cAAoBf,EAAYU,KAAM,CAC7DO,wBAAyB,CACvBC,OAAQ,4CAER,sDAAuDH,EAAAA,cAAoBf,EAAYU,KAAM,CAC/FO,wBAAyB,CACvBC,OAAQ,+CAER,eAAgB,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,SAAUY,EAAAA,cAAoBf,EAAYU,KAAM,CACjHO,wBAAyB,CACvBC,OAAQ,iDAER,iBAAkBH,EAAAA,cAAoBf,EAAYU,KAAM,CAC1DO,wBAAyB,CACvBC,OAAQ,4CAER,wBAAyBH,EAAAA,cAAoBf,EAAYU,KAAM,CACjEO,wBAAyB,CACvBC,OAAQ,kFAER,6BAA8BH,EAAAA,cAAoBf,EAAYU,KAAM,CACtEO,wBAAyB,CACvBC,OAAQ,iDAER,4CAA6CH,EAAAA,cAAoBf,EAAYU,KAAM,CACrFO,wBAAyB,CACvBC,OAAQ,+CAER,UAAWH,EAAAA,cAAoBf,EAAYU,KAAM,CACnDO,wBAAyB,CACvBC,OAAQ,6CAER,QAASH,EAAAA,cAAoBf,EAAYU,KAAM,CACjDO,wBAAyB,CACvBC,OAAQ,+DAER,YAAa,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CAC3DO,wBAAyB,CACvBC,OAAQ,g9MAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,uCAAwCY,EAAAA,cAAoBf,EAAYU,KAAM,CAC/HO,wBAAyB,CACvBC,OAAQ,yEAER,mBAAoB,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,gDAAiD,KAAMY,EAAAA,cAAoBf,EAAYU,KAAM,CAClKO,wBAAyB,CACvBC,OAAQ,yyFAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,cAAe,KAAMY,EAAAA,cAAoBf,EAAYQ,GAAI,KAAM,aAAc,KAAMO,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,wDAAyD,KAAMY,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,4LAA6L,KAAMY,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,6EAA8E,KAAMY,EAAAA,cAAoBf,EAAYS,GAAI,KAAM,UAAW,KAAMM,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,mEAAoE,KAAMY,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,yBAA0B,KAAMY,EAAAA,cAAoBf,EAAYY,GAAI,KAAM,KAAMG,EAAAA,cAAoBf,EAAYK,GAAI,KAAM,YAAa,KAAMU,EAAAA,cAAoBf,EAAYK,GAAI,KAAM,YAAa,KAAMU,EAAAA,cAAoBf,EAAYK,GAAI,KAAM,iBAAkB,MAAO,KAAMU,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,gCAAiC,KAAMY,EAAAA,cAAoBf,EAAYU,KAAM,CACrrCO,wBAAyB,CACvBC,OAAQ,kgPAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,mFAAoFY,EAAAA,cAAoBf,EAAYU,KAAM,CAC3KO,wBAAyB,CACvBC,OAAQ,qEAER,UAAWH,EAAAA,cAAoBf,EAAYU,KAAM,CACnDO,wBAAyB,CACvBC,OAAQ,qDAER,sBAAuB,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CACrEO,wBAAyB,CACvBC,OAAQ,s5EAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,wBAAyB,KAAMY,EAAAA,cAAoBf,EAAYU,KAAM,CACtHO,wBAAyB,CACvBC,OAAQ,6rFAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,iIAAkI,KAAMY,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,oGAAqGY,EAAAA,cAAoBf,EAAYU,KAAM,CAC7WO,wBAAyB,CACvBC,OAAQ,2CAER,YAAa,KAAMH,EAAAA,cAAoBf,EAAYS,GAAI,KAAM,YAAa,KAAMM,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,oEAAqE,KAAMY,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,mBAAoBY,EAAAA,cAAoBf,EAAYU,KAAM,CACzSO,wBAAyB,CACvBC,OAAQ,mFAER,KAAM,KAAMH,EAAAA,cAAoBf,EAAYU,KAAM,CACpDO,wBAAyB,CACvBC,OAAQ,k+KAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,2JAA4J,KAAMY,EAAAA,cAAoBf,EAAYU,KAAM,CACzPO,wBAAyB,CACvBC,OAAQ,o3VAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,yCAA0C,KAAMY,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,uEAAwE,KAAMY,EAAAA,cAAoBf,EAAYU,KAAM,CAC9PO,wBAAyB,CACvBC,OAAQ,0sSAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,mEAAoE,KAAMY,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,iBAAkB,KAAMY,EAAAA,cAAoBf,EAAYU,KAAM,CAClOO,wBAAyB,CACvBC,OAAQ,slRAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,mIAAoI,KAAMY,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,wBAAyBY,EAAAA,cAAoBf,EAAYO,EAAG,CAChSS,KAAM,mDACL,oBAAqB,uBAAwBD,EAAAA,cAAoBf,EAAYU,KAAM,CACpFO,wBAAyB,CACvBC,OAAQ,wIAER,gBAAiB,KAAMH,EAAAA,cAAoBf,EAAYS,GAAI,KAAM,UAAW,KAAMM,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,uCAAwC,KAAMY,EAAAA,cAAoBf,EAAYU,KAAM,CACjNO,wBAAyB,CACvBC,OAAQ,o8qBAER,KAAMH,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,iKAAkK,KAAMY,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,gCAAiC,KAAMY,EAAAA,cAAoBf,EAAYU,KAAM,CAC/UO,wBAAyB,CACvBC,OAAQ,89EAER,KAAMH,EAAAA,cAAoBf,EAAYQ,GAAI,KAAM,MAAO,KAAMO,EAAAA,cAAoBf,EAAYG,EAAG,KAAM,MAAOY,EAAAA,cAAoBf,EAAYO,EAAG,CAClJS,KAAM,+CACL,eAAgB,KAAMD,EAAAA,cAAoBf,EAAYO,EAAG,CAC1DS,KAAM,+CACL,qBAAsB,sBAC3B,CAKA,MAJA,SAAoBjB,QAAK,IAALA,IAAAA,EAAQ,CAAC,GAC3B,MAAOoB,QAASC,GAAanB,OAAOC,OAAO,CAAC,GAAGW,EAAAA,EAAAA,KAAsBd,EAAMe,YAC3E,OAAOM,EAAYL,EAAAA,cAAoBK,EAAWrB,EAAOgB,EAAAA,cAAoBjB,EAAmBC,IAAUD,EAAkBC,EAC9H,E,8ECjTA,MAqBMe,EAAa,CACjBP,EAXYc,IACZ,IAAI,KAACL,EAAO,GAAE,SAAEM,GAAYD,EAC5B,MAAME,IAAmBP,SAAoCA,EAAKQ,WAAW,MACvEC,EAAaF,EAAiBP,EAAO,IAAIU,mBAAmBV,EAAKW,MAAM,MAC7E,OAAOZ,EAAAA,cAAoB,IAAK,CAC9BC,KAAMS,EACNG,OAAQL,EAAiB,cAAWM,EACpCC,IAAK,cACJR,EAAS,EAIZS,IAvBoBhC,IACpB,MAAM,IAACiC,EAAM,wCAAuC,IAAEC,KAAQC,GAAanC,EAC3E,OAAOgB,EAAAA,cAAoB,IAAK,CAC9BC,KAAMiB,EACN,gBAAiB,UACjB,eAAgBD,GACfjB,EAAAA,cAAoB,MAAOd,OAAOC,OAAO,CAC1C+B,IAAKA,EACLD,IAAKA,GACJE,IAAY,EAefC,KAAI,IACJC,KAAIA,EAAAA,MAEAC,EAAeC,IACnB,IAAI,SAAChB,EAAQ,KAAEiB,GAAQD,EACvB,MAAOE,KAAMC,QAAQ,QAACC,GAAUC,aAAa,MAACC,EAAOC,KAAMC,EAAYC,QAASC,EAAiB,WAAEC,EAAU,KAAEC,EAAI,WAAEC,KAAgBZ,EAC/Ha,EAAarC,EAAAA,OAAa,MAC1B8B,EAAOQ,IAAMP,GACbQ,EAAcN,EAAoBK,IAAML,GAAqBH,EAE7DU,EADQF,MACSG,KAAKF,EAAa,QAYzC,OAXAvC,EAAAA,WAAgB,KACd,IAAI0C,EACJ,MAAMC,EAAqE,QAA9CD,EAAsBL,EAAWO,eAA6C,IAAxBF,OAAiC,EAASA,EAAoBG,iBAAiB,4BAOlK,OANAF,SAA0EA,EAAoBG,SAAQC,IACpG,MAAMC,EAAQD,EAAKxC,SAAS0C,KAAK,GACjCF,EAAKG,aAAa,gBAAiB,WACnCH,EAAKG,aAAa,eAAgBF,EAAM/B,IAAI,IAE9CkC,EAAAA,GAASC,KAAK,mBACP,IAAMD,EAAAA,GAASE,OAAO,kBAAkB,GAC9C,IACIrD,EAAAA,cAAoB,MAAO,CAChCsD,UAAW,2CACVtD,EAAAA,cAAoB,MAAO,CAC5BsD,UAAW,wBACTpB,aAA+C,EAASA,EAAWqB,SAAWvD,EAAAA,cAAoBwD,EAAAA,EAAU,CAC9GC,KAAMvB,EAAW,GACjBoB,UAAW,oBACTtD,EAAAA,cAAoB,KAAM,CAC5BsD,UAAW,sBACVzB,GAAQ7B,EAAAA,cAAoB,MAAO,CACpCsD,UAAW,kDACVvB,GAAc/B,EAAAA,cAAoB,OAAQ,CAC3C6B,MAAO,SAASC,EAAK4B,qBAAqBnB,EAAYmB,cACrD5B,EAAK6B,OAAO,sBAAuBxB,aAAmC,EAASA,EAAKoB,SAAWvD,EAAAA,cAAoB,MAAO,CAC3HsD,UAAW,uDACVnB,EAAKyB,KAAIC,GAAO7D,EAAAA,cAAoB8D,EAAAA,EAAK,CAC1CC,IAAKF,EACLJ,KAAMI,EACNP,UAAW,wCACLtD,EAAAA,cAAoB,UAAW,CACrCgE,IAAK3B,EACLiB,UAAW,mBACV3B,GAAW3B,EAAAA,cAAoB,aAAc,CAC9CsD,UAAW,mBACV,OAA4BtD,EAAAA,cAAoB,SAAU,KAAM,SAAmC,yCAA4O,IAAfoC,GAAwBI,EAAW,KAAOxC,EAAAA,cAAoB,aAAc,CAC7YsD,UAAW,sBACV,OAA4BtD,EAAAA,cAAoB,SAAU,KAAM,SAAmCwC,EAAU,OAAkB,yCAAmOxC,EAAAA,cAAoBiE,EAAAA,EAAa,CACpYlE,WAAYA,GACXQ,IAAW,EAGH2D,EAAOC,IAClB,IAAI,KAAC3C,GAAQ2C,EACb,OAAOnE,EAAAA,cAAoBoE,EAAAA,EAAK,CAC9BvC,MAAOwC,OAAO7C,EAAKC,IAAIG,YAAYC,QACnC,EAGW,SAASyC,EAAiBtF,GACvC,OAAOgB,EAAAA,cAAoBsB,EAActC,EAAOgB,EAAAA,cAAoBuE,EAAqBvF,GAC3F,C","sources":["webpack://homepage/./blog/posts/pixiv-previewer.mdx","webpack://homepage/./src/templates/post.tsx"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    ol: \"ol\",\n    li: \"li\",\n    strong: \"strong\",\n    a: \"a\",\n    h2: \"h2\",\n    h3: \"h3\",\n    span: \"span\",\n    blockquote: \"blockquote\",\n    ul: \"ul\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.p, null, \"笔者的业余爱好之一就是逛 Pixiv，收藏好看的插画等作品并下载到本地。油猴脚本 Pixiv Previewer 做了两个笔者很喜欢的便利性工作：\"), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"作品预览\"), \"：鼠标悬浮在作品缩略图上时自动在当前页面显示大图，快速决定要不要点进作品页。\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"作品排序\"), \"：作品搜索页可以按“排序”按钮，自动获取若干页的作品并按照收藏数排序，快速筛选优质作品。\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"出于爱好，笔者去\", React.createElement(_components.a, {\n    href: \"https://github.com/Ocrosoft/PixivPreviewer\"\n  }, \"脚本仓库\"), \"翻阅了一下源码，觉得有一些可以改进的地方，遂 Fork 之，进行二次开发。\"), \"\\n\", React.createElement(_components.h2, null, \"工程化改造\"), \"\\n\", React.createElement(_components.p, null, \"首当其冲的自然是前端项目工程化改造。大多数油猴脚本仓库都是孤零零的一个 JavaScript 文件，Pixiv Previewer 也不例外。直接手搓 JavaScript 虽然很便利，但在项目长期的维护开发中多半会掩埋掉许多未曾留意的 Bug，同时由于缺少关联提示，开发效率也会大打折扣。作为前端工程师，这样可怕的事情自然是不能接受的。\"), \"\\n\", React.createElement(_components.h3, null, \"通过 tsup 构建项目\"), \"\\n\", React.createElement(_components.p, null, \"初始化 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">package.json</code>\"\n    }\n  }), \" 等过程跳过不表，添加 TypeScript 支持自然是对项目进行二次开发的前置步骤。由于我们最后构建的产物将作为油猴脚本运行，即打包为库，因此笔者选择了开箱即用的 \", React.createElement(_components.a, {\n    href: \"https://github.com/egoist/tsup\"\n  }, \"tsup\"), \"：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token function\\\">yarn</span> <span class=\\\"token function\\\">add</span> <span class=\\\"token parameter variable\\\">-D</span> tsup</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"添加 tsup 的配置文件 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">tsup.config.ts</code>\"\n    }\n  }), \"：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">import</span> svg <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"esbuild-plugin-svg\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> defineConfig <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"tsup\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">import</span> packageJson <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"./package.json\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token function\\\">defineConfig</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  entry<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"src/index.ts\\\"</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n  target<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"chrome107\\\"</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n  minify<span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n  splitting<span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n  clean<span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n  platform<span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"browser\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  esbuildPlugins<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token function\\\">svg</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">// 为了正确处理项目中用到的 SVG 文件，添加了此插件</span>\\n  env<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token constant\\\">VERSION</span><span class=\\\"token operator\\\">:</span> packageJson<span class=\\\"token punctuation\\\">.</span>version<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  banner<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    js<span class=\\\"token operator\\\">:</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">// ==UserScript==\\n// @name                Pixiv Previewer L\\n// @namespace           </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>homepage<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @version             </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>version<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">-</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">toLocaleDateString</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @description         </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>description<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @author              </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>author<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @license             </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>license<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @supportURL          </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>homepage<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @match               *://www.pixiv.net/*\\n// @grant               GM_getValue\\n// @grant               GM_setValue\\n// @grant               GM_registerMenuCommand\\n// @grant               GM_unregisterMenuCommand\\n// @grant               GM.xmlHttpRequest\\n// @icon                https://t0.gstatic.com/faviconV2?client=SOCIAL&amp;type=FAVICON&amp;fallback_opts=TYPE,SIZE,URL&amp;size=32&amp;url=https://www.pixiv.net\\n// @icon64              https://t0.gstatic.com/faviconV2?client=SOCIAL&amp;type=FAVICON&amp;fallback_opts=TYPE,SIZE,URL&amp;size=64&amp;url=https://www.pixiv.net\\n// @require             https://update.greasyfork.org/scripts/515994/1478507/gh_2215_make_GM_xhr_more_parallel_again.js\\n// @require             http://code.jquery.com/jquery-3.7.1.min.js\\n// @run-at              document-end\\n// ==/UserScript==</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"上面的配置表示，tsup 将打包构建源文件 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">src/index.ts</code>\"\n    }\n  }), \" 至默认产物文件 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">dist/index.js</code>\"\n    }\n  }), \"，保证兼容 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">Chrome >= 107</code>\"\n    }\n  }), \"。其中，笔者复用了 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">package.json</code>\"\n    }\n  }), \" 里定义的若干字段，用于添加项目环境变量（脚本通过版本号判断是否显示更新日志框），以及生成油猴脚本顶部的配置项。\"), \"\\n\", React.createElement(_components.p, null, \"这样，当执行 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">tsup</code>\"\n    }\n  }), \" 命令时，构建的产物形如：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// ==UserScript==</span>\\n<span class=\\\"token comment\\\">// @name                Pixiv Previewer L</span>\\n<span class=\\\"token comment\\\">// @namespace           https://github.com/LolipopJ/PixivPreviewer</span>\\n<span class=\\\"token comment\\\">// @version             1.1.1-2025/4/25</span>\\n<span class=\\\"token comment\\\">// @description         Original project: https://github.com/Ocrosoft/PixivPreviewer.</span>\\n<span class=\\\"token comment\\\">// @author              Ocrosoft, LolipopJ</span>\\n<span class=\\\"token comment\\\">// @license             GPL-3.0</span>\\n<span class=\\\"token comment\\\">// @supportURL          https://github.com/LolipopJ/PixivPreviewer</span>\\n<span class=\\\"token comment\\\">// @match               *://www.pixiv.net/*</span>\\n<span class=\\\"token comment\\\">// @grant               GM_getValue</span>\\n<span class=\\\"token comment\\\">// @grant               GM_setValue</span>\\n<span class=\\\"token comment\\\">// @grant               GM_registerMenuCommand</span>\\n<span class=\\\"token comment\\\">// @grant               GM_unregisterMenuCommand</span>\\n<span class=\\\"token comment\\\">// @grant               GM.xmlHttpRequest</span>\\n<span class=\\\"token comment\\\">// @icon                https://t0.gstatic.com/faviconV2?client=SOCIAL&amp;type=FAVICON&amp;fallback_opts=TYPE,SIZE,URL&amp;size=32&amp;url=https://www.pixiv.net</span>\\n<span class=\\\"token comment\\\">// @icon64              https://t0.gstatic.com/faviconV2?client=SOCIAL&amp;type=FAVICON&amp;fallback_opts=TYPE,SIZE,URL&amp;size=64&amp;url=https://www.pixiv.net</span>\\n<span class=\\\"token comment\\\">// @require             https://update.greasyfork.org/scripts/515994/1478507/gh_2215_make_GM_xhr_more_parallel_again.js</span>\\n<span class=\\\"token comment\\\">// @require             http://code.jquery.com/jquery-3.7.1.min.js</span>\\n<span class=\\\"token comment\\\">// @run-at              document-end</span>\\n<span class=\\\"token comment\\\">// ==/UserScript==</span>\\n\\n<span class=\\\"token comment\\\">// ... 脚本构建后的代码</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"在默认情况下，tsup 会使用预设的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">tsconfig.json</code>\"\n    }\n  }), \"。但笔者在开发过程中，发现 VSCode 有时会遗漏某些类型的定义，于是手动添加了 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">tsconfig.json</code>\"\n    }\n  }), \" 在根目录：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"json\\\"><pre class=\\\"language-json\\\"><code class=\\\"language-json\\\"><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token property\\\">\\\"compilerOptions\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token property\\\">\\\"target\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"ES2022\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"module\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"esnext\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"esModuleInterop\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"moduleResolution\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"bundler\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"skipLibCheck\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"forceConsistentCasingInFileNames\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token property\\\">\\\"lib\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"esnext\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"dom\\\"</span><span class=\\\"token punctuation\\\">]</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token property\\\">\\\"include\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"src/\\\"</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token property\\\">\\\"exclude\\\"</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"node_modules/\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"dist/\\\"</span><span class=\\\"token punctuation\\\">]</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, null, \"代码质量检查与格式化工具\"), \"\\n\", React.createElement(_components.p, null, \"TypeScript 自身已包含类型检查等能力，但还可以引入更多质量检查的通用规范，提升项目的健壮性。对于 TypeScript 项目，目前来看最好的选择应当是 \", React.createElement(_components.a, {\n    href: \"https://github.com/typescript-eslint/typescript-eslint\"\n  }, React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">typescript-eslint</code>\"\n    }\n  })), \"，参考官方文档添加依赖并配置 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">eslint.config.mjs</code>\"\n    }\n  }), \"：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token function\\\">yarn</span> <span class=\\\"token function\\\">add</span> <span class=\\\"token parameter variable\\\">--dev</span> eslint @eslint/js typescript typescript-eslint</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// @ts-check</span>\\n\\n<span class=\\\"token keyword\\\">import</span> eslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"@eslint/js\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> tseslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"typescript-eslint\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> tseslint<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">config</span><span class=\\\"token punctuation\\\">(</span>\\n  eslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n  tseslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"现在执行 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">eslint src --fix</code>\"\n    }\n  }), \" 即可查找并尝试修复 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">src/</code>\"\n    }\n  }), \" 目录下所有文件的质量问题。\"), \"\\n\", React.createElement(_components.p, null, \"接着为项目添加自动格式化能力，Prettier 是笔者最推荐的选项。此外，笔者喜欢将 Prettier 与 ESLint 结合起来一起使用，即在执行 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">eslint src --fix</code>\"\n    }\n  }), \" 修复质量问题的同时，自动格式化代码。ESLint 的插件 \", React.createElement(_components.a, {\n    href: \"https://github.com/prettier/eslint-plugin-prettier\"\n  }, React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">eslint-plugin-prettier</code>\"\n    }\n  })), \" 可以实现如上能力，添加此插件作为依赖并进一步配置 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">eslint.config.mjs</code>\"\n    }\n  }), \"：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token function\\\">yarn</span> <span class=\\\"token function\\\">add</span> <span class=\\\"token parameter variable\\\">-D</span> prettier eslint-plugin-prettier eslint-config-prettier</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// @ts-check</span>\\n\\n<span class=\\\"token keyword\\\">import</span> eslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"@eslint/js\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> tseslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"typescript-eslint\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> eslintPluginPrettierRecommended <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"eslint-plugin-prettier/recommended\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> tseslint<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">config</span><span class=\\\"token punctuation\\\">(</span>\\n  eslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n  tseslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n  eslintPluginPrettierRecommended<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"此外，Pixiv Previewer 项目依赖于 JQuery 来执行查找与修改 DOM 的操作，笔者添加了相应的类型提示：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token function\\\">yarn</span> <span class=\\\"token function\\\">add</span> <span class=\\\"token parameter variable\\\">-D</span> @types/jquery globals</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// @ts-check</span>\\n\\n<span class=\\\"token keyword\\\">import</span> eslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"@eslint/js\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> tseslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"typescript-eslint\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> eslintPluginPrettierRecommended <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"eslint-plugin-prettier/recommended\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> globals <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"globals\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> tseslint<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">config</span><span class=\\\"token punctuation\\\">(</span>\\n  eslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n  tseslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">languageOptions</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">globals</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">...</span>globals<span class=\\\"token punctuation\\\">.</span>browser<span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token operator\\\">...</span>globals<span class=\\\"token punctuation\\\">.</span>jquery<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  eslintPluginPrettierRecommended<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"至此，基本的项目工程化改造告一段落。项目可以基于 TypeScript 开发，并且拥有了质量检查和格式化能力。将原来的 JavaScript 代码放到 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">src/index.ts</code>\"\n    }\n  }), \" 文件里，开始正式的二次开发吧！\"), \"\\n\", React.createElement(_components.h2, null, \"预览功能优化\"), \"\\n\", React.createElement(_components.p, null, \"笔者在阅读 Pixiv Previewer 源码时发现，原作者根据当前页面的不同，实现了不同的通过 DOM 节点寻找可预览作品的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 标签的方法，并为它添加监听事件，当鼠标悬浮在上面的时候显示预览。为了应对作品动态加载的情况，脚本设置了循环定时器，每隔一小段时间重新执行上述方法。\"), \"\\n\", React.createElement(_components.p, null, \"这种力大砖飞的实现方案存在一个不可忽视的缺陷：要考虑到每个页面里不同的作品 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 标签的排布情况，为之实现绑定事件的方法。对于没有考虑到的作品 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 标签，自然无法显示预览。例如，在当前的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">Pixiv Previewer@3.7.32</code>\"\n    }\n  }), \" 版本，艺术家弹窗里最近的作品就无法显示预览：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/d2c0c6dd61e6532faf6bd2fbf658f27c/80d71/unimplemented-preview.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 120.51282051282051%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEs0lEQVR42pWUe2yTVRjGu667j9HRwnpv13Zdr+tGL2vHmAMsrBiuxQhMwATFCIkyhQAKzkCQi/IH8RKGBAME5DYu4ToSA0aNCFERQsJIhASNhmjiH/5DwPjznG+WtiJ/2OTN6Xe+9zzf8z7P+x6V0+nE5XJhs9mQ/0tKSohGo2QyGdrb2yktLUWlUj0aRUUUFWtQiyhSa3L7DocDu92uRH19PWUCwGA04vP7lWe1Wv3fgI8Li8WCDAkoGaqLi0mnJrF44SKG1QyjuroajUZTyEyuWgu6hduoX7qX8imrxf4/HzaZTMiQJbsEoEpdxEsLnmPLml4c4tlgMFBRUaEkFwkweVABNATwbb1Oas8dtD3HxbnSof18QKXksnLKy0rRj9D+v1KzUcDQ5VQ2nxzXwbo3VghmlQ/fmc1mpXyFqTxY58Wx8RtaP/qB6iUHBcOSHEOZLDWUbmuEy8nWOPO751JRWSUAjco7q9WKVqsVepZQqlahHuXG2bOX6OsHqc6sFVIU5wCzLmdDuqzX64VZZhoaXBjFs9RSfliytdlEntnIyOoyASRCVZwrOcsuP6TbVnFwfEc7+/q2smD20wLUpGis5IhWs1lMNESfIH3iPrr1V1AVlz2eoexNs2ilrkldfPv5pzw7p1uUbia/Z+02KzZnA/qxs9H4xhWakg+UDcm8rS3Jm6uWE2pqFhra8gBFjt2Gxe5E4xmLyuh/FHBIG5sivlw7OztJpVKkJk5k2rSpyhjKd1lAq7EOd0uS9Om/0G+8LkouHypZMpGJgUCASCRCPB5XZjkcDtPR0UEymVTA5H5zczOhUEjJ83m9mAVrtc6OqrK20JTsxZBOpxWQYDBIQgAl2tqJJZJE460CJKp8SAL6xccdUkNPAHP3esrGLy4cvXx3pZOyLQJeD63NAfxuB9GQl0a3U3HXbpNaixzRNq6mGJ0f36J2+dnCxs4CKjrK/6IlTMEEI2e/jaF7A3qxmpvGiH0jnoDzoYHyUlFrynPssoD57jrqXbhMOoZNWYHzJGTO38d6AirSa0iOqSMY92Ax23KA/77eJKCchDoxCQaDXEXUjcLkcFPbOoOaRIbhkZlEugJ0zW/EZLAKsCGGsiJ5rra2NgcsNenr62Pg7BmOHT3CqRPHOX7sGCtXrmXZy8tYt/otlj6/hM3bX2HyzAmE/WGC3iCx5igeoXeVmPeqqqqhq00CShMGb95E/h788Qv3/7zH7/cecPHiNQ4eOsO777zPZ2cGeGFeD6PDCRKROI2uMGFPmBaPF51OV1iy2+ngyys3OPcT/Hj5PBeu3mHg9gP27DrA5t51rOpZzoGdO3lm1jxi0SQ+h5M5T2UYE4oQ8/mU/i3QsUHcgae/usbXgz9z+9IX/HbpNOdv3OXDrX2c6z/Mod172bdzN9u2f0Lvmk20C4adbRNZPH06k1r8lJZoChnKnlp65CJnv7/F3auX+fW7k1wYHKR//1EO79jBfrH295/iwOEBel58FW9jjFhTgtdmzWDXhkV4vW4qhY65SREuh1KTmT63m3kzpjKho5Xe1Vv44L0jxEbHxVSIyfA30RKJ4XU1oB0+gpqaEZhHjSQScomOqFNczgL+DeFv+WlOcrctAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"艺术家最近作品暂未实现预览功能\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/d2c0c6dd61e6532faf6bd2fbf658f27c/39c09/unimplemented-preview.png\\\"\\n        srcset=\\\"/static/d2c0c6dd61e6532faf6bd2fbf658f27c/680fe/unimplemented-preview.png 156w,\\n/static/d2c0c6dd61e6532faf6bd2fbf658f27c/17474/unimplemented-preview.png 312w,\\n/static/d2c0c6dd61e6532faf6bd2fbf658f27c/39c09/unimplemented-preview.png 624w,\\n/static/d2c0c6dd61e6532faf6bd2fbf658f27c/80d71/unimplemented-preview.png 625w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"另外，如果 Pixiv 前端页面某一天迭代更新，寻找作品 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 标签的方法也可能需要大刀阔斧地修改。\"), \"\\n\", React.createElement(_components.blockquote, null, \"\\n\", React.createElement(_components.p, null, \"发布这篇博客的第二天，2025 年 03 月 18 日，Pixiv 就上线了新的首页，“推荐作品”模块的下面变成了无限滚动的推文模式。由于推文存在高度上限，因此部分尺寸的图片还是会出现显示不全的情况，可以添加预览功能。\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"笔者想到的改进方案是：把找作品 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 标签的工作，从脚本手中移交到用户手中。即监听鼠标移动事件，当悬浮到可预览作品上时，显示预览。\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">onMouseMove</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>mouseMoveEvent<span class=\\\"token operator\\\">:</span> JQuery<span class=\\\"token punctuation\\\">.</span>MouseMoveEvent<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function\\\">onMouseOverIllust</span><span class=\\\"token punctuation\\\">(</span>mouseMoveEvent<span class=\\\"token punctuation\\\">.</span>target<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">$</span><span class=\\\"token punctuation\\\">(</span>document<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">on</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"mousemove\\\"</span><span class=\\\"token punctuation\\\">,</span> onMouseMove<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"在上面的代码里，笔者为 Document 全局绑定了 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">mousemove</code>\"\n    }\n  }), \" 监听事件，当鼠标移动时，调用 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">onMouseOverIllust(target)</code>\"\n    }\n  }), \" 方法，其中 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">target</code>\"\n    }\n  }), \" 是当前鼠标所悬浮的元素。如果监听的是 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">mouseover</code>\"\n    }\n  }), \" 事件，脚本可以有更好的性能表现，但是笔者在测试过程中，发现 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">mouseover</code>\"\n    }\n  }), \" 事件回调对象里的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">ctrlKey</code>\"\n    }\n  }), \" 等值有时不能正确反映实际状态，所以这里选择了监听 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">mousemove</code>\"\n    }\n  }), \" 事件。\"), \"\\n\", React.createElement(_components.p, null, \"接着，需要判断鼠标当前悬浮的元素是否为可预览的作品，如果是则显示预览。观察 DOM 节点：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/e23c9d6ac90d75299fec98ea1cfe8de9/d073d/hovered-illust.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 57.05128205128205%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdklEQVR42m2SS2sTURiGsxHdSC+p1iRNm15IJslkMpM5k2TSZDKTaXpJbaVI0ZULL91IFxURiuBKdNFFd0UXCiKIIILQigsRusrvqG68gIuCy5THM6ktoh14OHOYM+/5vvd7Q7lcDrtSwRIWY2NjjI6OHpNIJBgZGSGVSqEoyjGpZApRyePNODQ9k4WpAi3fpFrNEdJ1nYbnYdt29+fh4bhc43Id7u7j8fj/gnJvllVqjodTn6JZr9GatDCFFIxGo/JQCkM38FyfWs2TN3n4/hRCCGKxGMlksityRFJWqFsZClYFYXuUijYVq4woZAkdtbZ6e5VvX3/y+csP9va+s7//i52dbQYHB1FVFU3TCOw5Qtg5SmYBt2zjlIuIUhXT0giNj48TiURZWblF8BwcdOh0Ot33drvdFcxms13RvwlaNkyBP71Ic/4y3twyFc8lFPgUDvczNbfIi7efePb6PU9ffeDBo00uzrcILPm35QCtkCSvF/BbyzjeLNN1H9cpE4pL8wfCfZS8Bdaf7HJnc5v7Wx9xL93gzOlTDJ0wlIC8lcZQFZyiYFKYNM0M1WImqDDBQH8vtdkr3NvaZW3jDRsv2yxdW6O/r7db4UmCmlDQNR3b0CnlpceZLLl8mlDgX7ivB1Ff4Objd9zd3OHh8zbL19fp7Tkr/Y2cEBuFQknBtCsY5SqGkcPQMghLTtmVGVSl6ROKSslfojIjPWldxSg6srrInxwmSafTh2QkUtSSuSvXbXlOleISkZFTVggFN05MTBAfihG9cI7I4AAXzvcTk2KJxGGkNNlaXWbU86clTRy3gd9cwG3MUq25uPJbtdEi31jiN91meok3JPzJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"作品 DOM 节点\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/e23c9d6ac90d75299fec98ea1cfe8de9/39c09/hovered-illust.png\\\"\\n        srcset=\\\"/static/e23c9d6ac90d75299fec98ea1cfe8de9/680fe/hovered-illust.png 156w,\\n/static/e23c9d6ac90d75299fec98ea1cfe8de9/17474/hovered-illust.png 312w,\\n/static/e23c9d6ac90d75299fec98ea1cfe8de9/39c09/hovered-illust.png 624w,\\n/static/e23c9d6ac90d75299fec98ea1cfe8de9/6d2da/hovered-illust.png 936w,\\n/static/e23c9d6ac90d75299fec98ea1cfe8de9/5a791/hovered-illust.png 1248w,\\n/static/e23c9d6ac90d75299fec98ea1cfe8de9/d073d/hovered-illust.png 1297w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"如果当前鼠标悬浮在可预览的作品 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 元素上，则本身包含了访问链接的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">src</code>\"\n    }\n  }), \" 属性，通过简单的正则表达式处理即可获取作品的 Pixiv ID 和大图链接。同时，外层还包裹着一层 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;a></code>\"\n    }\n  }), \" 元素，包含跳转链接。\"), \"\\n\", React.createElement(_components.p, null, \"考虑到部分 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 元素虽然包含作品缩略图的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">src</code>\"\n    }\n  }), \" 属性，但跳转的页面并不一定是作品页本身（\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">https://www.pixiv.net/artworks/artwork-id</code>\"\n    }\n  }), \"），即可能只是作为封面打开别的页面，鼠标悬浮在这些 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 元素上时不应当显示预览。因此笔者实现的判断方法是：统一取当前悬浮元素的第一个父 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;a></code>\"\n    }\n  }), \" 节点，当其 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">href</code>\"\n    }\n  }), \" 值满足 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/\\\\/artworks\\\\/(\\\\d+)/</code>\"\n    }\n  }), \" 时，显示预览：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">getIllustMetadata</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>target<span class=\\\"token operator\\\">:</span> JQuery<span class=\\\"token operator\\\">&lt;</span>HTMLElement<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> imgLink <span class=\\\"token operator\\\">=</span> target<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">while</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>imgLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">is</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"A\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    imgLink <span class=\\\"token operator\\\">=</span> imgLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">parent</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>imgLink<span class=\\\"token punctuation\\\">.</span>length<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> illustHref <span class=\\\"token operator\\\">=</span> imgLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">attr</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> illustHrefMatch <span class=\\\"token operator\\\">=</span> illustHref<span class=\\\"token operator\\\">?.</span><span class=\\\"token function\\\">match</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token regex\\\"><span class=\\\"token regex-delimiter\\\">/</span><span class=\\\"token regex-source language-regex\\\">\\\\/artworks\\\\/(\\\\d+)</span><span class=\\\"token regex-delimiter\\\">/</span></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>illustHrefMatch<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">const</span> illustId <span class=\\\"token operator\\\">=</span> illustHrefMatch<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> ugoiraSvg <span class=\\\"token operator\\\">=</span> imgLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">children</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"div:first\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"svg:first\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> illustType <span class=\\\"token operator\\\">=</span>\\n    ugoiraSvg<span class=\\\"token punctuation\\\">.</span>length <span class=\\\"token operator\\\">||</span> imgLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">hasClass</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"ugoku-illust\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token operator\\\">?</span> IllustType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">UGOIRA</span> <span class=\\\"token comment\\\">// 动图作品</span>\\n      <span class=\\\"token operator\\\">:</span> IllustType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">ILLUST</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 插画或漫画作品</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">/** 作品 ID */</span>\\n    illustId<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token comment\\\">/** 作品类型 */</span>\\n    illustType<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">onMouseOverIllust</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>target<span class=\\\"token operator\\\">:</span> JQuery<span class=\\\"token operator\\\">&lt;</span>HTMLElement<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> illustId<span class=\\\"token punctuation\\\">,</span> illustType <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">getIllustMetadata</span><span class=\\\"token punctuation\\\">(</span>target<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function\\\">previewIllust</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> target<span class=\\\"token punctuation\\\">,</span> illustId<span class=\\\"token punctuation\\\">,</span> illustType <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"插画或漫画作品可能存在多页，处理时可以始终调用 Pixiv 官方的接口 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/ajax/illust/${artwork-id}/pages</code>\"\n    }\n  }), \"，获取指定作品包含的所有链接。\"), \"\\n\", React.createElement(_components.p, null, \"再修修补补，为事件加上节流函数，响应鼠标滚动切换页数等，实现了和原版并无二异的预览能力：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/d209c773392509f97e2c18c952a1edac/04784/previewer.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 75.64102564102564%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEDUlEQVR42i2U20/TZxjHe4WHuAud0+Eo9AD2SJG29CQVKPTXc38UyqEtXWk5jJNVKAgSQU2ceJhbZF5MzWaii5IsqFmyZJEtokbd4qKbW1yiu1+WXbj/4LM3xotvnvfm/TyH75NHUVlZSUVFBUqlkkohlVrLO1u3s3nTJjZs2EBZWRkbN26k7O17y5YtbN68iR07d7Br1wdse28nKpWKqqqqN1JotVpMJhM6vR6NRk1FpQp1jQ6TYTc11Rr0NdVYzAbcVht7dptwWkQ0mDDUGKk1GdFqNG9AKtVboMVSSyLRjuSX0Ov0VO/W0ypJFDK99PUkhTrp7+hE9oVodPmwWxtJNMYY6hxgtj9PJCihVlej0xlQa6tRmIwG5HCASGsbLQ1e4k1+2uU4g5kecqluPkx1Md7RQ1DAbK5m6m0ePPUuFp1RJvsyBGMJ8oURVq5cIRhNoLDX1TKWSRJuaSHS2IK13kFHPEYxl2JUaDibYmIgi8/bzGiih/nCELLDT9LsoUskHh4YZKY4xe2rlynuHxXAWiNZqYlmm5MGAau1ukm1yxwZzjIpQBPZNMV8H/FAmExbnIPpDCGvD4PFgWNvE7OlGU7PzbOvKUSiK4nCabdxoHSEowdK5KIRWoMia2+SRQGcKWRERRk+6ozj2mOnTm9jSI4RaG7BKUZgtFiZmDvKg7XvWTp1hu7eXlGhzUZXXx57gxuHMMiyx0pBAM4WCyyNF5jskXGbzNRrjNTrLDR5vBiNddjFHCVhlNMXIBoJE5LaMJvNwmWDAZtYC2WlErVYgW073qfD38KRrMxUd4x0KEZbawyXyYqz1kU+m8fhcAu395JO5qhr8FChrEKp0or/WhSNXi9319e5du0abpeT4yc+ptDdweF0nJDbLdoLkQvHWZ4+SNwfp00YZ7facXraCEgJinNnWFt/yc07fzJ1bBlFMBji9ev/ePnqFYsLC9x/9JghsX8TXTKpcISYT2IqFmL12Cynpqdodu9Fo7ewzxfF0yQxXJikNHGSh/f+4uSFGyjCoRD//vM3K9evU8jn+fmXp4xkUpQyXSwO5Lg8P8NgIMiCHObW4iG+/ewTjDozbo8P2R+lPzPKpdkFHt35iU8/vyqAkSiPf39FcyDCpYtf8OTpr5xZOsHFw0XmM92cGOxnIpWmPxDg/FCOZ7dXkaUw5w4fIt3eQ7YwzfJYkWfrT1j55jYKq83OSGmegdH9jI2OEI7JHD92lLUbX7J68TwX5kssDA/R5/cR93r4Y+07frt3l+c/rrG8dJJQMove0ECivZu4LKOoMxvZ52pAr9dRJS7P1ne3c/rcOV68eM6Dh/f54dZ1To8VmC7k6AhJzIxPMjg8x/iBJb7+6iYDwvXy8p3i8pSLWM7/w8ZTI132ipsAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"Pixiv 预览\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/d209c773392509f97e2c18c952a1edac/39c09/previewer.png\\\"\\n        srcset=\\\"/static/d209c773392509f97e2c18c952a1edac/680fe/previewer.png 156w,\\n/static/d209c773392509f97e2c18c952a1edac/17474/previewer.png 312w,\\n/static/d209c773392509f97e2c18c952a1edac/39c09/previewer.png 624w,\\n/static/d209c773392509f97e2c18c952a1edac/6d2da/previewer.png 936w,\\n/static/d209c773392509f97e2c18c952a1edac/04784/previewer.png 1174w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"可喜可贺，可喜可贺！\"), \"\\n\", React.createElement(_components.h2, null, \"排序功能重构与优化\"), \"\\n\", React.createElement(_components.p, null, \"原脚本的预览功能已经能够非常好地实现笔者需要的能力了，笔者想要在此基础上加入一些额外的能力或做一些优化。\"), \"\\n\", React.createElement(_components.p, null, \"其实最开始的原动力来自于原脚本在某次更新以后，排序功能突然变得很慢，过去笔者一次性喜欢排序 20 页作品再挑选喜欢的，现在却要先等个二十分钟，还可能“中道崩殂”。后面看公告才了解到，Pixiv 从某天开始对来自于同 IP 的请求进行了限制，如果短时间内超过了请求的上限，则会暂时屏蔽请求。这点对于 Pixiv 来说无可厚非，能大大缓解像笔者这样的服务器蛀虫的“攻击”。\"), \"\\n\", React.createElement(_components.p, null, \"于是便开始了本以为无限期的咕咕咕，但最近代码写得手感火热，想到了这个坑，就花了几天填一填。同时也多接触接触原生 DOM 操作等小知识，百利无一害。\"), \"\\n\", React.createElement(_components.h3, null, \"请求作品分页\"), \"\\n\", React.createElement(_components.p, null, \"排序功能的本质就是同时请求多个分页，再获取每个作品的详细信息，最后在前端显示出来。下面以标签搜索结果的页面为例，实现排序功能。\"), \"\\n\", React.createElement(_components.p, null, \"对于不同的可排序页面，需要获取的要素有三：\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"请求分页的接口。\"), \"\\n\", React.createElement(_components.li, null, \"请求分页的参数。\"), \"\\n\", React.createElement(_components.li, null, \"作品的列表 DOM 节点。\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"使用观察法，在网络请求里找到分页的接口与默认的搜索参数：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">getSortOptionsFromPathname</span><span class=\\\"token punctuation\\\">(</span>pathname<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> type<span class=\\\"token operator\\\">:</span> IllustSortType<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> api<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> defaultSearchParams<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">let</span> match<span class=\\\"token operator\\\">:</span> RegExpMatchArray<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token punctuation\\\">(</span>match <span class=\\\"token operator\\\">=</span> pathname<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">match</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token regex\\\"><span class=\\\"token regex-delimiter\\\">/</span><span class=\\\"token regex-source language-regex\\\">\\\\/tags\\\\/(.+)\\\\/(artworks|illustrations|manga)$</span><span class=\\\"token regex-delimiter\\\">/</span></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> tagName <span class=\\\"token operator\\\">=</span> match<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> filterType <span class=\\\"token operator\\\">=</span> match<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">2</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">switch</span> <span class=\\\"token punctuation\\\">(</span>filterType<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">case</span> <span class=\\\"token string\\\">\\\"artworks\\\"</span><span class=\\\"token operator\\\">:</span>\\n        type <span class=\\\"token operator\\\">=</span> IllustSortType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">TAG_ARTWORK</span><span class=\\\"token punctuation\\\">;</span>\\n        api <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">/ajax/search/artworks/</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>tagName<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n        defaultSearchParams <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">word=</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>tagName<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">&amp;order=date_d&amp;mode=all&amp;p=1&amp;csw=0&amp;s_mode=s_tag_full&amp;type=all&amp;lang=zh</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword\\\">break</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">case</span> <span class=\\\"token string\\\">\\\"illustrations\\\"</span><span class=\\\"token operator\\\">:</span>\\n        type <span class=\\\"token operator\\\">=</span> IllustSortType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">TAG_ILLUST</span><span class=\\\"token punctuation\\\">;</span>\\n        api <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">/ajax/search/illustrations/</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>tagName<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n        defaultSearchParams <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">word=</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>tagName<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">&amp;order=date_d&amp;mode=all&amp;p=1&amp;csw=0&amp;s_mode=s_tag_full&amp;type=illust_and_ugoira&amp;lang=zh</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword\\\">break</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">case</span> <span class=\\\"token string\\\">\\\"manga\\\"</span><span class=\\\"token operator\\\">:</span>\\n        type <span class=\\\"token operator\\\">=</span> IllustSortType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">TAG_MANGA</span><span class=\\\"token punctuation\\\">;</span>\\n        api <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">/ajax/search/manga/</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>tagName<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n        defaultSearchParams <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">word=</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>tagName<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">&amp;order=date_d&amp;mode=all&amp;p=1&amp;csw=0&amp;s_mode=s_tag_full&amp;type=manga&amp;lang=zh</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword\\\">break</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    type<span class=\\\"token punctuation\\\">,</span>\\n    api<span class=\\\"token punctuation\\\">,</span>\\n    searchParams<span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">URLSearchParams</span><span class=\\\"token punctuation\\\">(</span>defaultSearchParams<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"当用户在前端设置搜索条件的时候，搜索条件会自动追加到当前的 Search Params 上。脚本在处理的时候，也应该读取 Search Params，再与方法 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">getSortOptionsFromPathname()</code>\"\n    }\n  }), \" 得到的默认 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">searchParams</code>\"\n    }\n  }), \" 进行合并，让接口请求符合用户预期：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">const</span> url <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\"><span class=\\\"token constant\\\">URL</span></span><span class=\\\"token punctuation\\\">(</span>location<span class=\\\"token punctuation\\\">.</span>href<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> pathname<span class=\\\"token punctuation\\\">,</span> searchParams <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> url<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span>\\n  type<span class=\\\"token punctuation\\\">,</span>\\n  api<span class=\\\"token punctuation\\\">,</span>\\n  searchParams<span class=\\\"token operator\\\">:</span> defaultSearchParams<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">getSortOptionsFromPathname</span><span class=\\\"token punctuation\\\">(</span>pathname<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> mergedSearchParams <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">URLSearchParams</span><span class=\\\"token punctuation\\\">(</span>defaultSearchParams<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nsearchParams<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>value<span class=\\\"token punctuation\\\">,</span> key<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// 相同参数覆盖，不同参数追加</span>\\n  mergedSearchParams<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">set</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token punctuation\\\">,</span> value<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"接着，获取陈列作品的列表 DOM 节点：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">getIllustrationsListDom</span><span class=\\\"token punctuation\\\">(</span>type<span class=\\\"token operator\\\">:</span> IllustSortType<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> dom<span class=\\\"token operator\\\">:</span> JQuery<span class=\\\"token operator\\\">&lt;</span>HTMLUListElement<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token punctuation\\\">[</span>\\n      IllustSortType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">TAG_ARTWORK</span><span class=\\\"token punctuation\\\">,</span>\\n      IllustSortType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">TAG_ILLUST</span><span class=\\\"token punctuation\\\">,</span>\\n      IllustSortType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">TAG_MANGA</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">includes</span><span class=\\\"token punctuation\\\">(</span>type<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    dom <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">$</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"ul.sc-ad8346e6-1.iwHaa-d\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>dom<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">return</span> dom<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">throw</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Error</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Illustrations list DOM not found.</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"Pixiv 的前端使用了 CSS Module 技术来生成样式名，能够有效避免同名样式冲突的问题。但是对于脚本开发者来说会增加一定的维护成本 —— 每次 Pixiv 的样式改变而重新构建样式文件时，需要手动更新脚本里对应的样式名，以正确找到目标节点。\"), \"\\n\", React.createElement(_components.p, null, \"因此在实现里，当脚本寻找节点失败时，会抛出一个错误，阻止脚本的继续运行。作为开发者，在碰到这样的问题时，就得赶紧更新脚本，或者想一想有没有更好的方式能定位此节点（例如搜索包含 60 个子元素的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">ul</code>\"\n    }\n  }), \" 节点 🤔）。\"), \"\\n\", React.createElement(_components.h3, null, \"获取作品详细信息\"), \"\\n\", React.createElement(_components.p, null, \"为了获取作品的收藏数据以排序，需要通过另外的接口获取作品的详细信息（如果请求分页的时候，响应值就把作品的收藏数带上就好了……）。\"), \"\\n\", React.createElement(_components.p, null, \"这里直接沿用了原作者使用的接口 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/touch/ajax/illust/details?illust_id=${id}</code>\"\n    }\n  }), \"：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">getIllustrationDetailsWithCache</span><span class=\\\"token punctuation\\\">(</span>id<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> illustDetails<span class=\\\"token operator\\\">:</span> IllustrationDetails <span class=\\\"token operator\\\">=</span>\\n    <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">getCachedIllustrationDetails</span><span class=\\\"token punctuation\\\">(</span>id<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>illustDetails<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    iLog<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">d</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Use cached details for illustration </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>id<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span> illustDetails<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> requestUrl <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">/touch/ajax/illust/details?illust_id=</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>id<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> getIllustDetailsRes <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">requestWithRetry</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n      url<span class=\\\"token operator\\\">:</span> requestUrl<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token function-variable function\\\">onRetry</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">(</span>response<span class=\\\"token punctuation\\\">,</span> retryTimes<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n        iLog<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">w</span><span class=\\\"token punctuation\\\">(</span>\\n          <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Get illustration details through \\\\`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>requestUrl<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\\\` failed:</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span>\\n          response<span class=\\\"token punctuation\\\">,</span>\\n          <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>retryTimes<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\"> times retrying...</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    illustDetails <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>\\n      getIllustDetailsRes<span class=\\\"token punctuation\\\">.</span>response <span class=\\\"token keyword\\\">as</span> PixivStandardResponse<span class=\\\"token operator\\\">&lt;</span><span class=\\\"token punctuation\\\">{</span>\\n        illust_details<span class=\\\"token operator\\\">:</span> IllustrationDetails<span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">></span>\\n    <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>body<span class=\\\"token punctuation\\\">.</span>illust_details<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">cacheIllustrationDetails</span><span class=\\\"token punctuation\\\">(</span>illustDetails<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> illustDetails<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"在此基础上做了两个额外的工作。其一是缓存作品详细信息：对于发布时间超过 6 小时的作品，我们认为作品的收藏数变化率会趋于平稳，则将作品的详细信息缓存 12 小时。12 小时内再获取此作品的详细信息时，直接从 Indexed DB 里拿。省略 Indexed DB 初始化和错误处理等逻辑，核心实现如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token comment\\\">/** 缓存数据表名称 */</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">ILLUSTRATION_DETAILS_CACHE_TABLE_KEY</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"illustrationDetailsCache\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token comment\\\">/** 缓存过期时间 */</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">ILLUSTRATION_DETAILS_CACHE_TIME</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">1000</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">60</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">60</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">12</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 12 小时</span>\\n<span class=\\\"token comment\\\">/** 不添加缓存的新作品发布时间 */</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">NEW_ILLUSTRATION_NOT_CACHE_TIME</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">1000</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">60</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">60</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">6</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 6 小时</span>\\n\\n<span class=\\\"token comment\\\">/** 缓存作品详细信息 */</span>\\n<span class=\\\"token keyword\\\">const</span> cacheIllustrationDetails <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>\\n  illustration<span class=\\\"token operator\\\">:</span> IllustrationDetails<span class=\\\"token punctuation\\\">,</span>\\n  now<span class=\\\"token operator\\\">:</span> Date <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\"><span class=\\\"token builtin\\\">Promise</span><span class=\\\"token operator\\\">&lt;</span><span class=\\\"token keyword\\\">void</span><span class=\\\"token operator\\\">></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> cachedIllustrationDetailsObjectStore <span class=\\\"token operator\\\">=</span> db\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">transaction</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">ILLUSTRATION_DETAILS_CACHE_TABLE_KEY</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"readwrite\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">objectStore</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">ILLUSTRATION_DETAILS_CACHE_TABLE_KEY</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> createDate <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span>illustration<span class=\\\"token punctuation\\\">.</span>createDate<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>\\n      now<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getTime</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">-</span> createDate<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getTime</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">></span>\\n      <span class=\\\"token constant\\\">NEW_ILLUSTRATION_NOT_CACHE_TIME</span>\\n    <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// 作品发布超过一定时间，添加缓存</span>\\n      <span class=\\\"token keyword\\\">const</span> illustrationDetails<span class=\\\"token operator\\\">:</span> IllustrationDetailsCache <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">...</span>illustration<span class=\\\"token punctuation\\\">,</span>\\n        cacheDate<span class=\\\"token operator\\\">:</span> now<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token comment\\\">// 这里简单处理，如果数据库里已经包含缓存数据，则重新设置缓存过期时间为 12 小时</span>\\n      <span class=\\\"token comment\\\">// 当然，更合理的方式是存在时跳过，不重新设置缓存过期时间</span>\\n      <span class=\\\"token keyword\\\">const</span> addCachedIllustrationDetailsRequest <span class=\\\"token operator\\\">=</span>\\n        cachedIllustrationDetailsObjectStore<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">put</span><span class=\\\"token punctuation\\\">(</span>illustrationDetails<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">/** 获取作品详细信息缓存 */</span>\\n<span class=\\\"token keyword\\\">const</span> getCachedIllustrationDetails <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>id<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">,</span> now<span class=\\\"token operator\\\">:</span> Date <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\"><span class=\\\"token builtin\\\">Promise</span><span class=\\\"token operator\\\">&lt;</span>IllustrationDetailsCache <span class=\\\"token operator\\\">|</span> <span class=\\\"token keyword\\\">undefined</span><span class=\\\"token operator\\\">></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>resolve<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> cachedIllustrationDetailsObjectStore <span class=\\\"token operator\\\">=</span> db\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">transaction</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">ILLUSTRATION_DETAILS_CACHE_TABLE_KEY</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"readwrite\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">objectStore</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">ILLUSTRATION_DETAILS_CACHE_TABLE_KEY</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> getCachedIllustrationDetailsRequest <span class=\\\"token operator\\\">=</span>\\n      cachedIllustrationDetailsObjectStore<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">get</span><span class=\\\"token punctuation\\\">(</span>id<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    getCachedIllustrationDetailsRequest<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function-variable function\\\">onsuccess</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>event<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">const</span> illustrationDetails <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>\\n        event<span class=\\\"token punctuation\\\">.</span>target <span class=\\\"token keyword\\\">as</span> IDBRequest<span class=\\\"token operator\\\">&lt;</span>IllustrationDetailsCache <span class=\\\"token operator\\\">|</span> <span class=\\\"token keyword\\\">undefined</span><span class=\\\"token operator\\\">></span>\\n      <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>result<span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>illustrationDetails<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> cacheDate <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> illustrationDetails<span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>\\n          now<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getTime</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">-</span> cacheDate<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getTime</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">&lt;=</span>\\n          <span class=\\\"token constant\\\">ILLUSTRATION_DETAILS_CACHE_TIME</span>\\n        <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token comment\\\">// 缓存未过期，返回缓存结果</span>\\n          <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span>illustrationDetails<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"设置缓存的主要目的是减少被 Pixiv 限制请求的可能性，也便于开发测试。\"), \"\\n\", React.createElement(_components.p, null, \"第二个额外的工作是：为获取作品详细信息的请求添加错误重试机制，避免因 Pixiv 限制引起的排序功能失效。这一点通过封装请求方法实现：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">const</span> xmlHttpRequest <span class=\\\"token operator\\\">=</span> window<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">GM</span><span class=\\\"token punctuation\\\">.</span>xmlHttpRequest<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">/** 标准的请求方法 */</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">const</span> request <span class=\\\"token operator\\\">=</span> <span class=\\\"token operator\\\">&lt;</span>TContext <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">unknown</span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">(</span>\\n  options<span class=\\\"token operator\\\">:</span> Tampermonkey<span class=\\\"token punctuation\\\">.</span>Request<span class=\\\"token operator\\\">&lt;</span>TContext<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> headers<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">...</span>restOptions <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> options<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">xmlHttpRequest</span><span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TContext<span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n    responseType<span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"json\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token operator\\\">...</span>restOptions<span class=\\\"token punctuation\\\">,</span>\\n    headers<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n      referer<span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"https://www.pixiv.net/\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token operator\\\">...</span>headers<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">/** 封装了错误重试机制的请求方法 */</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">const</span> requestWithRetry <span class=\\\"token operator\\\">=</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">async</span> <span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TContext <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">unknown</span><span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span>\\n  options<span class=\\\"token operator\\\">:</span> Tampermonkey<span class=\\\"token punctuation\\\">.</span>Request<span class=\\\"token operator\\\">&lt;</span>TContext<span class=\\\"token operator\\\">></span> <span class=\\\"token operator\\\">&amp;</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">/** 重试间隔时间（ms） */</span>\\n    retryDelay<span class=\\\"token operator\\\">?</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">number</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token comment\\\">/** 最大重试次数 */</span>\\n    maxRetryTimes<span class=\\\"token operator\\\">?</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">number</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token comment\\\">/** 重试回调 */</span>\\n    onRetry<span class=\\\"token operator\\\">?</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">(</span>\\n      response<span class=\\\"token operator\\\">:</span> Tampermonkey<span class=\\\"token punctuation\\\">.</span>Response<span class=\\\"token operator\\\">&lt;</span>TContext<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">,</span>\\n      retryTimes<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">number</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token keyword\\\">void</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span>\\n    retryDelay <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">10000</span><span class=\\\"token punctuation\\\">,</span>\\n    maxRetryTimes <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">Infinity</span><span class=\\\"token punctuation\\\">,</span>\\n    onRetry<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token operator\\\">...</span>restOptions\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> options<span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">let</span> response<span class=\\\"token operator\\\">:</span> Tampermonkey<span class=\\\"token punctuation\\\">.</span>Response<span class=\\\"token operator\\\">&lt;</span>TContext<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> retryTimes <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">while</span> <span class=\\\"token punctuation\\\">(</span>retryTimes <span class=\\\"token operator\\\">&lt;</span> maxRetryTimes<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    response <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">request</span><span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TContext<span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span>restOptions<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>response<span class=\\\"token punctuation\\\">.</span>status <span class=\\\"token operator\\\">===</span> <span class=\\\"token number\\\">200</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">const</span> responseData <span class=\\\"token operator\\\">=</span> response<span class=\\\"token punctuation\\\">.</span>response <span class=\\\"token keyword\\\">as</span> PixivStandardResponse<span class=\\\"token operator\\\">&lt;</span><span class=\\\"token builtin\\\">unknown</span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>responseData<span class=\\\"token punctuation\\\">.</span>error<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">return</span> response<span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    retryTimes <span class=\\\"token operator\\\">+=</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n    onRetry<span class=\\\"token operator\\\">?.</span><span class=\\\"token punctuation\\\">(</span>response<span class=\\\"token punctuation\\\">,</span> retryTimes<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">pause</span><span class=\\\"token punctuation\\\">(</span>retryDelay<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">throw</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Error</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Request for </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>restOptions<span class=\\\"token punctuation\\\">.</span>url<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\"> failed: </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>response<span class=\\\"token punctuation\\\">.</span>responseText<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"在默认情况下，如果请求失败，那么会间隔 10s 重新发起相同请求，重试的次数无上限。直到请求获得成功响应值时，返回响应的结果。\"), \"\\n\", React.createElement(_components.p, null, \"最后，实现并发请求的能力：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">const</span> execLimitConcurrentPromises <span class=\\\"token operator\\\">=</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">async</span> <span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span><span class=\\\"token constant\\\">T</span><span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span>\\n  promises<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token builtin\\\">Promise</span><span class=\\\"token operator\\\">&lt;</span><span class=\\\"token constant\\\">T</span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n  limit <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">48</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> results<span class=\\\"token operator\\\">:</span> <span class=\\\"token constant\\\">T</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">let</span> index <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">executeNext</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>index <span class=\\\"token operator\\\">>=</span> promises<span class=\\\"token punctuation\\\">.</span>length<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">return</span> <span class=\\\"token builtin\\\">Promise</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> currentIndex <span class=\\\"token operator\\\">=</span> index<span class=\\\"token operator\\\">++</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> promises<span class=\\\"token punctuation\\\">[</span>currentIndex<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    results<span class=\\\"token punctuation\\\">[</span>currentIndex<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> result<span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">executeNext</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> initialPromises <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">Array</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">from</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token punctuation\\\">{</span> length<span class=\\\"token operator\\\">:</span> Math<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">min</span><span class=\\\"token punctuation\\\">(</span>limit<span class=\\\"token punctuation\\\">,</span> promises<span class=\\\"token punctuation\\\">.</span>length<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token function\\\">executeNext</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">await</span> <span class=\\\"token builtin\\\">Promise</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">all</span><span class=\\\"token punctuation\\\">(</span>initialPromises<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">return</span> results<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> getDetailedIllustrationPromises<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token builtin\\\">Promise</span><span class=\\\"token operator\\\">&lt;</span>IllustrationDetails<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span>\\n  <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">let</span> i <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span> i <span class=\\\"token operator\\\">&lt;</span> illustrations<span class=\\\"token punctuation\\\">.</span>length<span class=\\\"token punctuation\\\">;</span> i <span class=\\\"token operator\\\">+=</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  getDetailedIllustrationPromises<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">push</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> illustration <span class=\\\"token operator\\\">=</span> illustrations<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> illustrationId <span class=\\\"token operator\\\">=</span> illustration<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> illustrationDetails <span class=\\\"token operator\\\">=</span>\\n      <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">getIllustrationDetailsWithCache</span><span class=\\\"token punctuation\\\">(</span>illustrationId<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token operator\\\">...</span>illustration<span class=\\\"token punctuation\\\">,</span>\\n      bookmark_user_total<span class=\\\"token operator\\\">:</span> illustrationDetails<span class=\\\"token punctuation\\\">.</span>bookmark_user_total<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">as</span> IllustrationDetails<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token keyword\\\">const</span> detailedIllustrations <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">execLimitConcurrentPromises</span><span class=\\\"token punctuation\\\">(</span>\\n  getDetailedIllustrationPromises<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"在默认情况下，脚本会发起至多 48 个获取作品详细信息的并发请求，提升排序功能的处理效率。而且经测试，并发能在一定程度上“绕过”风控机制，至少在首次完成排序时，不会被限制请求。只是结束后，Pixiv 的服务器“反应过来”了，就会被关几分钟小黑屋了 😿。\"), \"\\n\", React.createElement(_components.p, null, \"关于并发请求功能，值得补充的一点是，由于 \", React.createElement(_components.a, {\n    href: \"https://github.com/w3c/webextensions/issues/694\"\n  }, \"Chrome MV3 issue\"), \"，笔者参考原作者的处理，引入了修复脚本 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">https://update.greasyfork.org/scripts/515994/1478507/gh_2215_make_GM_xhr_more_parallel_again.js</code>\"\n    }\n  }), \" 使得并行请求功能生效。\"), \"\\n\", React.createElement(_components.h3, null, \"前端展示作品\"), \"\\n\", React.createElement(_components.p, null, \"根据条件过滤作品和排序作品的过程跳过不表，直接来到最后展示作品的环节！\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">IllustrationsSorter</span> <span class=\\\"token punctuation\\\">{</span>\\n  type<span class=\\\"token operator\\\">:</span> IllustSortType<span class=\\\"token punctuation\\\">;</span>\\n  illustrations<span class=\\\"token operator\\\">:</span> IllustrationDetails<span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n  listElement<span class=\\\"token operator\\\">:</span> JQuery<span class=\\\"token operator\\\">&lt;</span>HTMLUListElement<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token function\\\">constructor</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// ...</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">showIllustrations</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">showIllustrations</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> fragment <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createDocumentFragment</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span>\\n      aiType<span class=\\\"token punctuation\\\">,</span>\\n      alt<span class=\\\"token punctuation\\\">,</span>\\n      bookmarkData<span class=\\\"token punctuation\\\">,</span>\\n      bookmark_user_total<span class=\\\"token punctuation\\\">,</span>\\n      id<span class=\\\"token punctuation\\\">,</span>\\n      illustType<span class=\\\"token punctuation\\\">,</span>\\n      pageCount<span class=\\\"token punctuation\\\">,</span>\\n      profileImageUrl<span class=\\\"token punctuation\\\">,</span>\\n      tags<span class=\\\"token punctuation\\\">,</span>\\n      title<span class=\\\"token punctuation\\\">,</span>\\n      url<span class=\\\"token punctuation\\\">,</span>\\n      userId<span class=\\\"token punctuation\\\">,</span>\\n      userName<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">of</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>illustrations<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">const</span> isUgoira <span class=\\\"token operator\\\">=</span> illustType <span class=\\\"token operator\\\">===</span> IllustType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">UGOIRA</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> listItem <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"li\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> container <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"div\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      container<span class=\\\"token punctuation\\\">.</span>style <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"width: 184px;\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> illustrationAnchor <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAnchor<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"data-gtm-value\\\"</span><span class=\\\"token punctuation\\\">,</span> id<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAnchor<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"data-gtm-user-id\\\"</span><span class=\\\"token punctuation\\\">,</span> userId<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAnchor<span class=\\\"token punctuation\\\">.</span>href <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">/artworks/</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>id<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAnchor<span class=\\\"token punctuation\\\">.</span>target <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"_blank\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAnchor<span class=\\\"token punctuation\\\">.</span>rel <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"external\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAnchor<span class=\\\"token punctuation\\\">.</span>style <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token string\\\">\\\"display: block; position: relative; width: 184px;\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> illustrationImageWrapper <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"div\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationImageWrapper<span class=\\\"token punctuation\\\">.</span>style <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token string\\\">\\\"position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> illustrationImage <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"img\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationImage<span class=\\\"token punctuation\\\">.</span>src <span class=\\\"token operator\\\">=</span> url<span class=\\\"token punctuation\\\">;</span>\\n      illustrationImage<span class=\\\"token punctuation\\\">.</span>alt <span class=\\\"token operator\\\">=</span> alt<span class=\\\"token punctuation\\\">;</span>\\n      illustrationImage<span class=\\\"token punctuation\\\">.</span>style <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token string\\\">\\\"object-fit: cover; object-position: center center; width: 100%; height: 100%; border-radius: 4px; background-color: rgb(31, 31, 31);\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> ugoriaSvg <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"div\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      ugoriaSvg<span class=\\\"token punctuation\\\">.</span>style <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"position: absolute;\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n      ugoriaSvg<span class=\\\"token punctuation\\\">.</span>innerHTML <span class=\\\"token operator\\\">=</span> playIcon<span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> illustrationMeta <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"div\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationMeta<span class=\\\"token punctuation\\\">.</span>style <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token string\\\">\\\"position: absolute; top: 0px; left: 0px; right: 0px; display: flex; align-items: flex-start; padding: 4px 4px 0; pointer-events: none; font-size: 10px;\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationMeta<span class=\\\"token punctuation\\\">.</span>innerHTML <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">\\n          </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>\\n            pageCount <span class=\\\"token operator\\\">></span> <span class=\\\"token number\\\">1</span>\\n              <span class=\\\"token operator\\\">?</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">\\n                &lt;div style=\\\"margin-left: auto;\\\">\\n                  &lt;div style=\\\"display: flex; justify-content: center; align-items: center; height: 20px; min-width: 20px; color: rgb(245, 245, 245); font-weight: bold; padding: 0px 6px; background: rgba(0, 0, 0, 0.32); border-radius: 10px; line-height: 10px;\\\">\\n                    </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>pageIcon<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n                    &lt;span></span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>pageCount<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">&lt;/span>\\n                  &lt;/div>\\n                &lt;/div></span><span class=\\\"token template-punctuation string\\\">`</span></span>\\n              <span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"\\\"</span>\\n          <span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n        </span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> illustrationToolbar <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"div\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationToolbar<span class=\\\"token punctuation\\\">.</span>style <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token string\\\">\\\"position: absolute; top: 154px; left: 0px; right: 0px; display: flex; align-items: center; padding: 0 4px 4px; pointer-events: none; font-size: 12px;\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token comment\\\">// Mock: 暂未实现点击爱心收藏 / 取消收藏的功能</span>\\n      illustrationToolbar<span class=\\\"token punctuation\\\">.</span>innerHTML <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">\\n          &lt;div style=\\\"padding: 0px 4px; border-radius: 4px; color: rgb(245, 245, 245); background: </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>bookmark_user_total <span class=\\\"token operator\\\">></span> <span class=\\\"token number\\\">50000</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">\\\"#9f1239\\\"</span> <span class=\\\"token operator\\\">:</span> bookmark_user_total <span class=\\\"token operator\\\">></span> <span class=\\\"token number\\\">10000</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">\\\"#dc2626\\\"</span> <span class=\\\"token operator\\\">:</span> bookmark_user_total <span class=\\\"token operator\\\">></span> <span class=\\\"token number\\\">5000</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">\\\"#1d4ed8\\\"</span> <span class=\\\"token operator\\\">:</span> bookmark_user_total <span class=\\\"token operator\\\">></span> <span class=\\\"token number\\\">1000</span> <span class=\\\"token operator\\\">?</span> <span class=\\\"token string\\\">\\\"#15803d\\\"</span> <span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"#475569\\\"</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">; font-weight: bold; line-height: 16px; user-select: none;\\\">❤ </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>bookmark_user_total<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">&lt;/div>\\n          &lt;div style=\\\"margin-left: auto;\\\"></span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>bookmarkData <span class=\\\"token operator\\\">?</span> heartFilledIcon <span class=\\\"token operator\\\">:</span> heartIcon<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">&lt;/div>\\n        </span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> illustrationTitle <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"div\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationTitle<span class=\\\"token punctuation\\\">.</span>innerHTML <span class=\\\"token operator\\\">=</span> title<span class=\\\"token punctuation\\\">;</span>\\n      illustrationTitle<span class=\\\"token punctuation\\\">.</span>style <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token string\\\">\\\"margin-top: 4px; max-width: 100%; overflow: hidden; text-decoration: none; text-overflow: ellipsis; white-space: nowrap; line-height: 22px; font-size: 14px; font-weight: bold; color: rgb(245, 245, 245); transition: color 0.2s;\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> illustrationAuthor <span class=\\\"token operator\\\">=</span> document<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createElement</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"a\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAuthor<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setAttribute</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"data-gtm-value\\\"</span><span class=\\\"token punctuation\\\">,</span> userId<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAuthor<span class=\\\"token punctuation\\\">.</span>href <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">/users/</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>userId<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAuthor<span class=\\\"token punctuation\\\">.</span>target <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"_blank\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAuthor<span class=\\\"token punctuation\\\">.</span>rel <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"external\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAuthor<span class=\\\"token punctuation\\\">.</span>style <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token string\\\">\\\"display: flex; align-items: center; margin-top: 4px;\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAuthor<span class=\\\"token punctuation\\\">.</span>innerHTML <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">\\n          &lt;img src=\\\"</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>profileImageUrl<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\\" alt=\\\"</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>userName<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\\" style=\\\"object-fit: cover; object-position: center top; width: 24px; height: 24px; border-radius: 50%; margin-right: 4px;\\\">\\n          &lt;span style=\\\"min-width: 0px; line-height: 22px; font-size: 14px; color: rgb(214, 214, 214); text-decoration: none; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;\\\"></span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>userName<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">&lt;/span>\\n        </span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n\\n      illustrationImageWrapper<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>illustrationImage<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>isUgoira<span class=\\\"token punctuation\\\">)</span> illustrationImageWrapper<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>ugoriaSvg<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAnchor<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>illustrationImageWrapper<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAnchor<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>illustrationMeta<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAnchor<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>illustrationToolbar<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      illustrationAnchor<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>illustrationTitle<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      container<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>illustrationAnchor<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      container<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>illustrationAuthor<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      listItem<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>container<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      fragment<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">appendChild</span><span class=\\\"token punctuation\\\">(</span>listItem<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>listElement<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"li\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">remove</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>listElement<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span>fragment<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"在上面的代码里，笔者参考 Pixiv 作品节点的 DOM，手动构造了大抵一致的作品节点，尽管部分功能缺失，但能够满足排序作品的需要。笔者也考虑过克隆原生节点再修改 DOM 节点里的属性会否更好，但是忧心前端版本更新导致 DOM 节点结构更新，以及担心不同页面的 DOM 节点结构不同，所以还是人工捏出来了通用节点。\"), \"\\n\", React.createElement(_components.p, null, \"最后，在想要排序的页面点击按钮，看看大家都爱什么作品吧！\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/be9f1a3c00840825cac5255fe57fc2a0/c2d13/sorting-result.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 48.07692307692307%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACvUlEQVR42iWS20uTYQDG938klWIsy7l52Fz7vm8ndd++bZW5rdzmjjl1alqabNkJCrQo6IBGZgeiE1h0MA9FUVQG3mQH6MISopsugoK66PbX23rh4eW9+fE87/PoWiMxvJqPisoa9EaZqlordocTxeFA8/nxqCqK4kBVNSwWC3a7gyaPF1myYTabkRUFt8uFVG+hzmxBt7zyhTcfPtI5eIIjpx6SHTzGrZt3OHT8LGfO3eTW1Smm783y7v0yiUSSGpMJj9eHw+VmfcUGqmtqcbqcVG7cgF6vRzd+6SL7jx5n18h5CiOTaOEku3YPs3lbG6FUD4lojsOjo4yPT9Lc3My6dXq2amZ6U1aioXpUn4Tml/D4bEiyCV083obPq7KzPUM6nSYYbCGVyRDeHiKX6xbvEIl0kr7+PtxuN2Vl5WgNBjpjtbQGLXj9MmpAQd3iEPGr0T2dfsbTh3M8n3nMh1dLPHowy6/vP5mZnmNh9hVzt+e5f+06f378JpXaSUnJagKeanIJMxHhUAvIeIVUAZb/OZycGGPizCl6+gYY6NnHgYMHuHblMnv69zDYN8hA7xAHhwvcvTFVLGjN2jJ8jQY6oiYiwTp8ARvaZqkIVRQBTCYzxNoSpDMpEbGLaCxGl4gaiUQZKuTJdXeR6ciSF1Cr1Uppaalo3EG6vU38XyOKU6zCZcPuljBbBPDF4hNeLr5m4dkLvn5aYX5mnoXp51yduMK35c8sLb5l9v4j/p3WHa2sKlkl5iOiejUxHRmb7b8kScFoFMBDJ3sZGt7NUL5Af26Avfk8+Y5ucpl2xk6fZuTIKIXhfVwcu4C1/r/DhoYGstls8TZbNmEVQKvNTpVRlJJIxAmHwmwLBtkeDiO7vdQ5/bjVAC3hIE1NTTSHWojH49SJzZWXlxej+/3+4tArNlZiqDIKmTAYDPwFJUSr3PaCuo0AAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"排序包含“天童爱丽丝”标签的作品\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/be9f1a3c00840825cac5255fe57fc2a0/39c09/sorting-result.png\\\"\\n        srcset=\\\"/static/be9f1a3c00840825cac5255fe57fc2a0/680fe/sorting-result.png 156w,\\n/static/be9f1a3c00840825cac5255fe57fc2a0/17474/sorting-result.png 312w,\\n/static/be9f1a3c00840825cac5255fe57fc2a0/39c09/sorting-result.png 624w,\\n/static/be9f1a3c00840825cac5255fe57fc2a0/6d2da/sorting-result.png 936w,\\n/static/be9f1a3c00840825cac5255fe57fc2a0/5a791/sorting-result.png 1248w,\\n/static/be9f1a3c00840825cac5255fe57fc2a0/c2d13/sorting-result.png 2560w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.h2, null, \"最后\"), \"\\n\", React.createElement(_components.p, null, \"附上 \", React.createElement(_components.a, {\n    href: \"https://github.com/LolipopJ/PixivPreviewerL\"\n  }, \"Github 仓库地址\"), \"与 \", React.createElement(_components.a, {\n    href: \"https://greasyfork.org/zh-CN/scripts/533844\"\n  }, \"Tampermonkey 脚本地址\"), \"，希望对有类似需求的人带来一些帮助。\"));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import GATSBY_COMPILED_MDX from \"/home/runner/work/homepage/homepage/blog/posts/pixiv-previewer.mdx\";\nimport {Fancybox} from \"@fancyapps/ui\";\nimport {MDXProvider} from \"@mdx-js/react\";\nimport dayjs from \"dayjs\";\nimport {Link} from \"gatsby\";\nimport * as React from \"react\";\nimport Card from \"../components/card\";\nimport Category from \"../components/category\";\nimport SEO from \"../components/seo\";\nimport Tag from \"../components/tag\";\nconst FancyBoxImage = props => {\n  const {alt = \"The author is too lazy to give an alt\", src, ...restProps} = props;\n  return React.createElement(\"a\", {\n    href: src,\n    \"data-fancybox\": \"gallery\",\n    \"data-caption\": alt\n  }, React.createElement(\"img\", Object.assign({\n    src: src,\n    alt: alt\n  }, restProps)));\n};\nconst ALink = _ref => {\n  let {href = \"\", children} = _ref;\n  const isExternalHref = !(href !== null && href !== void 0 && href.startsWith(\"#\"));\n  const parsedHref = isExternalHref ? href : `#${encodeURIComponent(href.slice(1))}`;\n  return React.createElement(\"a\", {\n    href: parsedHref,\n    target: isExternalHref ? \"_blank\" : undefined,\n    rel: \"noreferrer\"\n  }, children);\n};\nconst components = {\n  a: ALink,\n  img: FancyBoxImage,\n  Card,\n  Link\n};\nconst PostTemplate = _ref2 => {\n  let {children, data} = _ref2;\n  const {mdx: {fields: {isDraft}, frontmatter: {title, date: dateString, updated: updatedDateString, categories, tags, timeliness}}} = data;\n  const articleRef = React.useRef(null);\n  const date = dayjs(dateString);\n  const updatedDate = updatedDateString ? dayjs(updatedDateString) : date;\n  const today = dayjs();\n  const diffDays = today.diff(updatedDate, \"days\");\n  React.useEffect(() => {\n    var _articleRef$current;\n    const optimizedImageLinks = (_articleRef$current = articleRef.current) === null || _articleRef$current === void 0 ? void 0 : _articleRef$current.querySelectorAll(\"a.gatsby-resp-image-link\");\n    optimizedImageLinks === null || optimizedImageLinks === void 0 ? void 0 : optimizedImageLinks.forEach(link => {\n      const image = link.children.item(1);\n      link.setAttribute(\"data-fancybox\", \"gallery\");\n      link.setAttribute(\"data-caption\", image.alt);\n    });\n    Fancybox.bind(\"[data-fancybox]\");\n    return () => Fancybox.unbind(\"[data-fancybox]\");\n  }, []);\n  return React.createElement(\"div\", {\n    className: \"mx-auto flex max-w-xl flex-col gap-y-12\"\n  }, React.createElement(\"div\", {\n    className: \"flex flex-col gap-4\"\n  }, (categories === null || categories === void 0 ? void 0 : categories.length) && React.createElement(Category, {\n    name: categories[0],\n    className: \"item-selectable\"\n  }), React.createElement(\"h1\", {\n    className: \"text-3xl font-bold\"\n  }, title), React.createElement(\"div\", {\n    className: \"item-secondary flex flex-col gap-2 lg:flex-row\"\n  }, dateString && React.createElement(\"span\", {\n    title: `首次发布于：${date.toString()}\\n最后更新于：${updatedDate.toString()}`\n  }, date.format(\"MM 月 DD 日 YYYY 年\")), (tags === null || tags === void 0 ? void 0 : tags.length) && React.createElement(\"div\", {\n    className: \"flex flex-1 flex-wrap gap-2 lg:before:content-['\\u2022']\"\n  }, tags.map(tag => React.createElement(Tag, {\n    key: tag,\n    name: tag,\n    className: \"item-secondary item-selectable\"\n  }))))), React.createElement(\"article\", {\n    ref: articleRef,\n    className: \"heti post-entry\"\n  }, isDraft && React.createElement(\"blockquote\", {\n    className: \"!border-red-400\"\n  }, \"\\u8FD9\\u662F\\u4E00\\u7BC7\", React.createElement(\"strong\", null, \"\\u672A\\u6B63\\u5F0F\\u53D1\\u5E03\"), \"\\u7684\\u535A\\u5BA2\\uFF0C\\u5185\\u5BB9\\u53EF\\u80FD\\u5C1A\\u672A\\u64B0\\u5199\\u5B8C\\u5168\\u6216\\u5B58\\u5728\\u4E00\\u4E9B\\u7EB0\\u6F0F\\uFF0C\\u5EFA\\u8BAE\\u60A8\\u4ED4\\u7EC6\\u8BC4\\u4F30\\u4FE1\\u606F\\u7684\\u6709\\u6548\\u6027\\u3002\"), timeliness !== false && diffDays > 365 && React.createElement(\"blockquote\", {\n    className: \"!border-orange-400\"\n  }, \"\\u8FD9\\u662F\\u4E00\\u7BC7\", React.createElement(\"strong\", null, \"\\u6700\\u540E\\u66F4\\u65B0\\u4E8E \", diffDays, \" \\u5929\\u524D\"), \"\\u7684\\u535A\\u5BA2\\uFF0C\\u5185\\u5BB9\\u53EF\\u80FD\\u968F\\u7740\\u65F6\\u95F4\\u7684\\u63A8\\u79FB\\u800C\\u53D8\\u5F97\\u4E0D\\u518D\\u9002\\u7528\\uFF0C\\u5EFA\\u8BAE\\u60A8\\u4ED4\\u7EC6\\u8BC4\\u4F30\\u4FE1\\u606F\\u7684\\u6709\\u6548\\u6027\\u3002\"), React.createElement(MDXProvider, {\n    components: components\n  }, children)));\n};\nconst query = \"2264136072\";\nexport const Head = _ref3 => {\n  let {data} = _ref3;\n  return React.createElement(SEO, {\n    title: String(data.mdx.frontmatter.title)\n  });\n};\nPostTemplate\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PostTemplate, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\n"],"names":["_createMdxContent","props","_components","Object","assign","p","ol","li","strong","a","h2","h3","span","blockquote","ul","_provideComponents","components","React","href","dangerouslySetInnerHTML","__html","wrapper","MDXLayout","_ref","children","isExternalHref","startsWith","parsedHref","encodeURIComponent","slice","target","undefined","rel","img","alt","src","restProps","Card","Link","PostTemplate","_ref2","data","mdx","fields","isDraft","frontmatter","title","date","dateString","updated","updatedDateString","categories","tags","timeliness","articleRef","dayjs","updatedDate","diffDays","diff","_articleRef$current","optimizedImageLinks","current","querySelectorAll","forEach","link","image","item","setAttribute","Fancybox","bind","unbind","className","length","Category","name","toString","format","map","tag","Tag","key","ref","MDXProvider","Head","_ref3","SEO","String","GatsbyMDXWrapper","GATSBY_COMPILED_MDX"],"sourceRoot":""}