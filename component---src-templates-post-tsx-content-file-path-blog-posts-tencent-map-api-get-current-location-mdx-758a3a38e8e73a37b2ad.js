"use strict";(self.webpackChunkhomepage=self.webpackChunkhomepage||[]).push([[5079],{8702:function(n,a,s){s.r(a),s.d(a,{Head:function(){return h},default:function(){return E}});var t=s(8453),e=s(6540);function p(n){const a=Object.assign({p:"p",a:"a",h2:"h2",span:"span",strong:"strong"},(0,t.R)(),n.components);return e.createElement(e.Fragment,null,e.createElement(a.p,null,"正在开发的 Web 项目需要获取使用者的位置信息，而使用者主要通过移动端访问此 Web 服务。位置信息需要精确到区。在腾讯位置服务的",e.createElement(a.a,{href:"https://lbs.qq.com/location/#anchor"},"定位解决方案"),"里想要搜索可用的 JavaScript 库，只看到了服务端的 IP 定位和移动端的几个 SDK 包，甚异之。"),"\n",e.createElement(a.p,null,"终于在不起眼的地方找到了",e.createElement(a.a,{href:"https://lbs.qq.com/webApi/component/componentGuide/componentGeolocation"},"前端定位组件"),"，适用于浏览器进行定位操作。"),"\n",e.createElement(a.p,null,"本文基于 Nuxt.js 实现前端定位功能。"),"\n",e.createElement(a.h2,null,"它能做什么"),"\n",e.createElement(a.p,null,"组件旨在优化纯 ",e.createElement(a.a,{href:"https://w3c.github.io/geolocation-api"},"HTML5 Geolocation")," 定位能力弱，定位成功率不高的问题，提供简单、易用的接口帮助业务层获取用户当前的位置信息（需用户授权），以降低开发成本，提升定位精准度。"),"\n",e.createElement(a.p,null,"除了常规的经纬度坐标以外，它返回的结果里还包含了 ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">city</code>'}})," 和 ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">district</code>'}})," 项，非常方面。"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>\n  <span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token string">"geolocation"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"h5_watch"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"adcode"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">//行政区 ID，六位数字, 前两位是省，中间是市，后面两位是区，比如深圳市 ID 为 440300</span>\n  <span class="token string-property property">"nation"</span><span class="token operator">:</span> <span class="token string">"美国"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"province"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"city"</span><span class="token operator">:</span> <span class="token string">"加利福尼亚州"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"district"</span><span class="token operator">:</span> <span class="token string">"洛杉矶县"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"addr"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"lat"</span><span class="token operator">:</span> <span class="token number">34.035244</span><span class="token punctuation">,</span> <span class="token comment">//火星坐标 (gcj02)，腾讯、Google、高德等地图通用</span>\n  <span class="token string-property property">"lng"</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">118.252207</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"accuracy"</span><span class="token operator">:</span> <span class="token number">1441</span> <span class="token comment">//误差范围，以米为单位</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"可惜相关页面的最后一次更新最近可能是在 ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">2016-02-23</code>'}}),"，文档撰写简陋不堪，只能在项目中慢慢试错使用。"),"\n",e.createElement(a.h2,null,"引入前端定位组件库"),"\n",e.createElement(a.p,null,"首先需要在腾讯位置服务的控制台添加应用，获得应用的 ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">key</code>'}}),"。"),"\n",e.createElement(a.p,null,"这里选择使用前端定位组件的",e.createElement(a.strong,null,"调用方式三"),"。"),"\n",e.createElement(a.p,null,"在 HTML 文件的中引入脚本，对应 Nuxt.js 应用中的 ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">nuxt.config.js</code>'}}),"："),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// nuxt.config.js</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token literal-property property">head</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">script</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"text/javascript"</span><span class="token punctuation">,</span>\n        <span class="token comment">// 引入腾讯地图前端定位组件</span>\n        <span class="token comment">// YOUR-APP-KEY 即腾讯位置服务应用的 key</span>\n        <span class="token comment">// YOUR-APP-NAME 即腾讯位置服务应用的名称</span>\n        <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">"https://apis.map.qq.com/tools/geolocation/min?key=YOUR-APP-KEY&amp;referer=YOUR-APP-NAME"</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"如果获取脚本失败，请关闭浏览器中拦截广告的插件等。"),"\n",e.createElement(a.p,null,"此外，由于用户的位置信息属于敏感信息，因此需要使用 ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">HTTPS</code>'}})," 的网页发送请求；如果在本机开发，请使用 ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">localhost:port</code>'}})," 的形式开发和访问。"),"\n",e.createElement(a.h2,null,"实现 Web 前端定位"),"\n",e.createElement(a.p,null,"编写代码如下："),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> geolocation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qq<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>Geolocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngeolocation<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span>\n  <span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 成功获取位置信息</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 将位置信息序列化存储在 localStorage 中</span>\n    <span class="token keyword">const</span> currentLocation <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token literal-property property">city</span><span class="token operator">:</span> position<span class="token punctuation">.</span>city<span class="token punctuation">,</span>\n      <span class="token literal-property property">district</span><span class="token operator">:</span> position<span class="token punctuation">.</span>district<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    localStorage<span class="token punctuation">.</span>currentLocation <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>currentLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 获取位置信息失败</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"执行代码，得到结果如下（其中 ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">*</code>'}})," 为我手动打码）："),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span>\n  <span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token string">"geolocation"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"h5"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"adcode"</span><span class="token operator">:</span> <span class="token string">"510117"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"nation"</span><span class="token operator">:</span> <span class="token string">"中国"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"province"</span><span class="token operator">:</span> <span class="token string">"四川省"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"city"</span><span class="token operator">:</span> <span class="token string">"成都市"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"district"</span><span class="token operator">:</span> <span class="token string">"郫都区"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"addr"</span><span class="token operator">:</span> <span class="token string">"***"</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"lat"</span><span class="token operator">:</span> <span class="token number">30.75</span><span class="token operator">**</span><span class="token operator">**</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"lng"</span><span class="token operator">:</span> <span class="token number">103.92</span><span class="token operator">**</span><span class="token operator">**</span><span class="token punctuation">,</span>\n  <span class="token string-property property">"accuracy"</span><span class="token operator">:</span> <span class="token number">113</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"定位成功精确到当前我所处的区和地址，满足项目开发要求。"),"\n",e.createElement(a.p,null,"其它相关方法和说明敬请参考",e.createElement(a.a,{href:"https://lbs.qq.com/webApi/component/componentGuide/componentGeolocation"},"官方文档"),"的“暗示”。"))}var o=function(n){void 0===n&&(n={});const{wrapper:a}=Object.assign({},(0,t.R)(),n.components);return a?e.createElement(a,n,e.createElement(p,n)):p(n)},c=s(197),l=s(4353),r=s.n(l),u=s(4810),i=s(6947),k=s(4017),g=s(1042),m=s(1038);const d={a:n=>{let{href:a="",children:s}=n;const t=!(null!=a&&a.startsWith("#")),p=t?a:`#${encodeURIComponent(a.slice(1))}`;return e.createElement("a",{href:p,target:t?"_blank":void 0,rel:"noreferrer"},s)},img:n=>{const{alt:a="The author is too lazy to give an alt",src:s,...t}=n;return e.createElement("a",{href:s,"data-fancybox":"gallery","data-caption":a},e.createElement("img",Object.assign({src:s,alt:a},t)))},Card:i.A,Link:u.N_},y=n=>{let{children:a,data:s}=n;const{mdx:{frontmatter:{title:p,date:o,updated:l,categories:u,tags:i,timeliness:g=!0}}}=s,y=e.useRef(null),h=r()(o),E=l?r()(l):h,f=r()().diff(E,"days");return e.useEffect((()=>{var n;const a=null===(n=y.current)||void 0===n?void 0:n.querySelectorAll("a.gatsby-resp-image-link");return null==a||a.forEach((n=>{const a=n.children.item(1);n.setAttribute("data-fancybox","gallery"),n.setAttribute("data-caption",a.alt)})),c.lX.bind("[data-fancybox]"),()=>c.lX.unbind("[data-fancybox]")}),[]),e.createElement("div",{className:"mx-auto flex max-w-xl flex-col gap-y-12"},e.createElement("div",{className:"flex flex-col gap-4"},(null==u?void 0:u.length)&&e.createElement(k.A,{name:u[0],className:"item-selectable"}),e.createElement("h1",{className:"text-3xl font-bold"},p),e.createElement("div",{className:"item-secondary flex flex-col gap-2 lg:flex-row"},o&&e.createElement("span",{title:`首次发布于：${h.toString()}\n最后更新于：${E.toString()}`},h.format("MM 月 DD 日 YYYY 年")),(null==i?void 0:i.length)&&e.createElement("div",{className:"flex flex-1 flex-wrap gap-2 lg:before:content-['•']"},i.map((n=>e.createElement(m.A,{key:n,name:n,className:"item-secondary item-selectable"})))))),e.createElement("article",{ref:y,className:"heti post-entry"},g&&f>365&&e.createElement("blockquote",{className:"border-l-4 border-orange-400"},"这是一篇",e.createElement("strong",null,"最后更新于 ",f," 天前"),"的博客，内容可能随着时间的推移而变得不再适用，建议您仔细评估信息的有效性。"),e.createElement(t.x,{components:d},a)))},h=n=>{let{data:a}=n;return e.createElement(g.A,{title:String(a.mdx.frontmatter.title)})};function E(n){return e.createElement(y,n,e.createElement(o,n))}}}]);
//# sourceMappingURL=component---src-templates-post-tsx-content-file-path-blog-posts-tencent-map-api-get-current-location-mdx-758a3a38e8e73a37b2ad.js.map