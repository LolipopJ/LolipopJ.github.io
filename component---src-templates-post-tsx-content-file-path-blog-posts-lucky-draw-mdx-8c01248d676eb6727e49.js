"use strict";(self.webpackChunkhomepage=self.webpackChunkhomepage||[]).push([[7562],{5499:function(n,a,s){s.r(a),s.d(a,{Head:function(){return y},default:function(){return h}});var t=s(8453),p=s(6540);function e(n){const a=Object.assign({h2:"h2",p:"p",strong:"strong",del:"del",span:"span",blockquote:"blockquote",img:"img",a:"a"},(0,t.R)(),n.components);return p.createElement(p.Fragment,null,p.createElement(a.h2,null,"为什么"),"\n",p.createElement(a.p,null,"前阵子面试的时候被问到这个问题，觉得挺有意思，于是决定亲手实现一个转盘抽奖组件试试。"),"\n",p.createElement(a.p,null,"翻看别人的实现方案时，发现和自己面试时答得相差很大，悲 😢。但总之，是时候开始弥补自己的 CSS 和动画技能了。"),"\n",p.createElement(a.h2,null,"是什么"),"\n",p.createElement(a.p,null,"一个转盘抽奖组件主要由三部分组成，写有中奖结果的圆形转盘、指向结果的指针和开始转动的按钮。"),"\n",p.createElement(a.p,null,"如果每个中奖结果的概率相近，我们可以按照真实概率来划分每个奖品所占圆形的扇形比例。但是通常转盘中会设置抽中概率极小的大奖，按照真实比例的话将无法充分展示奖品内容，而且降低用户对转盘抽奖本身的兴趣度。所以本文实现的转盘组件选择 ",p.createElement(a.strong,null,"均分的方式")," 来划分每个奖品所占的扇形比例，符合通用的原则，也从视觉上让用户觉得中奖概率相当。"),"\n",p.createElement(a.p,null,"转盘转动可以有两种方式，一种是指针不动转盘动，一种是转盘不动指针动，都能很好地表达转盘抽奖的过程。对比两种方式，前者的视觉体验会更佳，且指针可以放置在任意位置（在中间往上指或在左侧往右指等等都可以）；后者则相对含蓄一些，用户的视觉负担较低，但指针只能放在中间旋转（我设想了一下在转盘外侧做圆周运动，感觉也有点意思）。因此，本文的实现选择 ",p.createElement(a.strong,null,"指针不动转盘动")," 的方式，从前端开发的角度来说，实现了一种方式，另一种方式也可以简单实现了。"),"\n",p.createElement(a.p,null,"当我们点击开始转动的按钮时，转盘便会开始转动。现实生活中的转盘通常由人手力驱动，转盘的 ",p.createElement(a.strong,null,"转速会从零迅速加到最大，然后逐渐变小直至为零"),"。我们实现的转盘不受这些物理条件的限制，但对现实的充分模拟可以提升转盘抽奖的可信度，本文也将朝着这个方向实现。"),"\n",p.createElement(a.p,null,"当点击按钮时，前端即向后端请求了抽奖的结果，后续转盘的转动也不过是预设好的动画罢了。因此我们可以轻松地计算得到转盘应当旋转的角度，让指针恰恰好停留在奖品所在的扇形区域。这也意味着 ",p.createElement(a.strong,null,"转盘旋转的角度可以是一个范围"),"，指针并不一定指向扇形区域的正中间，这也是对现实实际的一个模拟。"),"\n",p.createElement(a.h2,null,"怎么做"),"\n",p.createElement(a.p,null,"在深入动画实现之前，让我们先完成 ",p.createElement(a.del,null,"简单的")," 前置工作，把转盘抽奖组件的三个必要组成部分画出来。"),"\n",p.createElement(a.p,null,"首先是圆形转盘："),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>turntable<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>turntable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>'}}),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="scss"><pre class="language-scss"><code class="language-scss"><span class="token selector">.container </span><span class="token punctuation">{</span>\n  <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>\n  <span class="token property">padding</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> #f8fafc<span class="token punctuation">;</span>\n  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>\n  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.turntable </span><span class="token punctuation">{</span>\n  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n  <span class="token property">width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>\n  <span class="token property">height</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>\n  <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Prize</span> <span class="token punctuation">{</span>\n  label<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n  probability<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n  bgColor<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> prizes<span class="token operator">:</span> Prize<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>\n  <span class="token punctuation">{</span> label<span class="token operator">:</span> <span class="token string">"超级大奖"</span><span class="token punctuation">,</span> probability<span class="token operator">:</span> <span class="token number">0.001</span><span class="token punctuation">,</span> bgColor<span class="token operator">:</span> <span class="token string">"#b91c1c"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span> label<span class="token operator">:</span> <span class="token string">"特等奖"</span><span class="token punctuation">,</span> probability<span class="token operator">:</span> <span class="token number">0.009</span><span class="token punctuation">,</span> bgColor<span class="token operator">:</span> <span class="token string">"#c2410c"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span> label<span class="token operator">:</span> <span class="token string">"一等奖"</span><span class="token punctuation">,</span> probability<span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> bgColor<span class="token operator">:</span> <span class="token string">"#7e22ce"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span> label<span class="token operator">:</span> <span class="token string">"二等奖"</span><span class="token punctuation">,</span> probability<span class="token operator">:</span> <span class="token number">0.03</span><span class="token punctuation">,</span> bgColor<span class="token operator">:</span> <span class="token string">"#2563eb"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span> label<span class="token operator">:</span> <span class="token string">"三等奖"</span><span class="token punctuation">,</span> probability<span class="token operator">:</span> <span class="token number">0.15</span><span class="token punctuation">,</span> bgColor<span class="token operator">:</span> <span class="token string">"#15803d"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span> label<span class="token operator">:</span> <span class="token string">"安慰奖"</span><span class="token punctuation">,</span> probability<span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span> bgColor<span class="token operator">:</span> <span class="token string">"#1e293b"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span> label<span class="token operator">:</span> <span class="token string">"谢谢参与"</span><span class="token punctuation">,</span> probability<span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> bgColor<span class="token operator">:</span> <span class="token string">"#3f3f46"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> turntableDom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"turntable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> proportionPerPrize <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">/</span> prizes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// #region 划分转盘扇形区域</span>\n<span class="token keyword">const</span> turntableConicGradient <span class="token operator">=</span> prizes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prize<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> from <span class="token operator">=</span> <span class="token punctuation">(</span>proportionPerPrize <span class="token operator">*</span> index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> to <span class="token operator">=</span>\n    index <span class="token operator">===</span> prizes<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>\n      <span class="token operator">?</span> <span class="token number">100</span>\n      <span class="token operator">:</span> <span class="token punctuation">(</span>proportionPerPrize <span class="token operator">*</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prize<span class="token punctuation">.</span>bgColor<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">from</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">% </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>to<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nturntableDom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">conic-gradient(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>turntableConicGradient<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>\n  <span class="token string">","</span><span class="token punctuation">,</span>\n<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n<span class="token comment">// #endregion</span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"利用 CSS 函数 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">conic-gradient()</code>'}})," 创建颜色渐变，巧妙地实现转盘扇形区域的均分。得到的转盘如下所示："),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/e9fea7411105fa7448a750a78cb67aa6/6029f/turntable-base.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 82.6923076923077%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADZ0lEQVR42oWUa2yTZRTHqyHGbA4W6MX1tkvL2DpXRmGTtmv3djdmTPyE4BSDGHCfiInEhW1cRspYAsyQGPngQgIkmrh4CcKuLLYdZkY2M4MGqRg+aCY3jayw3u3P9327DTYrvsnJefPkPL/8z3nOOYpoPMlSi0QTxBN/M/9Jf0nREqJFxfNINE6me5Ip/gWLJWRI6MEs/sDXfNB7mnOHu7l+pJvf+gcJz9yXwVLc/wKloJQYfHHUR3Pzdpx2gbLKavbkmxjNyqJfrSJgt/PrZ58Tl9RmgCqWKjtz9iMqRYhdhNUKm3DWv8iBivUEDAaGjEYGVSr6c3MJHu3JCJWBs5G4DPviwkVMpVV4hEY8niYEdwMbRb+vfB1+rZZBvZ5hg5FhnZER09NMD3+cTj8aewiUlMXEQocehHE3bUVZsB6LTcDlbqS2pvERYB6DOoMI1OGrUhJwLePb5ucIh2aIJlMLShWzkZisbmj0EurCDRSUudCXODCVV+N01uOoe4EOqw2fRs9QoRa/YwWX6rIZq1uBb+MT3PSfW6RyAXj8/VMszyunyOrGaHFiKHFSKIKtVQ10llkYX5NNQMgSQZJfzlj9Sr6qVPBL76GlwHT9Dhw+QW6elaI1ItDslKHGdU6UDXZe97zBQGUTI4KRMSGH8donGW9Yhv95BcH33pYfZ743Hyo8eYpnLOUYX6rh2W3VaHa7UHc4UB5qwrIjSGvxNbxFfnpKz9C7tp0++xYuVGi5/mHXEoXRNPD8D2Nkt21Ac6QGZbcLlVdA6a3A+M5xCnbF2OwJ4jVM0VZ0jb0FN9hnCtKm+YYfB6bl++HI3KNE4ukxm4mEsZ14mZyOKjSdAqpOJ6qD9Zjf+gnTzhnWbvud9tVTHCycpNM8Sbt2gmOOq4TuiV2SFFsm9mgfRtN1/OT7YZ7aWyGCBNReG7o93RTviFD85i3yW/7kFdfPdOVPst88xburJpjou7tI3aJJCc9NylHfaRFqJafdjbnlKqU771Gy6zarW/7A9tpNWvXf0bryMiM90+KYpsTaPW6WxfSlYe678iX2rpPoXg2xasstVFvviP426u132b35Blf67sgbaD7NxwIXts1sioGJMMc+vc/+syHZ918O81dYWmSpjLCM62s+/UQyObcJF5t0Lu3L/9qH/wCw6gQHJHP8xgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="turntable-base"\n        title=""\n        src="/static/e9fea7411105fa7448a750a78cb67aa6/39c09/turntable-base.png"\n        srcset="/static/e9fea7411105fa7448a750a78cb67aa6/680fe/turntable-base.png 156w,\n/static/e9fea7411105fa7448a750a78cb67aa6/17474/turntable-base.png 312w,\n/static/e9fea7411105fa7448a750a78cb67aa6/39c09/turntable-base.png 624w,\n/static/e9fea7411105fa7448a750a78cb67aa6/6029f/turntable-base.png 906w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",p.createElement(a.p,null,"接着为每个扇形区域添加具体的奖品名称："),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="scss"><pre class="language-scss"><code class="language-scss"><span class="token selector">.prize-label </span><span class="token punctuation">{</span>\n  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>\n  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n  <span class="token property">align-items</span><span class="token punctuation">:</span> baseline<span class="token punctuation">;</span>\n  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>\n  <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n  <span class="token comment">// #region 调整奖品名的位置</span>\n  <span class="token property">line-height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n  <span class="token comment">// #endregion</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> anglePerPrize <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">360</span> <span class="token operator">/</span> prizes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// #region 添加奖品名节点</span>\n<span class="token keyword">const</span> prizeLabels <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nprizes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prize<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> prizeLabel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  prizeLabel<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"prize-label"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  prizeLabel<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>\n    <span class="token operator">-</span>anglePerPrize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> anglePerPrize <span class="token operator">*</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>\n  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n  prizeLabel<span class="token punctuation">.</span>innerText <span class="token operator">=</span> prize<span class="token punctuation">.</span>label<span class="token punctuation">;</span>\n  prizeLabels<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>prizeLabel<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nturntableDom<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>prizeLabels<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// #endregion</span>\n\n<span class="token comment">// #region 设置转盘初始角度</span>\n<span class="token keyword">const</span> turntableBaseRotate <span class="token operator">=</span> <span class="token operator">-</span>anglePerPrize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>\nturntableDom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>turntableBaseRotate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n<span class="token comment">// #endregion</span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"我们手动创建了包含奖品名的标签节点，通过简单的计算，让它们旋转到自己所属的扇形区域上。此外，我们还为转盘设置了一个初始角度，使得第一个奖品呈现在转盘的正上方。效果如下所示："),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/e72e4a074197ec4a86d6e5c855de2466/6029f/turntable-with-prize-labels.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 82.6923076923077%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADdklEQVR42o2Ua2yTZRTH6y1CogS7FuvWdpd2olK39bJL7doyu8mKjOhwI4Sx+IGBUaIyHQ4rRFidi0OXCBpi0IwP0yDEkDnG5jbGJlsWHUSHwUWjXxxEkEVdad/e6M/37W4UJPAkJ0+ey/nlf57znCMLhqNcb0IwQjB6lQgQvcaktbQvBMP8n59kshtgoQgxyXHKx/nOLs6908hY3TbOeRuZ6DiO/x8fYelcvHdLoASTRseJARpWP0uPXE53qpZevZ5udQqdcgXDq8xc6Dt0U6jseljrwTaM5iewFzj5QpvK9243oxuqGHIVi3AVJ6330meS8dtn3hlo+EZgIBiOw3p6+zEarbz4wsu4y9fxyuMm+hUKjimSOK5U0ZctZ2ilgjOb7fTnyTjf9Xn8XYVgaB4oKQtFrnIlEKSiYj1r11azrW47NnsxJY5iDmfo6FNr6M5QM+BcxIBjIWfrKxkp1zPyXCaCb0pMVGwufNmsuoHBYXJz7ZSVleNyuVkuAguedPNGtqhSpaYnW8m3roWcWn4Pw0V3MVK6gBP5d3OhvzNBpcwvhOLA9/d+SpI6i8eMTnIsRRRYXdicT7GisIT2DBXDDvHtipbQYbPQZqniE2MDDclt9Oz5Pe4vCJFZ4LTCHd4WkrQmlpqKSXnYinaZDd2jhWTk2KgqqWa/4SPe1XWyUzeKJ+1n3kz/ldcVYxz1/CF+s5ioMJqosOmD/aQbHGyp3clDmXmkLi1EY7CzZKMRZd0BHCsF6jPH2JV2Bk/qKK3rx9khzl1NE3H/wLzCaeCxb06i0udRsnoDaXoRlm/jwVoniiYz2q0fkr7Jj3ndBFsNY3g1o3xcNo4n5TQ/fD2ZCJzN8tSVAFbXGhYrs9CWOljssfLAbhuKt81oavfxyPN+NBsvkVl9iZqCcd5aNEKz9Sy+f8OEomK4oWv+oX8m00eOdnPfqhzkDTayWsrRNT5N0i4TWhGoF4HGly5ifnWS1JrLlOb+wulDfyWoS6iUwEylNJ9q5Y46A6aWStYcrCXZmx8HLqsJsHnv31i2XEZeeZH32v3ibbFRhG6jlo/82IthzzMsqLdwZ72O+ze1oKzwk1z1J7bXJvlqaBp26+YQjsxBfYJA+0+D7O7dx/YvB2k+HKLjOz9T/sicMuF22td0+GEi0RjzIxaHSBaJSrUfvWk//A8q7Av/h7tdeQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="turntable-with-prize-labels"\n        title=""\n        src="/static/e72e4a074197ec4a86d6e5c855de2466/39c09/turntable-with-prize-labels.png"\n        srcset="/static/e72e4a074197ec4a86d6e5c855de2466/680fe/turntable-with-prize-labels.png 156w,\n/static/e72e4a074197ec4a86d6e5c855de2466/17474/turntable-with-prize-labels.png 312w,\n/static/e72e4a074197ec4a86d6e5c855de2466/39c09/turntable-with-prize-labels.png 624w,\n/static/e72e4a074197ec4a86d6e5c855de2466/6029f/turntable-with-prize-labels.png 906w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",p.createElement(a.blockquote,null,"\n",p.createElement(a.p,null,"更精致、美观的转盘设计还是建议直接使用做好的转盘图片；纯前端实现的话一方面耗时耗力，另一方面如果请求过多的装饰图片反而会降低访问性能。"),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>path/to/turntable.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>turntable<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>turntable<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>turntable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>img</span><span class="token punctuation">></span></span></code></pre></div>'}}),"\n"),"\n",p.createElement(a.p,null,"接下来添加指针和抽奖按钮："),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>turntable<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>turntable<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>arrow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lottery-btn<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lottery-btn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>抽奖<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>'}}),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="scss"><pre class="language-scss"><code class="language-scss"><span class="token selector">.arrow </span><span class="token punctuation">{</span>\n  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n  <span class="token property">top</span><span class="token punctuation">:</span> 140px<span class="token punctuation">;</span>\n  <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n  <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n  <span class="token property">border-left</span><span class="token punctuation">:</span> 15px solid transparent<span class="token punctuation">;</span>\n  <span class="token property">border-right</span><span class="token punctuation">:</span> 15px solid transparent<span class="token punctuation">;</span>\n  <span class="token property">border-bottom</span><span class="token punctuation">:</span> 100px solid #f8fafc<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.lottery-btn </span><span class="token punctuation">{</span>\n  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n  <span class="token property">top</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n  <span class="token property">width</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>\n  <span class="token property">height</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>\n  <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> #f8fafc<span class="token punctuation">;</span>\n  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>\n  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n  <span class="token property">color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>\n  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>\n  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>\n  <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n\n  <span class="token selector"><span class="token parent important">&amp;</span>--disabled </span><span class="token punctuation">{</span>\n    <span class="token property">color</span><span class="token punctuation">:</span> #999<span class="token punctuation">;</span>\n    <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"使用绝对定位将指针和按钮放到合适的位置，转盘现在看上去有模有样了："),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/90de7a597b7ced59a9d2050a707766e4/6029f/turntable-with-all.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 82.6923076923077%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADeklEQVR42o2Uf0zUdRjHr1+LNmV23DXix+HNY2SdyB13wHHc0e1ggxJXGFhTWG2RrVzpFYpduJSLuYCI4Vxzq+EWOos1ZxeCgAgJYwWWyJRV8kedLk3MOO/3ea++d/zyNKef7dln3+/n87z2fp7n8zwirz/I7ebxBvAGbxIAgrdY+Dv83+P1839+YRPdAfMFCIUdZ5xc7Ozi3Mf1jFdv45ytHof9GK7rTvzhc+HePYFhWHjZTwxQt/ZFesRiulNk9CoUdCcl0imWMLwmk0t9h+8KFd0OazvQjiozF0NOPodkKfxUXMxoRQVD5gIBHs9J3aP0qUVc+NI2B/XfCXR7/RFYT28/KpWOt958h+LSV3h3lZp+iQR7nJhj0nj6VosZek7C6U0G+rNEXOw6GMmrx+tbBIaV+QI3ueH2Ula2gfXrK9lWvQO9oYBCwTqEcIcN+RyXJzGYH8uA8THO1pQzUqpg5KVUPM4ZoVChhfBF8+oGBofRag2UlJRiNhfzrLGAHFMRW5UZ/G7dSY8ylh/MMZwyPcKw6SFGimI4kf0wl/o7o1SKXB5fBNjU+gVxSek8rconQ2NCpy9EK+SxpakF73UX51u206dfij1PS7tmI/tVddQltNPTOBXx93gC88BZhbW2ZuJkatLUBSSm5ZK8Mpe01SZ+Hpvgwh9TOM44aFrVTa18FKv8PB/If+N9yThHrH8KzywkKAxGK9zz6efIlUY2W3byZGoW8jQD0pVatn/VyNT0NT7bf42t8gnq5KexpozStmGSWmHv2uOI+LsXFc4Cvz9+knhFFoVrK1iuyCM5W88TFiNLPlKy3LKPpEo3mS87hJyOY0seZV/JJNbEMX75bjoaOF/lmRtudOZ1LJOmIysyssyq4/HdeUh3aUjc0spTr7lIfv0KqZVXqMqZ5MPYERp0Z3H+68cXFML13fIOXXOV7jjSzZI1GYjr9KQ3l7Ki/nnidqmRWfaieNWF6u3LZG6ZJqXqKkXaXxk7/HeUuqhOcc91SsOpNh6oVqJuLmfdAQsJtuwI8JkqN5ta/0Gz+Sri8st8ctQl3BYGhe8+ernjTC/KxheIqdHwYM0Klr7RjLTMRcLGv9C/N823Q7Owew8Hf2AB6vR4ODoxyO7evez4epCGb3zYf3Qx4wosKPPcz/iaDd9PIBhicYUikLAFguHeD951Hv4H6UAYe0OLzAYAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="turntable-with-all"\n        title=""\n        src="/static/90de7a597b7ced59a9d2050a707766e4/39c09/turntable-with-all.png"\n        srcset="/static/90de7a597b7ced59a9d2050a707766e4/680fe/turntable-with-all.png 156w,\n/static/90de7a597b7ced59a9d2050a707766e4/17474/turntable-with-all.png 312w,\n/static/90de7a597b7ced59a9d2050a707766e4/39c09/turntable-with-all.png 624w,\n/static/90de7a597b7ced59a9d2050a707766e4/6029f/turntable-with-all.png 906w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",p.createElement(a.p,null,"最重要的环节到了，实现转盘抽奖的核心需求：转！"),"\n",p.createElement(a.p,null,"首先实现一个支持生成小数位后 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">precision</code>'}})," 位精度的随机数的方法，它将被用于模拟抽奖结果（当然这应当由后端完成），以及计算转盘应当旋转的角度："),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> <span class="token function-variable function">getRandomNumber</span> <span class="token operator">=</span> <span class="token punctuation">(</span>min<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> precision<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> factor <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> precision<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> random <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min<span class="token punctuation">)</span> <span class="token operator">+</span> min<span class="token punctuation">;</span>\n  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>random <span class="token operator">*</span> factor<span class="token punctuation">)</span> <span class="token operator">/</span> factor<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"基于刚刚实现的 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">getRandomNumber()</code>'}})," 方法，完成我们的抽奖事件："),"\n",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> animationDuration <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> rotateLapsBase <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> rotateLaps <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> lotteryBtnDom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"lottery-btn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nlotteryBtnDom<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  lotteryBtnDom<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"lottery-btn--disabled"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// #region 模拟抽奖结果，由后端完成</span>\n  <span class="token keyword">let</span> prizeIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> resultNum <span class="token operator">=</span> <span class="token function">getRandomNumber</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 本文预设奖品的中奖概率精确到小数点后 3 位，因此这里的 `precision` 设为 3</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>resultNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    resultNum <span class="token operator">-=</span> prizes<span class="token punctuation">[</span>prizeIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>probability<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>resultNum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      prizeIndex <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">const</span> prize <span class="token operator">=</span> prizes<span class="token punctuation">[</span>prizeIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token comment">// #endregion</span>\n\n  <span class="token comment">// #region 获取转盘需要旋转的角度</span>\n  <span class="token keyword">const</span> turntableRotateDegFrom <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>\n    <span class="token punctuation">(</span>anglePerPrize <span class="token operator">*</span> prizeIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> turntableRotateDegTo <span class="token operator">=</span>\n    prizeIndex <span class="token operator">===</span> prizes<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>\n      <span class="token operator">?</span> <span class="token number">360</span>\n      <span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">(</span>anglePerPrize <span class="token operator">*</span> <span class="token punctuation">(</span>prizeIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> turntableRotateDegEdgeThreshold <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>\n    <span class="token punctuation">(</span>anglePerPrize <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设定旋转到指定扇形区域的距边缘阈值（&lt;= anglePerPrize / 2），防止出现指针指向太靠近边缘的情况</span>\n  <span class="token keyword">const</span> turntableRotateDegBase <span class="token operator">=</span> <span class="token function">getRandomNumber</span><span class="token punctuation">(</span>\n    turntableRotateDegFrom <span class="token operator">+</span> turntableRotateDegEdgeThreshold<span class="token punctuation">,</span>\n    turntableRotateDegTo <span class="token operator">-</span> turntableRotateDegEdgeThreshold<span class="token punctuation">,</span>\n    <span class="token number">1</span><span class="token punctuation">,</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  rotateLaps <span class="token operator">+=</span> rotateLapsBase<span class="token punctuation">;</span> <span class="token comment">// 适配多次旋转的情况</span>\n  <span class="token keyword">const</span> turntableRotateDeg <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>rotateLaps <span class="token operator">*</span> <span class="token number">360</span> <span class="token operator">+</span> turntableRotateDegBase<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// #endregion</span>\n\n  <span class="token comment">// #region 为转盘设置旋转动画</span>\n  turntableDom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>turntableRotateDeg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n  turntableDom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>animationDuration<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms ease-out</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n  <span class="token comment">// #endregion</span>\n\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">您抽中了：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prize<span class="token punctuation">.</span>label<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">！</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    lotteryBtnDom<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"lottery-btn--disabled"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> animationDuration <span class="token operator">+</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>'}}),"\n",p.createElement(a.p,null,"计算实际中奖结果所在的扇形区域角度 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">turntableRotateDegFrom</code>'}})," 至 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">turntableRotateDegTo</code>'}}),"，分别加上和减去距离边缘的阈值 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">turntableRotateDegEdgeThreshold</code>'}}),"，将得到的范围取随机数，即可得到我们最后转盘应旋转的角度 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">turntableRotateDegBase</code>'}}),"。将应旋转的角度再加上设定好的旋转圈数所对应的角度，取反即可得到动画效果中实际旋转的角度 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">turntableRotateDeg</code>'}}),"。"),"\n",p.createElement(a.p,null,"点击抽奖按钮，看看现在的效果吧："),"\n",p.createElement(a.img,{src:"/static/lucky-draw-base-animation+cf935b3d0e07c8f55476736c29d6f0e8.gif",alt:"lucky-draw-base-animation"}),"\n",p.createElement(a.p,null,"Ops，竟然是谢谢参与，我觉得有黑幕！但是可喜可贺，我们已经基本实现了转盘抽奖组件所需的全部能力。"),"\n",p.createElement(a.p,null,"下面，为了使转盘旋转的效果更贴近生活实际，我们可以为旋转动画设置更符合物理直觉的过渡效果。"),"\n",p.createElement(a.p,null,"刚刚为 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">transform</code>'}})," 设置的动画过渡效果 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">transition-timing-function: ease-out;</code>'}})," 相当于 ",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">transition-timing-function: cubic-bezier(0, 0, .58, 1);</code>'}}),"，表示动画一开始较快，随着动画的进行逐渐减速。"),"\n",p.createElement(a.p,null,"但是转盘从转动减速至停止的过渡时间太短，从视觉上看尤为突兀，要是稍长一些就好了。"),"\n",p.createElement(a.p,null,"通过 ",p.createElement(a.a,{href:"https://cubic-bezier.com/"},"cubic-bezier"),"，我们以可视化的方式实现一个满足需要的三次贝塞尔曲线，作为动画的过渡效果。如：",p.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">transition-timing-function: cubic-bezier(.3, .9, .38, 1);</code>'}}),"，它减速至停止的 ",p.createElement(a.strong,null,"过渡时间更长且更柔和"),"，效果如下："),"\n",p.createElement(a.img,{src:"/static/lucky-draw-better-animation+e325b310000530ace660c5c6d2ecd536.gif",alt:"lucky-draw-better-animation"}),"\n",p.createElement(a.p,null,"完整的 Demo 奉上："),"\n",p.createElement("iframe",{height:"600",scrolling:"no",title:"lucky-draw-demo",src:"https://codepen.io/LolipopJ/embed/QWXzwWp?default-tab=html%2Cresult",frameBorder:"no",loading:"lazy",allowtransparency:"true",allowFullScreen:!0},p.createElement(a.p,null,"See the Pen"," ","\n",p.createElement("a",{href:"https://codepen.io/LolipopJ/pen/QWXzwWp"},"lucky-draw-demo")," by\nJasonSung (",p.createElement("a",{href:"https://codepen.io/LolipopJ"},"@LolipopJ"),") on"," ","\n",p.createElement("a",{href:"https://codepen.io"},"CodePen"),".")))}var o=function(n){void 0===n&&(n={});const{wrapper:a}=Object.assign({},(0,t.R)(),n.components);return a?p.createElement(a,n,p.createElement(e,n)):e(n)},c=s(197),l=s(4353),u=s.n(l),i=s(4794),r=s(6947),k=s(4017),g=s(1042),m=s(1038);const d={a:n=>{let{href:a="",children:s}=n;const t=!(null!=a&&a.startsWith("#")),e=t?a:`#${encodeURIComponent(a.slice(1))}`;return p.createElement("a",{href:e,target:t?"_blank":void 0,rel:"noreferrer"},s)},img:n=>{const{alt:a="The author is too lazy to give an alt",src:s,...t}=n;return p.createElement("a",{href:s,"data-fancybox":"gallery","data-caption":a},p.createElement("img",Object.assign({src:s,alt:a},t)))},Card:r.A,Link:i.Link},b=n=>{let{children:a,data:s}=n;const{mdx:{frontmatter:{title:e,date:o,updated:l,categories:i,tags:r,timeliness:g=!0}}}=s,b=p.useRef(null),y=u()(o),h=l?u()(l):y,f=u()().diff(h,"days");return p.useEffect((()=>{var n;const a=null===(n=b.current)||void 0===n?void 0:n.querySelectorAll("a.gatsby-resp-image-link");return null==a||a.forEach((n=>{const a=n.children.item(1);n.setAttribute("data-fancybox","gallery"),n.setAttribute("data-caption",a.alt)})),c.lX.bind("[data-fancybox]"),()=>c.lX.unbind("[data-fancybox]")}),[]),p.createElement("div",{className:"mx-auto flex max-w-xl flex-col gap-y-12"},p.createElement("div",{className:"flex flex-col gap-4"},(null==i?void 0:i.length)&&p.createElement(k.A,{name:i[0],className:"item-selectable"}),p.createElement("h1",{className:"text-3xl font-bold"},e),p.createElement("div",{className:"item-secondary flex flex-col gap-2 lg:flex-row"},o&&p.createElement("span",{title:`首次发布于：${y.toString()}\n最后更新于：${h.toString()}`},y.format("MM 月 DD 日 YYYY 年")),(null==r?void 0:r.length)&&p.createElement("div",{className:"flex flex-1 flex-wrap gap-2 lg:before:content-['•']"},r.map((n=>p.createElement(m.A,{key:n,name:n,className:"item-secondary item-selectable"})))))),p.createElement("article",{ref:b,className:"heti post-entry"},g&&f>365&&p.createElement("blockquote",{className:"border-l-4 border-orange-400"},"这是一篇",p.createElement("strong",null,"最后更新于 ",f," 天前"),"的博客，内容可能随着时间的推移而变得不再适用，建议您仔细评估信息的有效性。"),p.createElement(t.x,{components:d},a)))},y=n=>{let{data:a}=n;return p.createElement(g.A,{title:String(a.mdx.frontmatter.title)})};function h(n){return p.createElement(b,n,p.createElement(o,n))}}}]);
//# sourceMappingURL=component---src-templates-post-tsx-content-file-path-blog-posts-lucky-draw-mdx-8c01248d676eb6727e49.js.map