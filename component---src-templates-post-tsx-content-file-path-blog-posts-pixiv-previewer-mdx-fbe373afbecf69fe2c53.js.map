{"version":3,"file":"component---src-templates-post-tsx-content-file-path-blog-posts-pixiv-previewer-mdx-fbe373afbecf69fe2c53.js","mappings":"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","sources":["webpack://homepage/./blog/posts/pixiv-previewer.mdx","webpack://homepage/./src/templates/post.tsx"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    ol: \"ol\",\n    li: \"li\",\n    strong: \"strong\",\n    a: \"a\",\n    h2: \"h2\",\n    h3: \"h3\",\n    span: \"span\",\n    ul: \"ul\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.p, null, \"笔者的业余爱好之一就是逛 Pixiv，收藏好看的插画等作品并下载到本地。油猴脚本 Pixiv Previewer 做了两个笔者很喜欢的便利性工作：\"), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"作品预览\"), \"：鼠标悬浮在作品缩略图上时自动在当前页面显示大图，快速决定要不要点进作品页。\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"作品排序\"), \"：作品搜索页可以按“排序”按钮，自动获取若干页的作品并按照收藏数排序，快速筛选优质作品。\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"出于爱好，笔者去\", React.createElement(_components.a, {\n    href: \"https://github.com/Ocrosoft/PixivPreviewer\"\n  }, \"脚本仓库\"), \"翻阅了一下源码，觉得有一些可以改进的地方，遂 Fork 之，进行二次开发。\"), \"\\n\", React.createElement(_components.h2, null, \"工程化改造\"), \"\\n\", React.createElement(_components.p, null, \"首当其冲的自然是前端项目工程化改造。大多数油猴脚本仓库都是孤零零的一个 JavaScript 文件，Pixiv Previewer 也不例外。直接手搓 JavaScript 虽然很便利，但在项目长期的维护开发中多半会掩埋掉许多未曾留意的 Bug，同时由于缺少关联提示，开发效率也会大打折扣。作为前端工程师，这样可怕的事情自然是不能接受的。\"), \"\\n\", React.createElement(_components.h3, null, \"通过 tsup 构建项目\"), \"\\n\", React.createElement(_components.p, null, \"初始化 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">package.json</code>\"\n    }\n  }), \" 等过程跳过不表，添加 TypeScript 支持自然是对项目进行二次开发的前置步骤。由于我们最后构建的产物将作为油猴脚本运行，即打包为库，因此笔者选择了开箱即用的 \", React.createElement(_components.a, {\n    href: \"https://github.com/egoist/tsup\"\n  }, \"tsup\"), \"：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token function\\\">yarn</span> <span class=\\\"token function\\\">add</span> <span class=\\\"token parameter variable\\\">-D</span> tsup</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"添加 tsup 的配置文件 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">tsup.config.ts</code>\"\n    }\n  }), \"：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> defineConfig <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"tsup\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">import</span> packageJson <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"./package.json\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token function\\\">defineConfig</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  entry<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"src/index.ts\\\"</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n  target<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"chrome107\\\"</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n  splitting<span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n  clean<span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n  env<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token constant\\\">VERSION</span><span class=\\\"token operator\\\">:</span> packageJson<span class=\\\"token punctuation\\\">.</span>version<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  banner<span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    js<span class=\\\"token operator\\\">:</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">// ==UserScript==\\n// @name                PixivPreviewerL\\n// @namespace           </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>homepage<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @version             </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>version<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">-</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span><span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">toLocaleDateString</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @description         </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>description<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @author              </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>author<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @match               *://www.pixiv.net/*\\n// @grant               unsafeWindow\\n// @grant               GM.xmlHttpRequest\\n// @grant               GM_xmlhttpRequest\\n// @license             </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>packageJson<span class=\\\"token punctuation\\\">.</span>license<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\n// @icon                https://t0.gstatic.com/faviconV2?client=SOCIAL&amp;type=FAVICON&amp;fallback_opts=TYPE,SIZE,URL&amp;size=32&amp;url=https://www.pixiv.net\\n// @icon64              https://t0.gstatic.com/faviconV2?client=SOCIAL&amp;type=FAVICON&amp;fallback_opts=TYPE,SIZE,URL&amp;size=64&amp;url=https://www.pixiv.net\\n// @require             https://raw.githubusercontent.com/Tampermonkey/utils/refs/heads/main/requires/gh_2215_make_GM_xhr_more_parallel_again.js\\n// ==/UserScript==</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"上面的配置表示，tsup 将打包构建源文件 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">src/index.ts</code>\"\n    }\n  }), \" 至默认产物文件 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">dist/index.js</code>\"\n    }\n  }), \"，保证兼容 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">Chrome >= 107</code>\"\n    }\n  }), \"。其中，笔者复用了 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">package.json</code>\"\n    }\n  }), \" 里定义的若干字段，用于添加项目环境变量（脚本通过版本号判断是否显示更新日志框），以及生成油猴脚本顶部的配置项。\"), \"\\n\", React.createElement(_components.p, null, \"这样，当执行 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">tsup</code>\"\n    }\n  }), \" 命令时，构建的产物形如：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// ==UserScript==</span>\\n<span class=\\\"token comment\\\">// @name                PixivPreviewerL</span>\\n<span class=\\\"token comment\\\">// @namespace           https://github.com/LolipopJ/PixivPreviewer</span>\\n<span class=\\\"token comment\\\">// @version             0.1.3-2025/3/17</span>\\n<span class=\\\"token comment\\\">// @description         Original project: https://github.com/Ocrosoft/PixivPreviewer.</span>\\n<span class=\\\"token comment\\\">// @author              Ocrosoft, LolipopJ</span>\\n<span class=\\\"token comment\\\">// @match               *://www.pixiv.net/*</span>\\n<span class=\\\"token comment\\\">// @grant               unsafeWindow</span>\\n<span class=\\\"token comment\\\">// @grant               GM.xmlHttpRequest</span>\\n<span class=\\\"token comment\\\">// @grant               GM_xmlhttpRequest</span>\\n<span class=\\\"token comment\\\">// @license             GPL-3.0</span>\\n<span class=\\\"token comment\\\">// @icon                https://t0.gstatic.com/faviconV2?client=SOCIAL&amp;type=FAVICON&amp;fallback_opts=TYPE,SIZE,URL&amp;size=32&amp;url=https://www.pixiv.net</span>\\n<span class=\\\"token comment\\\">// @icon64              https://t0.gstatic.com/faviconV2?client=SOCIAL&amp;type=FAVICON&amp;fallback_opts=TYPE,SIZE,URL&amp;size=64&amp;url=https://www.pixiv.net</span>\\n<span class=\\\"token comment\\\">// @require             https://raw.githubusercontent.com/Tampermonkey/utils/refs/heads/main/requires/gh_2215_make_GM_xhr_more_parallel_again.js</span>\\n<span class=\\\"token comment\\\">// ==/UserScript==</span>\\n\\n<span class=\\\"token comment\\\">// ... 脚本构建后的代码</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, null, \"代码质量检查与格式化工具\"), \"\\n\", React.createElement(_components.p, null, \"TypeScript 自身已包含类型检查等能力，但还可以引入更多质量检查的通用规范，提升项目的健壮性。对于 TypeScript 项目，目前来看最好的选择应当是 \", React.createElement(_components.a, {\n    href: \"https://github.com/typescript-eslint/typescript-eslint\"\n  }, React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">typescript-eslint</code>\"\n    }\n  })), \"，参考官方文档添加依赖并配置 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">eslint.config.mjs</code>\"\n    }\n  }), \"：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token function\\\">yarn</span> <span class=\\\"token function\\\">add</span> <span class=\\\"token parameter variable\\\">--dev</span> eslint @eslint/js typescript typescript-eslint</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// @ts-check</span>\\n\\n<span class=\\\"token keyword\\\">import</span> eslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"@eslint/js\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> tseslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"typescript-eslint\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> tseslint<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">config</span><span class=\\\"token punctuation\\\">(</span>\\n  eslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n  tseslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"现在执行 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">eslint src --fix</code>\"\n    }\n  }), \" 即可查找并尝试修复 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">src/</code>\"\n    }\n  }), \" 目录下所有文件的质量问题。\"), \"\\n\", React.createElement(_components.p, null, \"接着为项目添加自动格式化能力，Prettier 是笔者最推荐的选项。此外，笔者喜欢将 Prettier 与 ESLint 结合起来一起使用，即在执行 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">eslint src --fix</code>\"\n    }\n  }), \" 修复质量问题的同时，自动格式化代码。ESLint 的插件 \", React.createElement(_components.a, {\n    href: \"https://github.com/prettier/eslint-plugin-prettier\"\n  }, React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">eslint-plugin-prettier</code>\"\n    }\n  })), \" 可以实现如上能力，添加此插件作为依赖并进一步配置 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">eslint.config.mjs</code>\"\n    }\n  }), \"：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token function\\\">yarn</span> <span class=\\\"token function\\\">add</span> <span class=\\\"token parameter variable\\\">-D</span> prettier eslint-plugin-prettier eslint-config-prettier</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// @ts-check</span>\\n\\n<span class=\\\"token keyword\\\">import</span> eslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"@eslint/js\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> tseslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"typescript-eslint\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> eslintPluginPrettierRecommended <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"eslint-plugin-prettier/recommended\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> tseslint<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">config</span><span class=\\\"token punctuation\\\">(</span>\\n  eslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n  tseslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n  eslintPluginPrettierRecommended<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"此外，Pixiv Previewer 项目依赖于 JQuery 来执行查找与修改 DOM 的操作，笔者添加了相应的类型提示：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token function\\\">yarn</span> <span class=\\\"token function\\\">add</span> <span class=\\\"token parameter variable\\\">-D</span> @types/jquery globals</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// @ts-check</span>\\n\\n<span class=\\\"token keyword\\\">import</span> eslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"@eslint/js\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> tseslint <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"typescript-eslint\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> eslintPluginPrettierRecommended <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"eslint-plugin-prettier/recommended\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> globals <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">\\\"globals\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> tseslint<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">config</span><span class=\\\"token punctuation\\\">(</span>\\n  eslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n  tseslint<span class=\\\"token punctuation\\\">.</span>configs<span class=\\\"token punctuation\\\">.</span>recommended<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">languageOptions</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">globals</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token operator\\\">...</span>globals<span class=\\\"token punctuation\\\">.</span>browser<span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token operator\\\">...</span>globals<span class=\\\"token punctuation\\\">.</span>jquery<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  eslintPluginPrettierRecommended<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"至此，基本的项目工程化改造告一段落。项目可以基于 TypeScript 开发，并且拥有了质量检查和格式化能力。将原来的 JavaScript 代码放到 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">src/index.ts</code>\"\n    }\n  }), \" 文件里，开始正式的二次开发吧！\"), \"\\n\", React.createElement(_components.h2, null, \"预览功能优化\"), \"\\n\", React.createElement(_components.p, null, \"笔者在阅读 Pixiv Previewer 源码时发现，原作者根据当前页面的不同，实现了不同的通过 DOM 节点寻找可预览作品的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 标签的方法，并为它添加监听事件，当鼠标悬浮在上面的时候显示预览。为了应对作品动态加载的情况，脚本设置了循环定时器，每隔一小段时间重新执行上述方法。\"), \"\\n\", React.createElement(_components.p, null, \"这种力大砖飞的实现方案存在一个不可忽视的缺陷：要考虑到每个页面里不同的作品 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 标签的排布情况，为之实现绑定事件的方法。对于没有考虑到的作品 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 标签，自然无法显示预览。例如，在当前的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">Pixiv Previewer@3.7.32</code>\"\n    }\n  }), \" 版本，主页“插画约稿作品”处的作品就无法显示预览：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/be36310c484497f2f0c9aa4d35ef38a9/9c1e6/unimplemented-preview.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 38.46153846153846%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABxUlEQVR42k2Sy2oUURCG+xV0pid9v5/uPn23Z5WNOEtBiCCZRAMudOE4QTQzRIgrs0tg1J3gagRBiAouXLjyNXyd36ozTHDxQ3XV+evU+aq1yWSCqqpgmiYcx1HyfR+e56nYdd3rPIvz29r/9SAIEEURtL4fo+s61bRpGtR1Dd/zVVOOWdsai01s5pjz2zNlWaq8VhQFclkgI8mSlBd0q4MwDNGSqSxK5HkOKaUy8XRJItC2LRIhkLM/y5CmqZpWc10PoeegSHwEtg1ROIhSm4ybZ1umAT8IaeJAYTFIkswxXSiiGJKay4aQWSZsy4Y2Go3w+N5dvD+Z4c2j+2izGAYXbeLjWJhO9/Fl/R2ri4/07VLexsgwcItecnX6Fl8XZ/i7/oFx00GnXppJExzsHWE+PcK7+QzjPMXNoU5GSzW9/PAZv69+4ez0nDAk2CHTjmGiTgW+nbzEz+USf5av0VcN+QbQPIJfCYm923ew2D/Ebt3gxmBwDf/Z02O8ePIc89mCGLfQ9aFaWEbPfvXgIVaHB/i0PEYtSwx1HRrD5iVExEM1IVb8G/R9r2CLdANc0mK4EYPv2gaCFhKHMSmic1QLNsz/AQIJ+lxCv4MMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"“插画约稿作品”暂未实现预览功能\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/be36310c484497f2f0c9aa4d35ef38a9/39c09/unimplemented-preview.png\\\"\\n        srcset=\\\"/static/be36310c484497f2f0c9aa4d35ef38a9/680fe/unimplemented-preview.png 156w,\\n/static/be36310c484497f2f0c9aa4d35ef38a9/17474/unimplemented-preview.png 312w,\\n/static/be36310c484497f2f0c9aa4d35ef38a9/39c09/unimplemented-preview.png 624w,\\n/static/be36310c484497f2f0c9aa4d35ef38a9/6d2da/unimplemented-preview.png 936w,\\n/static/be36310c484497f2f0c9aa4d35ef38a9/5a791/unimplemented-preview.png 1248w,\\n/static/be36310c484497f2f0c9aa4d35ef38a9/9c1e6/unimplemented-preview.png 1734w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"另外，如果 Pixiv 前端页面某一天迭代更新，寻找作品 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 标签的方法也可能需要大刀阔斧地修改。\"), \"\\n\", React.createElement(_components.p, null, \"笔者想到的改进方案是：把找作品 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 标签的工作，从脚本手中移交到用户手中。即监听鼠标移动事件，当悬浮到可预览作品上时，显示预览。\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">onMouseMove</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>mouseMoveEvent<span class=\\\"token operator\\\">:</span> JQuery<span class=\\\"token punctuation\\\">.</span>MouseMoveEvent<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function\\\">onMouseOverIllust</span><span class=\\\"token punctuation\\\">(</span>mouseMoveEvent<span class=\\\"token punctuation\\\">.</span>target<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">$</span><span class=\\\"token punctuation\\\">(</span>document<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">on</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"mousemove\\\"</span><span class=\\\"token punctuation\\\">,</span> onMouseMove<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"在上面的代码里，笔者为 Document 全局绑定了 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">mousemove</code>\"\n    }\n  }), \" 监听事件，当鼠标移动时，调用 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">onMouseOverIllust(target)</code>\"\n    }\n  }), \" 方法，其中 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">target</code>\"\n    }\n  }), \" 是当前鼠标所悬浮的元素。如果监听的是 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">mouseover</code>\"\n    }\n  }), \" 事件，脚本可以有更好的性能表现，但是笔者在测试过程中，发现 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">mouseover</code>\"\n    }\n  }), \" 事件回调对象里的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">ctrlKey</code>\"\n    }\n  }), \" 等值有时不能正确反映实际状态，所以这里选择了监听 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">mousemove</code>\"\n    }\n  }), \" 事件。\"), \"\\n\", React.createElement(_components.p, null, \"接着，需要判断鼠标当前悬浮的元素是否为可预览的作品，如果是则显示预览。观察 DOM 节点：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/e23c9d6ac90d75299fec98ea1cfe8de9/d073d/hovered-illust.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 57.05128205128205%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdklEQVR42m2SS2sTURiGsxHdSC+p1iRNm15IJslkMpM5k2TSZDKTaXpJbaVI0ZULL91IFxURiuBKdNFFd0UXCiKIIILQigsRusrvqG68gIuCy5THM6ktoh14OHOYM+/5vvd7Q7lcDrtSwRIWY2NjjI6OHpNIJBgZGSGVSqEoyjGpZApRyePNODQ9k4WpAi3fpFrNEdJ1nYbnYdt29+fh4bhc43Id7u7j8fj/gnJvllVqjodTn6JZr9GatDCFFIxGo/JQCkM38FyfWs2TN3n4/hRCCGKxGMlksityRFJWqFsZClYFYXuUijYVq4woZAkdtbZ6e5VvX3/y+csP9va+s7//i52dbQYHB1FVFU3TCOw5Qtg5SmYBt2zjlIuIUhXT0giNj48TiURZWblF8BwcdOh0Ot33drvdFcxms13RvwlaNkyBP71Ic/4y3twyFc8lFPgUDvczNbfIi7efePb6PU9ffeDBo00uzrcILPm35QCtkCSvF/BbyzjeLNN1H9cpE4pL8wfCfZS8Bdaf7HJnc5v7Wx9xL93gzOlTDJ0wlIC8lcZQFZyiYFKYNM0M1WImqDDBQH8vtdkr3NvaZW3jDRsv2yxdW6O/r7db4UmCmlDQNR3b0CnlpceZLLl8mlDgX7ivB1Ff4Objd9zd3OHh8zbL19fp7Tkr/Y2cEBuFQknBtCsY5SqGkcPQMghLTtmVGVSl6ROKSslfojIjPWldxSg6srrInxwmSafTh2QkUtSSuSvXbXlOleISkZFTVggFN05MTBAfihG9cI7I4AAXzvcTk2KJxGGkNNlaXWbU86clTRy3gd9cwG3MUq25uPJbtdEi31jiN91meok3JPzJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"作品 DOM 节点\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/e23c9d6ac90d75299fec98ea1cfe8de9/39c09/hovered-illust.png\\\"\\n        srcset=\\\"/static/e23c9d6ac90d75299fec98ea1cfe8de9/680fe/hovered-illust.png 156w,\\n/static/e23c9d6ac90d75299fec98ea1cfe8de9/17474/hovered-illust.png 312w,\\n/static/e23c9d6ac90d75299fec98ea1cfe8de9/39c09/hovered-illust.png 624w,\\n/static/e23c9d6ac90d75299fec98ea1cfe8de9/6d2da/hovered-illust.png 936w,\\n/static/e23c9d6ac90d75299fec98ea1cfe8de9/5a791/hovered-illust.png 1248w,\\n/static/e23c9d6ac90d75299fec98ea1cfe8de9/d073d/hovered-illust.png 1297w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"如果当前鼠标悬浮在可预览的作品 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 元素上，则本身包含了访问链接的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">src</code>\"\n    }\n  }), \" 属性，通过简单的正则表达式处理即可获取作品的 Pixiv ID 和大图链接。同时，外层还包裹着一层 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;a></code>\"\n    }\n  }), \" 元素，包含跳转链接。\"), \"\\n\", React.createElement(_components.p, null, \"考虑到部分 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 元素虽然包含作品缩略图的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">src</code>\"\n    }\n  }), \" 属性，但跳转的页面并不一定是作品页（\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">https://www.pixiv.net/artworks/artwork-id</code>\"\n    }\n  }), \"），而是别的页面，鼠标悬浮在这些 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;img></code>\"\n    }\n  }), \" 元素上时不应当显示预览。因此笔者实现的判断方法，统一取当前悬浮元素的第一个父 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">&lt;a></code>\"\n    }\n  }), \" 节点，当其 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">href</code>\"\n    }\n  }), \" 值满足 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/\\\\/artworks\\\\/(\\\\d+)/</code>\"\n    }\n  }), \" 时，显示预览：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"ts\\\"><pre class=\\\"language-ts\\\"><code class=\\\"language-ts\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">getIllustMetadata</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>target<span class=\\\"token operator\\\">:</span> JQuery<span class=\\\"token operator\\\">&lt;</span>HTMLElement<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> imgLink <span class=\\\"token operator\\\">=</span> target<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">while</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>imgLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">is</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"A\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    imgLink <span class=\\\"token operator\\\">=</span> imgLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">parent</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>imgLink<span class=\\\"token punctuation\\\">.</span>length<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> illustHref <span class=\\\"token operator\\\">=</span> imgLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">attr</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"href\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> illustHrefMatch <span class=\\\"token operator\\\">=</span> illustHref<span class=\\\"token operator\\\">?.</span><span class=\\\"token function\\\">match</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token regex\\\"><span class=\\\"token regex-delimiter\\\">/</span><span class=\\\"token regex-source language-regex\\\">\\\\/artworks\\\\/(\\\\d+)</span><span class=\\\"token regex-delimiter\\\">/</span></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>illustHrefMatch<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">const</span> illustId <span class=\\\"token operator\\\">=</span> illustHrefMatch<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> ugoiraSvg <span class=\\\"token operator\\\">=</span> imgLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">children</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"div:first\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">find</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"svg:first\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> illustType <span class=\\\"token operator\\\">=</span>\\n    ugoiraSvg<span class=\\\"token punctuation\\\">.</span>length <span class=\\\"token operator\\\">||</span> imgLink<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">hasClass</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"ugoku-illust\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token operator\\\">?</span> IllustType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">UGOIRA</span> <span class=\\\"token comment\\\">// 动图作品</span>\\n      <span class=\\\"token operator\\\">:</span> IllustType<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">ILLUST</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 插画或漫画作品</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">/** 作品 ID */</span>\\n    illustId<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token comment\\\">/** 作品类型 */</span>\\n    illustType<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">onMouseOverIllust</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>target<span class=\\\"token operator\\\">:</span> JQuery<span class=\\\"token operator\\\">&lt;</span>HTMLElement<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span><span class=\\\"token punctuation\\\">(</span>target<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">is</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"IMG\\\"</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">||</span> target<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">is</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"A\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// 当前当前鼠标悬浮元素不是作品或作品链接，跳过</span>\\n    <span class=\\\"token keyword\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> illustId<span class=\\\"token punctuation\\\">,</span> illustType <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">getIllustMetadata</span><span class=\\\"token punctuation\\\">(</span>target<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">||</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>illustId <span class=\\\"token operator\\\">===</span> <span class=\\\"token keyword\\\">undefined</span> <span class=\\\"token operator\\\">||</span> illustType <span class=\\\"token operator\\\">===</span> <span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// 获取当前鼠标悬浮元素的元数据失败，跳过</span>\\n    <span class=\\\"token keyword\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">previewIllust</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> target<span class=\\\"token punctuation\\\">,</span> illustId<span class=\\\"token punctuation\\\">,</span> illustType <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"插画或漫画作品可能存在多页，处理时可以始终调用 Pixiv 官方的接口 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/ajax/illust/${artwork-id}/pages</code>\"\n    }\n  }), \"，获取指定作品包含的所有链接。\"), \"\\n\", React.createElement(_components.p, null, \"再修修补补，为事件加上节流函数，响应鼠标滚动切换页数等，实现了和原版并无二异的预览能力：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/d209c773392509f97e2c18c952a1edac/04784/previewer.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 75.64102564102564%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEDUlEQVR42i2U20/TZxjHe4WHuAud0+Eo9AD2SJG29CQVKPTXc38UyqEtXWk5jJNVKAgSQU2ceJhbZF5MzWaii5IsqFmyZJEtokbd4qKbW1yiu1+WXbj/4LM3xotvnvfm/TyH75NHUVlZSUVFBUqlkkohlVrLO1u3s3nTJjZs2EBZWRkbN26k7O17y5YtbN68iR07d7Br1wdse28nKpWKqqqqN1JotVpMJhM6vR6NRk1FpQp1jQ6TYTc11Rr0NdVYzAbcVht7dptwWkQ0mDDUGKk1GdFqNG9AKtVboMVSSyLRjuSX0Ov0VO/W0ypJFDK99PUkhTrp7+hE9oVodPmwWxtJNMYY6hxgtj9PJCihVlej0xlQa6tRmIwG5HCASGsbLQ1e4k1+2uU4g5kecqluPkx1Md7RQ1DAbK5m6m0ePPUuFp1RJvsyBGMJ8oURVq5cIRhNoLDX1TKWSRJuaSHS2IK13kFHPEYxl2JUaDibYmIgi8/bzGiih/nCELLDT9LsoUskHh4YZKY4xe2rlynuHxXAWiNZqYlmm5MGAau1ukm1yxwZzjIpQBPZNMV8H/FAmExbnIPpDCGvD4PFgWNvE7OlGU7PzbOvKUSiK4nCabdxoHSEowdK5KIRWoMia2+SRQGcKWRERRk+6ozj2mOnTm9jSI4RaG7BKUZgtFiZmDvKg7XvWTp1hu7eXlGhzUZXXx57gxuHMMiyx0pBAM4WCyyNF5jskXGbzNRrjNTrLDR5vBiNddjFHCVhlNMXIBoJE5LaMJvNwmWDAZtYC2WlErVYgW073qfD38KRrMxUd4x0KEZbawyXyYqz1kU+m8fhcAu395JO5qhr8FChrEKp0or/WhSNXi9319e5du0abpeT4yc+ptDdweF0nJDbLdoLkQvHWZ4+SNwfp00YZ7facXraCEgJinNnWFt/yc07fzJ1bBlFMBji9ev/ePnqFYsLC9x/9JghsX8TXTKpcISYT2IqFmL12Cynpqdodu9Fo7ewzxfF0yQxXJikNHGSh/f+4uSFGyjCoRD//vM3K9evU8jn+fmXp4xkUpQyXSwO5Lg8P8NgIMiCHObW4iG+/ewTjDozbo8P2R+lPzPKpdkFHt35iU8/vyqAkSiPf39FcyDCpYtf8OTpr5xZOsHFw0XmM92cGOxnIpWmPxDg/FCOZ7dXkaUw5w4fIt3eQ7YwzfJYkWfrT1j55jYKq83OSGmegdH9jI2OEI7JHD92lLUbX7J68TwX5kssDA/R5/cR93r4Y+07frt3l+c/rrG8dJJQMove0ECivZu4LKOoMxvZ52pAr9dRJS7P1ne3c/rcOV68eM6Dh/f54dZ1To8VmC7k6AhJzIxPMjg8x/iBJb7+6iYDwvXy8p3i8pSLWM7/w8ZTI132ipsAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"Pixiv 预览\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/d209c773392509f97e2c18c952a1edac/39c09/previewer.png\\\"\\n        srcset=\\\"/static/d209c773392509f97e2c18c952a1edac/680fe/previewer.png 156w,\\n/static/d209c773392509f97e2c18c952a1edac/17474/previewer.png 312w,\\n/static/d209c773392509f97e2c18c952a1edac/39c09/previewer.png 624w,\\n/static/d209c773392509f97e2c18c952a1edac/6d2da/previewer.png 936w,\\n/static/d209c773392509f97e2c18c952a1edac/04784/previewer.png 1174w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"可喜可贺，可喜可贺！\"), \"\\n\", React.createElement(_components.h2, null, \"排序功能优化\"), \"\\n\", React.createElement(_components.p, null, \"原脚本的预览功能已经能够非常好地实现笔者需要的能力了，笔者想要在此基础上加入一些额外的能力或做一些优化，如：\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"Feature：支持按照发布日期排序（相当于过滤掉收藏量小于指定值的作品）。\"), \"\\n\", React.createElement(_components.li, null, \"Feature：支持在用户作品页进行排序。\"), \"\\n\", React.createElement(_components.li, null, \"Feature：排序结果高亮显示“优质作品”，即收藏量增长速率高的作品。需要定义并实现增长速率函数。\"), \"\\n\", React.createElement(_components.li, null, \"Performance：排序结果滑动到底部时加载更多，避免一次性渲染全部导致内存占用过大。\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"但是目前仍处于咕咕咕状态，敬请期待 XD\"));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import GATSBY_COMPILED_MDX from \"/home/runner/work/homepage/homepage/blog/posts/pixiv-previewer.mdx\";\nimport {Fancybox} from \"@fancyapps/ui\";\nimport {MDXProvider} from \"@mdx-js/react\";\nimport dayjs from \"dayjs\";\nimport {Link} from \"gatsby\";\nimport * as React from \"react\";\nimport Card from \"../components/card\";\nimport Category from \"../components/category\";\nimport SEO from \"../components/seo\";\nimport Tag from \"../components/tag\";\nconst FancyBoxImage = props => {\n  const {alt = \"The author is too lazy to give an alt\", src, ...restProps} = props;\n  return React.createElement(\"a\", {\n    href: src,\n    \"data-fancybox\": \"gallery\",\n    \"data-caption\": alt\n  }, React.createElement(\"img\", Object.assign({\n    src: src,\n    alt: alt\n  }, restProps)));\n};\nconst ALink = _ref => {\n  let {href = \"\", children} = _ref;\n  const isExternalHref = !(href !== null && href !== void 0 && href.startsWith(\"#\"));\n  const parsedHref = isExternalHref ? href : `#${encodeURIComponent(href.slice(1))}`;\n  return React.createElement(\"a\", {\n    href: parsedHref,\n    target: isExternalHref ? \"_blank\" : undefined,\n    rel: \"noreferrer\"\n  }, children);\n};\nconst components = {\n  a: ALink,\n  img: FancyBoxImage,\n  Card,\n  Link\n};\nconst PostTemplate = _ref2 => {\n  let {children, data} = _ref2;\n  const {mdx: {frontmatter: {title, date: dateString, updated: updatedDateString, categories, tags, timeliness = true}}} = data;\n  const articleRef = React.useRef(null);\n  const date = dayjs(dateString);\n  const updatedDate = updatedDateString ? dayjs(updatedDateString) : date;\n  const today = dayjs();\n  const diffDays = today.diff(updatedDate, \"days\");\n  React.useEffect(() => {\n    var _articleRef$current;\n    const optimizedImageLinks = (_articleRef$current = articleRef.current) === null || _articleRef$current === void 0 ? void 0 : _articleRef$current.querySelectorAll(\"a.gatsby-resp-image-link\");\n    optimizedImageLinks === null || optimizedImageLinks === void 0 ? void 0 : optimizedImageLinks.forEach(link => {\n      const image = link.children.item(1);\n      link.setAttribute(\"data-fancybox\", \"gallery\");\n      link.setAttribute(\"data-caption\", image.alt);\n    });\n    Fancybox.bind(\"[data-fancybox]\");\n    return () => Fancybox.unbind(\"[data-fancybox]\");\n  }, []);\n  return React.createElement(\"div\", {\n    className: \"mx-auto flex max-w-xl flex-col gap-y-12\"\n  }, React.createElement(\"div\", {\n    className: \"flex flex-col gap-4\"\n  }, (categories === null || categories === void 0 ? void 0 : categories.length) && React.createElement(Category, {\n    name: categories[0],\n    className: \"item-selectable\"\n  }), React.createElement(\"h1\", {\n    className: \"text-3xl font-bold\"\n  }, title), React.createElement(\"div\", {\n    className: \"item-secondary flex flex-col gap-2 lg:flex-row\"\n  }, dateString && React.createElement(\"span\", {\n    title: `首次发布于：${date.toString()}\\n最后更新于：${updatedDate.toString()}`\n  }, date.format(\"MM 月 DD 日 YYYY 年\")), (tags === null || tags === void 0 ? void 0 : tags.length) && React.createElement(\"div\", {\n    className: \"flex flex-1 flex-wrap gap-2 lg:before:content-['\\u2022']\"\n  }, tags.map(tag => React.createElement(Tag, {\n    key: tag,\n    name: tag,\n    className: \"item-secondary item-selectable\"\n  }))))), React.createElement(\"article\", {\n    ref: articleRef,\n    className: \"heti post-entry\"\n  }, timeliness && diffDays > 365 && React.createElement(\"blockquote\", {\n    className: \"border-l-4 border-orange-400\"\n  }, \"\\u8FD9\\u662F\\u4E00\\u7BC7\", React.createElement(\"strong\", null, \"\\u6700\\u540E\\u66F4\\u65B0\\u4E8E \", diffDays, \" \\u5929\\u524D\"), \"\\u7684\\u535A\\u5BA2\\uFF0C\\u5185\\u5BB9\\u53EF\\u80FD\\u968F\\u7740\\u65F6\\u95F4\\u7684\\u63A8\\u79FB\\u800C\\u53D8\\u5F97\\u4E0D\\u518D\\u9002\\u7528\\uFF0C\\u5EFA\\u8BAE\\u60A8\\u4ED4\\u7EC6\\u8BC4\\u4F30\\u4FE1\\u606F\\u7684\\u6709\\u6548\\u6027\\u3002\"), React.createElement(MDXProvider, {\n    components: components\n  }, children)));\n};\nconst query = \"2697480803\";\nexport const Head = _ref3 => {\n  let {data} = _ref3;\n  return React.createElement(SEO, {\n    title: String(data.mdx.frontmatter.title)\n  });\n};\nPostTemplate\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PostTemplate, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\n"],"names":["_createMdxContent","props","_components","Object","assign","p","ol","li","strong","a","h2","h3","span","ul","_provideComponents","components","React","href","dangerouslySetInnerHTML","__html","wrapper","MDXLayout","_ref","children","isExternalHref","startsWith","parsedHref","encodeURIComponent","slice","target","undefined","rel","img","alt","src","restProps","Card","Link","PostTemplate","_ref2","data","mdx","frontmatter","title","date","dateString","updated","updatedDateString","categories","tags","timeliness","articleRef","dayjs","updatedDate","diffDays","diff","_articleRef$current","optimizedImageLinks","current","querySelectorAll","forEach","link","image","item","setAttribute","Fancybox","bind","unbind","className","length","Category","name","toString","format","map","tag","Tag","key","ref","MDXProvider","Head","_ref3","SEO","String","GatsbyMDXWrapper","GATSBY_COMPILED_MDX"],"sourceRoot":""}