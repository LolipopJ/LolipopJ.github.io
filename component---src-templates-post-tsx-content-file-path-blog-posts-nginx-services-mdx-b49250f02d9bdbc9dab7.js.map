{"version":3,"file":"component---src-templates-post-tsx-content-file-path-blog-posts-nginx-services-mdx-b49250f02d9bdbc9dab7.js","mappings":"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","sources":["webpack://homepage/./blog/posts/nginx-services.mdx","webpack://homepage/./src/templates/post.tsx"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    span: \"span\",\n    blockquote: \"blockquote\",\n    h3: \"h3\",\n    h4: \"h4\",\n    a: \"a\",\n    strong: \"strong\",\n    img: \"img\",\n    ul: \"ul\",\n    li: \"li\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.p, null, \"这些天在阿里云的 ECS 服务器上捣鼓自己的东西，通过 Nginx 转发请求，允许以域名的方式访问到笔者开设的不同站点、服务。\"), \"\\n\", React.createElement(_components.p, null, \"笔者撰写本篇文章，晒晒在服务器上都做了哪些工作，也希望能为您提供一些启发。\"), \"\\n\", React.createElement(_components.h2, null, \"安装最新版本的 Nginx\"), \"\\n\", React.createElement(_components.p, null, \"笔者使用的服务器为 CentOS 7 系统，默认的 yum 源中包含的 Nginx 版本为 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">1.20.1</code>\"\n    }\n  }), \"（2021-05-21）。\"), \"\\n\", React.createElement(_components.p, null, \"更新 yum 源，添加 Nginx 的官方源：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token function\\\">rpm</span> <span class=\\\"token parameter variable\\\">-ivh</span> http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"确认 Nginx 官方源拉取成功：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">$ yum repolist\\nLoaded plugins: fastestmirror\\nLoading mirror speeds from cached hostfile\\n * centos-sclo-rh: mirrors.ustc.edu.cn\\n * centos-sclo-sclo: mirrors.ustc.edu.cn\\nnginx                                                                        <span class=\\\"token operator\\\">|</span> <span class=\\\"token number\\\">2.9</span> kB  00:00:00\\nnginx/x86_64/primary_db                                                      <span class=\\\"token operator\\\">|</span>  <span class=\\\"token number\\\">91</span> kB  00:00:00\\nrepo <span class=\\\"token function\\\">id</span>                            repo name                                                  status\\nnginx/x86_64                       nginx repo                                                   <span class=\\\"token number\\\">338</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"重新安装 Nginx：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">yum <span class=\\\"token function\\\">install</span> nginx</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"查看当前的 Nginx 版本：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">$ nginx <span class=\\\"token parameter variable\\\">-v</span>\\nnginx version: nginx/1.26.0</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h2, null, \"提供静态内容服务\"), \"\\n\", React.createElement(_components.blockquote, null, \"\\n\", React.createElement(_components.p, null, \"Web 服务器的一个重要任务是提供文件（比如图片或者静态 HTML 页面）服务。\"), \"\\n\"), \"\\n\", React.createElement(_components.h3, null, \"静态站点服务\"), \"\\n\", React.createElement(_components.h4, null, \"部署静态站点\"), \"\\n\", React.createElement(_components.p, null, \"要对外提供静态站点非常简单，只需要将站点的静态资源放置在服务器上，再通过 Nginx 暴露出去。\"), \"\\n\", React.createElement(_components.p, null, \"一个简单的例子是：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/nginx.conf\\nhttp {\\n  server {\\n    listen 443 ssl;\\n    http2 on;\\n\\n    ssl_certificate /etc/letsencrypt/live/towind.fun/fullchain.pem;\\n    ssl_certificate_key /etc/letsencrypt/live/towind.fun/privkey.pem;\\n\\n    server_name towind.fun www.towind.fun blog.towind.fun;\\n    root /var/www/towind.fun/blog;\\n  }\\n}</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"通过上面的配置，笔者只需要将自己博客的静态资源放置在 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/var/www/towind.fun/blog</code>\"\n    }\n  }), \" 目录，就可以通过 \", React.createElement(_components.a, {\n    href: \"https://towind.fun\"\n  }, \"https://towind.fun\"), \" 等域名访问到啦。\"), \"\\n\", React.createElement(_components.p, null, \"当然，笔者不希望有这么多个域名显示完全一样的东西，我们可以配置域名跳转，将请求重定向到一个域名上：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/nginx.conf\\nhttp {\\n  server {\\n    # ...https configurations\\n    server_name towind.fun www.towind.fun;\\n    rewrite ^/(.*)$ https://blog.towind.fun/$1 permanent;\\n  }\\n}</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"现在，访问 \", React.createElement(_components.a, {\n    href: \"https://towind.fun\"\n  }, \"https://towind.fun\"), \" 和 \", React.createElement(_components.a, {\n    href: \"https://www.towind.fun\"\n  }, \"https://www.towind.fun\"), \" 时，浏览器将自动 301 重定向到 \", React.createElement(_components.a, {\n    href: \"https://blog.towind.fun%E3%80%82\"\n  }, \"https://blog.towind.fun。\")), \"\\n\", React.createElement(_components.p, null, \"此外，笔者为了更好的 SEO，缩短了链接的级数，即从 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/YYYY/MM/DD/blog-title</code>\"\n    }\n  }), \" -> \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/YYYYMMDD/blog-title</code>\"\n    }\n  }), \"。那么就需要将过去被搜索引擎收录的链接，重定向到新的链接，避免用户访问到 404 页面。可以编写配置如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/nginx.conf\\nhttp {\\n  server {\\n    # ...https configurations\\n    server_name blog.towind.fun;\\n    rewrite &quot;^/(\\\\d{4})/(\\\\d{2})/(\\\\d{2})/(.+)$&quot; /$1$2$3/$4 permanent;\\n  }\\n}</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"通过简单的正则匹配即可实现链接重定向。\"), \"\\n\", React.createElement(_components.h4, null, \"抽取通用配置\"), \"\\n\", React.createElement(_components.p, null, \"Nginx 配置中存在大量重复的内容，我们可以将这些内容提取出来，单独放置在某个目录下，通过 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">include</code>\"\n    }\n  }), \" 指令引入。\"), \"\\n\", React.createElement(_components.p, null, \"例如对于 HTTPS 配置，可以提取为：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/conf.shared.d/https.conf\\nlisten 443 ssl;\\nhttp2 on;\\n\\nssl_certificate /etc/letsencrypt/live/towind.fun/fullchain.pem;\\nssl_certificate_key /etc/letsencrypt/live/towind.fun/privkey.pem;</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"在需要的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">server</code>\"\n    }\n  }), \" 块中引入：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/nginx.conf\\nhttp {\\n  server {\\n    include /etc/nginx/conf.shared.d/https.conf;\\n    server_name blog.towind.fun;\\n  }\\n}</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"又如希望用户在访问 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">http://</code>\"\n    }\n  }), \" 时自动跳转到 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">https://</code>\"\n    }\n  }), \"，可以提取为：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/conf.shared.d/http.conf\\nlisten 80;\\nreturn 301 https://$http_host$request_uri;</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"像这样抽取出不同服务里重复的配置，能够有效地降低后续的维护成本。\"), \"\\n\", React.createElement(_components.h4, null, \"静态站点持续部署\"), \"\\n\", React.createElement(_components.p, null, \"由于静态站点的源码均托管在 Github 上，当新的代码提交后，希望能够自动更新服务器上的静态资源内容。笔者通过 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">crontab</code>\"\n    }\n  }), \" 配置定时任务来实现这个需求：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token number\\\">0</span> <span class=\\\"token number\\\">0,12</span>,18 * * * /path/to/update-blog.sh <span class=\\\"token operator\\\">>></span> /path/to/update-blog.log <span class=\\\"token operator\\\"><span class=\\\"token file-descriptor important\\\">2</span>></span><span class=\\\"token file-descriptor important\\\">&amp;1</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"上面的配置表示：在每天的 0, 12, 18 点整自动执行更新博客的脚本 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/path/to/update-blog.sh</code>\"\n    }\n  }), \"，执行的标准输出和错误输出重定向到指定日志文件 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/path/to/update-blog.log</code>\"\n    }\n  }), \"。\"), \"\\n\", React.createElement(_components.p, null, \"至于更新脚本的实现则颇为简单，如果构建后的静态文件已经存放到了 Github 仓库的某个分支，那么只需要到本地的目录执行 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">git pull</code>\"\n    }\n  }), \" 命令即可。例如：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token comment\\\"># /path/to/update-blog.sh</span>\\n<span class=\\\"token builtin class-name\\\">cd</span> /var/www/towind.fun/blog\\n<span class=\\\"token function\\\">git</span> pull</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"如果没有存放构建后的静态文件，或构建后的静态文件无法直接使用（例如 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">bashPath</code>\"\n    }\n  }), \" 不同），那么额外执行一次构建命令即可。例如：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token comment\\\"># /path/to/update-example.sh</span>\\n<span class=\\\"token builtin class-name\\\">cd</span> /path/to/example\\n<span class=\\\"token function\\\">git</span> pull\\n<span class=\\\"token function\\\">npm</span> run build</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"考虑到我们不会在服务器上编写代码并推送，可以使用 HTTPS 协议的远程地址，而不用经过 SSH 验证：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token builtin class-name\\\">cd</span> /path/to/example\\n<span class=\\\"token comment\\\"># Change from git@github.com:username/example.git</span>\\n<span class=\\\"token function\\\">git</span> remote set-url origin https://github.com/username/example.git</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, null, \"静态站点访问性能优化\"), \"\\n\", React.createElement(_components.p, null, \"针对静态站点的访问性能优化，笔者主要配置了 Nginx 中\", React.createElement(_components.strong, null, \"压缩\"), \"和\", React.createElement(_components.strong, null, \"缓存\"), \"两部分内容，另外关闭了负优化的 Cloudflare CDN。\"), \"\\n\", React.createElement(_components.h4, null, \"Gzip 压缩\"), \"\\n\", React.createElement(_components.p, null, \"配置 Nginx 启用 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">gzip</code>\"\n    }\n  }), \" 压缩，能够\", React.createElement(_components.strong, null, \"显著减少\"), \"发送给客户端的静态文件体积。配置内容如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/nginx.conf\\nhttp {\\n  # 启用 gzip 压缩功能\\n  gzip on;\\n  # 压缩文件的最小大小为 10KB\\n  gzip_min_length 10K;\\n  # 压缩等级为 6。等级越低压缩速度越快，文件压缩比越小；反之速度越慢，压缩比越大\\n  gzip_comp_level 6;\\n  # 压缩的 MIME 类型\\n  gzip_types text/plain text/css application/json text/javascript application/javascript application/x-javascript text/xml application/xml application/xml+rss;\\n}</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"对于原来 1151KB 的脚本文件：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">$ ll --block-size<span class=\\\"token operator\\\">=</span>k <span class=\\\"token operator\\\">|</span> <span class=\\\"token function\\\">grep</span> main.js\\n-rw-r--r-- <span class=\\\"token number\\\">1</span> root root 1151K main.js</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"压缩后发送给客户端只有 442KB 大小，减少了大约 62% 的体积：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/e722279cc3ed1dedecc99b42401b0506/eafa0/assets-gzip.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 30.76923076923077%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWElEQVR42j2P627TQBCF/RSlJWmVi+Mk9t5y8a2OnbgNJCGl8KOqBEIFClJegPf/GDuIH6PZc843s7tenhmSRcrD9h0f7mr0eMxCReyqFZs0Ro18UmvYr0vKeN7qYjHnUFdkTqODEessEb1mqSZ46fuCvPpEkt5TFjXOLtGhgKHBKteWiSw60jh9PhvJmnymm1yyqcbMljh5iDfpvCHqXRD2LkmCa6zfRQ+7RP23GOmq30ENOq1WUk121h304F/Wu5Kf9XGTId5xnTELegJ0ZdkNdnjdLtksDSs7pY4tK9d0x2N9y/TmklSNWM1CtumcomUMdWLbOe90yPh1LPm+y6Vu+XkoeKocP/YF37YJL+I33uux4s/Xj/x+KFv+9LjhRZjTPuf5yxO751c+xz5eMh1QmDG5DshVQCa3J+GQNPTPPfLPfjQSZvyfzcRr8ky42IRY44gnff4Crie/0py7cj0AAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"assets-gzip\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/e722279cc3ed1dedecc99b42401b0506/39c09/assets-gzip.png\\\"\\n        srcset=\\\"/static/e722279cc3ed1dedecc99b42401b0506/680fe/assets-gzip.png 156w,\\n/static/e722279cc3ed1dedecc99b42401b0506/17474/assets-gzip.png 312w,\\n/static/e722279cc3ed1dedecc99b42401b0506/39c09/assets-gzip.png 624w,\\n/static/e722279cc3ed1dedecc99b42401b0506/6d2da/assets-gzip.png 936w,\\n/static/e722279cc3ed1dedecc99b42401b0506/eafa0/assets-gzip.png 939w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"在启用 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">gzip</code>\"\n    }\n  }), \" 压缩之前，笔者从访问自己的博客到文章内容显示出来，要等待大约 5 秒钟的时间。说实话，若不是自己家的站点，早已不耐烦地 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">ctrl + w</code>\"\n    }\n  }), \" 关闭了。如今只需大约 2 秒钟的时间，给访问体验带来了质的提升。\"), \"\\n\", React.createElement(_components.p, null, \"实际观察 Github Pages 的网络响应就会发现，返回给客户端的脚本或样式等文件也都经过了压缩（\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">br</code>\"\n    }\n  }), \" 编码），可惜笔者到现在才知道去配置，知识积累的重要性不言而喻。\"), \"\\n\", React.createElement(_components.h4, null, \"Cache-Control 缓存\"), \"\\n\", React.createElement(_components.p, null, \"配置 Nginx 启用 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">Cache-Control</code>\"\n    }\n  }), \" 缓存，由客户端控制是否使用本地已缓存的文件。配置内容如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/conf.shared.d/cache.conf\\n# 协商缓存验证 .html 文件\\nlocation ~* .(html)$ {\\n  add_header Cache-Control &quot;no-cache&quot;;\\n}\\n# 缓存 .css, .js 文件，缓存过期时间为 1 天，缓存过期时确保获取到最新文件\\nlocation ~* .(css|js)$ {\\n  add_header Cache-Control &quot;public, must-revalidate, max-age=86400&quot;;\\n}\\n# 缓存图片、视频等文件，缓存过期时间为 1 年，不得对文件进行转换\\nlocation ~* .(png|jpg|jpeg|gif|ico|svg|mp4|ogg|ogv|webm|htc|xml|woff|gz|zip|7z)$ {\\n  add_header Cache-Control &quot;public, no-transform, max-age=31536000&quot;;\\n}</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h4, null, \"CDN 服务\"), \"\\n\", React.createElement(_components.p, null, \"笔者使用 Cloudflare 作为 DNS 解析服务器，但考虑到站点面向的用户主要来自中国，且访问量不会很大，因此关闭了 Cloudflare 提供的 DNS 代理服务。\"), \"\\n\", React.createElement(_components.img, {\n    src: \"https://i.imgur.com/9H8utju.png\",\n    alt: \"cloudflare-cdn-speed-down-for-me\"\n  }), \"\\n\", React.createElement(_components.h3, null, \"静态文件服务\"), \"\\n\", React.createElement(_components.p, null, \"笔者也对外提供的静态文件下载的服务，配置形如：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/conf.d/download.conf\\nserver {\\n  include /etc/nginx/conf.shared.d/http.conf;\\n  server_name download.towind.fun;\\n}\\n\\nserver {\\n  include /etc/nginx/conf.shared.d/https.conf;\\n  server_name download.towind.fun;\\n  root /var/www/towind.fun/download;\\n  # 允许浏览静态文件目录\\n  autoindex on;\\n  # 显示静态文件大小\\n  autoindex_exact_size on;\\n  # 显示文件时间为服务器时间\\n  autoindex_localtime on;\\n  # 设置字符集为 utf-8，避免中文乱码\\n  charset utf-8;\\n}</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"上面的配置表明：笔者将对外提供下载的静态文件放置在服务器的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/var/www/towind.fun/download</code>\"\n    }\n  }), \" 目录下；当访问 \", React.createElement(_components.a, {\n    href: \"https://download.towind.fun\"\n  }, \"https://download.towind.fun\"), \" 时，就可以看见所有可下载的静态文件。\"), \"\\n\", React.createElement(_components.h2, null, \"提供代理服务器\"), \"\\n\", React.createElement(_components.blockquote, null, \"\\n\", React.createElement(_components.p, null, \"Nginx 的一个常见用途是作为一个代理服务器，作用是接收请求并转发给被代理的服务器，从中取得响应，并将其发送回客户端。\"), \"\\n\"), \"\\n\", React.createElement(_components.h3, null, \"访问内网服务\"), \"\\n\", React.createElement(_components.p, null, \"笔者将一些服务部署在了没有公网 IP 地址的内网服务器上，为了能通过域名访问到这些服务，首先使用了 frp 进行内网穿透：将拥有公网 IP 地址的服务器（公网服务器）作为 frp 服务端，将内网服务器作为 frp 客户端即可。\"), \"\\n\", React.createElement(_components.p, null, \"配置 Nginx，将特定域名的请求转发到对应的 frp 服务端端口：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/conf.d/xxx.conf\\nserver {\\n  include /etc/nginx/conf.shared.d/https.conf;\\n  server_name xxx.towind.fun;\\n  location = / {\\n    proxy_pass http://127.0.0.1:15244;\\n  }\\n}</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"上面的配置表示：当通过 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">https://xxx.towind.fun</code>\"\n    }\n  }), \" 访问公网服务器时，请求将转发至本地的 15244 端口，再经由 frp 访问到内网服务器上对应的服务。\"), \"\\n\", React.createElement(_components.h3, null, \"内网服务访问性能优化\"), \"\\n\", React.createElement(_components.p, null, \"Nginx 提供了服务端的 Proxy 缓存功能，如果从内网服务器返回的响应头上包含缓存控制的信息，Nginx 将自动缓存资源到公网服务器，而无需每次都去请求内网服务器。\"), \"\\n\", React.createElement(_components.p, null, \"核心的配置内容如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"conf\\\"><pre class=\\\"language-conf\\\"><code class=\\\"language-conf\\\"># /etc/nginx/nginx.conf\\nhttp {\\n  proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=defaultcache:10m max_size=1g;\\n\\n  server {\\n    proxy_cache defaultcache;\\n    # （非必要）响应头添加自定义的 Nginx-Proxy-Cache 字段，如果值为 HIT 则表示命中了公网服务器本地的缓存\\n    add_header Nginx-Proxy-Cache $upstream_cache_status;\\n  }\\n}</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"上面的配置表示：\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"缓存文件保存在 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/var/cache/nginx</code>\"\n    }\n  }), \" 目录。\"), \"\\n\", React.createElement(_components.li, null, \"缓存文件使用 2 级目录存储，第一级目录包含最多 16^1 个文件夹，第二级目录包含最多 16^2 个文件夹。即总共最多包含 16^1 * 16^2 = 4096 个文件夹。\"), \"\\n\", React.createElement(_components.li, null, \"在共享内存中设置了一块别名为 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">defaultcache</code>\"\n    }\n  }), \"，大小为 10MB 的存储区域，用于存储 key 字符串。有助于 Nginx 快速判断请求是否命中本地的缓存。\"), \"\\n\", React.createElement(_components.li, null, \"缓存文件占用的最大空间为 1GB。达到配额时，Nginx 会自动删除掉使用频率最低的缓存文件。\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"这样可以有效降低内网服务器（源服务器）的负担。\"), \"\\n\", React.createElement(_components.p, null, \"一个命中 Proxy 缓存的例子如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/0d5bca22380169f48912d3374b2af54c/2c95d/proxy-cache-hit.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 51.28205128205129%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5ElEQVR42m1Sy3KbQBDUfzi2HiABgmWB5bUgwIskkIIiJfYtqRxSuTn/f+4MG0tlp3zommJqpunu2UmXeMhcA9Izkbsm+irDcxXgnFoYMpewxpBTlS6OqY1DQogtKH+O9hVbvsAuMLAPl5j86gq8PPf4Q/h9avDUK/z8ekLmWXBmd1jP7xAsZ6gjhjJYYxO52IQemtgnMKgs1H2X5nxrgcnnLMLQZLi0Bc6PEn1T4vv5qJdsImTGFCEzsVc5cuYgtA3w1fyGgEjG6hkP4JaByWi1Fj4SsiscA7u6wI/LgMMmQ8psGpwicBbo6KfbXKDga937H+xKWHELXZmQIhc+NRuZ4Etboi8EKbLgLT4hXM1QcgfSt8CXDxq++R7MuNdqJ0PKcKxzfNtV2OcRVJHipEpUlFXBbSJdgY1LROLqCO71T8b6IWEb2tjJGB0p8qmpigxPB4VdEdMBGBHNKDcTTRJAkt0RNR1EOKbOjZlTjVuGNTNomKNNOSJrDkWWh0ZiqHIowbSqhJbH70ZwIqNZOqSkCK5k7wj3caAtX7ZkWUZoFdXDFjEdQKQhvMBFSOpataEnEmk3I+H4XCK6+FXljbAR/zKshAdhk0JVY7gckZcpJF3aJ9sjoWo3+tn4r8tv1b0l/Aui1jvVjLpSmQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"assets-gzip\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/0d5bca22380169f48912d3374b2af54c/39c09/proxy-cache-hit.png\\\"\\n        srcset=\\\"/static/0d5bca22380169f48912d3374b2af54c/680fe/proxy-cache-hit.png 156w,\\n/static/0d5bca22380169f48912d3374b2af54c/17474/proxy-cache-hit.png 312w,\\n/static/0d5bca22380169f48912d3374b2af54c/39c09/proxy-cache-hit.png 624w,\\n/static/0d5bca22380169f48912d3374b2af54c/6d2da/proxy-cache-hit.png 936w,\\n/static/0d5bca22380169f48912d3374b2af54c/2c95d/proxy-cache-hit.png 1099w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import GATSBY_COMPILED_MDX from \"/home/runner/work/homepage/homepage/blog/posts/nginx-services.mdx\";\nimport {Fancybox} from \"@fancyapps/ui\";\nimport {MDXProvider} from \"@mdx-js/react\";\nimport dayjs from \"dayjs\";\nimport {Link} from \"gatsby\";\nimport * as React from \"react\";\nimport Card from \"../components/card\";\nimport Category from \"../components/category\";\nimport SEO from \"../components/seo\";\nimport Tag from \"../components/tag\";\nconst FancyBoxImage = props => {\n  const {alt = \"The author is too lazy to give an alt\", src, ...restProps} = props;\n  return React.createElement(\"a\", {\n    href: src,\n    \"data-fancybox\": \"gallery\",\n    \"data-caption\": alt\n  }, React.createElement(\"img\", Object.assign({\n    src: src,\n    alt: alt\n  }, restProps)));\n};\nconst ALink = _ref => {\n  let {href = \"\", children} = _ref;\n  const isExternalHref = !(href !== null && href !== void 0 && href.startsWith(\"#\"));\n  const parsedHref = isExternalHref ? href : `#${encodeURIComponent(href.slice(1))}`;\n  return React.createElement(\"a\", {\n    href: parsedHref,\n    target: isExternalHref ? \"_blank\" : undefined,\n    rel: \"noreferrer\"\n  }, children);\n};\nconst components = {\n  a: ALink,\n  img: FancyBoxImage,\n  Card,\n  Link\n};\nconst PostTemplate = _ref2 => {\n  let {children, data} = _ref2;\n  const {mdx: {frontmatter: {title, date: dateString, updated: updatedDateString, categories, tags, timeliness}}} = data;\n  const articleRef = React.useRef(null);\n  const date = dayjs(dateString);\n  const updatedDate = updatedDateString ? dayjs(updatedDateString) : date;\n  const today = dayjs();\n  const diffDays = today.diff(updatedDate, \"days\");\n  React.useEffect(() => {\n    var _articleRef$current;\n    const optimizedImageLinks = (_articleRef$current = articleRef.current) === null || _articleRef$current === void 0 ? void 0 : _articleRef$current.querySelectorAll(\"a.gatsby-resp-image-link\");\n    optimizedImageLinks === null || optimizedImageLinks === void 0 ? void 0 : optimizedImageLinks.forEach(link => {\n      const image = link.children.item(1);\n      link.setAttribute(\"data-fancybox\", \"gallery\");\n      link.setAttribute(\"data-caption\", image.alt);\n    });\n    Fancybox.bind(\"[data-fancybox]\");\n    return () => Fancybox.unbind(\"[data-fancybox]\");\n  }, []);\n  return React.createElement(\"div\", {\n    className: \"mx-auto flex max-w-xl flex-col gap-y-12\"\n  }, React.createElement(\"div\", {\n    className: \"flex flex-col gap-4\"\n  }, (categories === null || categories === void 0 ? void 0 : categories.length) && React.createElement(Category, {\n    name: categories[0],\n    className: \"item-selectable\"\n  }), React.createElement(\"h1\", {\n    className: \"text-3xl font-bold\"\n  }, title), React.createElement(\"div\", {\n    className: \"item-secondary flex flex-col gap-2 lg:flex-row\"\n  }, dateString && React.createElement(\"span\", {\n    title: `首次发布于：${date.toString()}\\n最后更新于：${updatedDate.toString()}`\n  }, date.format(\"MM 月 DD 日 YYYY 年\")), (tags === null || tags === void 0 ? void 0 : tags.length) && React.createElement(\"div\", {\n    className: \"flex flex-1 flex-wrap gap-2 lg:before:content-['\\u2022']\"\n  }, tags.map(tag => React.createElement(Tag, {\n    key: tag,\n    name: tag,\n    className: \"item-secondary item-selectable\"\n  }))))), React.createElement(\"article\", {\n    ref: articleRef,\n    className: \"heti post-entry\"\n  }, timeliness !== false && diffDays > 365 && React.createElement(\"blockquote\", {\n    className: \"border-l-4 border-orange-400\"\n  }, \"\\u8FD9\\u662F\\u4E00\\u7BC7\", React.createElement(\"strong\", null, \"\\u6700\\u540E\\u66F4\\u65B0\\u4E8E \", diffDays, \" \\u5929\\u524D\"), \"\\u7684\\u535A\\u5BA2\\uFF0C\\u5185\\u5BB9\\u53EF\\u80FD\\u968F\\u7740\\u65F6\\u95F4\\u7684\\u63A8\\u79FB\\u800C\\u53D8\\u5F97\\u4E0D\\u518D\\u9002\\u7528\\uFF0C\\u5EFA\\u8BAE\\u60A8\\u4ED4\\u7EC6\\u8BC4\\u4F30\\u4FE1\\u606F\\u7684\\u6709\\u6548\\u6027\\u3002\"), React.createElement(MDXProvider, {\n    components: components\n  }, children)));\n};\nconst query = \"24864635\";\nexport const Head = _ref3 => {\n  let {data} = _ref3;\n  return React.createElement(SEO, {\n    title: String(data.mdx.frontmatter.title)\n  });\n};\nPostTemplate\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PostTemplate, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\n"],"names":["_createMdxContent","props","_components","Object","assign","p","h2","span","blockquote","h3","h4","a","strong","img","ul","li","_provideComponents","components","React","dangerouslySetInnerHTML","__html","href","src","alt","wrapper","MDXLayout","_ref","children","isExternalHref","startsWith","parsedHref","encodeURIComponent","slice","target","undefined","rel","restProps","Card","Link","PostTemplate","_ref2","data","mdx","frontmatter","title","date","dateString","updated","updatedDateString","categories","tags","timeliness","articleRef","dayjs","updatedDate","diffDays","diff","_articleRef$current","optimizedImageLinks","current","querySelectorAll","forEach","link","image","item","setAttribute","Fancybox","bind","unbind","className","length","Category","name","toString","format","map","tag","Tag","key","ref","MDXProvider","Head","_ref3","SEO","String","GatsbyMDXWrapper","GATSBY_COMPILED_MDX"],"sourceRoot":""}