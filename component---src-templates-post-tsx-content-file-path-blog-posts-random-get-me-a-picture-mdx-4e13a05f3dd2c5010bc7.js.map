{"version":3,"file":"component---src-templates-post-tsx-content-file-path-blog-posts-random-get-me-a-picture-mdx-4e13a05f3dd2c5010bc7.js","mappings":"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","sources":["webpack://homepage/./blog/posts/random-get-me-a-picture.mdx","webpack://homepage/./src/templates/post.tsx"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    span: \"span\",\n    h2: \"h2\",\n    h3: \"h3\",\n    h4: \"h4\",\n    strong: \"strong\",\n    ul: \"ul\",\n    li: \"li\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.p, null, \"笔者自高中到现在，游走于 Pixiv 若干载，不慎收藏了许多名家雅作。\"), \"\\n\", React.createElement(_components.p, null, \"独乐乐不如众乐乐！笔者想做一个 web 页面来随机访问我的收藏，不过在此之前，可以先实现服务端上的内容。再之后做网页时，不过是简单的读取数据库罢了！\"), \"\\n\", React.createElement(_components.p, null, \"最初，笔者以为得将我的库存全部放到服务器上项目中去，然后随机访问其中的图片实现功能，但这样做很难得同步，遂搁置。不过，笔者在最近发现有一个 \", React.createElement(_components.a, {\n    href: \"https://pixiv.re/\"\n  }, \"Pixiv 图片代理网站\"), \" 可以快速下载到图片，大喜，于是开始了这个小工程。\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/eb06a9acfb6c6905fff1abc711cc8e16/3a188/pixiv-cat.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 48.71794871794871%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAAA/0lEQVR42qWS6W6EMAyE8/5P2NVCoYc4chCOnBCYOqjan9sVjfTJlhNZY2eYUgoZIQTmeYIx5sRai2VZqDYjxvgU59z5znsPVo0B74NDIQ1KZc9YSPvIP+n+a4pP+Z4jPiiadQe7lTVaoRAS4LcEFxMs4VaKhN/2l3BE2g+wsrjDWYd8UtpwHAf+c1jTduBSQ/ccsmnh9ITkwvWGwzBgHDU45+dSkRXu+/WGVVWhrmvc325QXCCtG3Yireu1hllZVjkrQiokH2hkf3ls1jQNtB5hyHeW/GSdRSBv5Tz7ayWlmRDCSx/G+r4/9yeEhJTyYfJM13VQvzWuRmzp793+AMMuC+PRYvzIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"请求需包含 Referer\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/eb06a9acfb6c6905fff1abc711cc8e16/39c09/pixiv-cat.png\\\"\\n        srcset=\\\"/static/eb06a9acfb6c6905fff1abc711cc8e16/680fe/pixiv-cat.png 156w,\\n/static/eb06a9acfb6c6905fff1abc711cc8e16/17474/pixiv-cat.png 312w,\\n/static/eb06a9acfb6c6905fff1abc711cc8e16/39c09/pixiv-cat.png 624w,\\n/static/eb06a9acfb6c6905fff1abc711cc8e16/6d2da/pixiv-cat.png 936w,\\n/static/eb06a9acfb6c6905fff1abc711cc8e16/5a791/pixiv-cat.png 1248w,\\n/static/eb06a9acfb6c6905fff1abc711cc8e16/3a188/pixiv-cat.png 1623w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"实现此功能分为两个阶段：一，为本地的图片生成数据库索引条目。二，开发 Telegram Bot 接口，随机从数据库索引中获取一张图片转发给聊天。\"), \"\\n\", React.createElement(_components.h2, null, \"为本地的 Pixiv 图片建立索引\"), \"\\n\", React.createElement(_components.h3, null, \"初始化数据库 Pixiv 图片索引信息\"), \"\\n\", React.createElement(_components.p, null, \"如果使用 Pixiv 图片代理的方法，只需要将 Artwork 的基本信息上传给我们的数据库即可。\"), \"\\n\", React.createElement(_components.p, null, \"根据\", React.createElement(_components.a, {\n    href: \"https://core.telegram.org/bots/api#sending-files\"\n  }, \"官方文档\"), \"，当发送图片文件时，Telegram API 对图片的大小有限制：直接使用 HTTP URL 的方式不超过 5 MB，服务器上传图片的方式不超过 10 MB（以\", React.createElement(_components.a, {\n    href: \"https://core.telegram.org/bots/api#senddocument\"\n  }, \"文件的格式\"), \"发送时，不超过 50 MB，本文不采用文件的格式发送）。因此，在设计数据库时，还需要考虑图片的大小。\"), \"\\n\", React.createElement(_components.p, null, \"设计 Sequenlize 数据库模型 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">ServicePixivCollection.js</code>\"\n    }\n  }), \" 如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> DataTypes <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"sequelize\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nmodule<span class=\\\"token punctuation\\\">.</span>exports <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">INTEGER</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">autoIncrement</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">primaryKey</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token comment\\\">// Pixiv artwork ID. Example: 95400283 for for 95400283_p${picIndex}.${picType}</span>\\n  <span class=\\\"token literal-property property\\\">picId</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">INTEGER</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">allowNull</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token comment\\\">// Artwork index. Example: 1 for ${pixivId}_p1.${picType}</span>\\n  <span class=\\\"token literal-property property\\\">picIndex</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">INTEGER</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">allowNull</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token comment\\\">// Artwork suffix type. Example: jpg for ${pixivId}_p${picIndex}.jpg</span>\\n  <span class=\\\"token literal-property property\\\">picType</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">TEXT</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">allowNull</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token comment\\\">// Artwork size, MB</span>\\n  <span class=\\\"token literal-property property\\\">picSize</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">FLOAT</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">allowNull</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token comment\\\">// Artwork save date</span>\\n  <span class=\\\"token literal-property property\\\">picCreatedAt</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">DATE</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">allowNull</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"如采用最小实现，也可以将上面的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">picId</code>\"\n    }\n  }), \", \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">picIndex</code>\"\n    }\n  }), \" 和 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">picType</code>\"\n    }\n  }), \" 合并为一个数据项，例如 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">picName</code>\"\n    }\n  }), \"，直接保存图片的名字。笔者考虑到后续可能会增添新的功能，于是将它们单独拎出来储存。\"), \"\\n\", React.createElement(_components.p, null, \"处理不同路径下的图片时，可能需要保存执行的情况。例如 A 目录在当前时间点进行维护，获取了所有的图片，下次读取 A 目录时，应当从上次维护的时间开始获取最新的图片。现在新加了 B 目录，如果从上次维护 A 的时间点开始读取图片的话，在时间点之前的图片将无法上传。因此，针对不同文件夹的维护，可以分别建立一个单独的数据项。\"), \"\\n\", React.createElement(_components.p, null, \"设计数据库模型 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">ServiceProcess.js</code>\"\n    }\n  }), \" 如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> DataTypes <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"sequelize\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nmodule<span class=\\\"token punctuation\\\">.</span>exports <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">INTEGER</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">autoIncrement</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">primaryKey</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">serviceId</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">UUID</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">defaultValue</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">UUIDV4</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">allowNull</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">serviceName</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">TEXT</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">allowNull</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">serviceConfig</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">TEXT</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">serviceSharedData</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">TEXT</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">lastExecAt</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">DATE</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">haveExecTime</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">type</span><span class=\\\"token operator\\\">:</span> DataTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token constant\\\">INTEGER</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">allowNull</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token literal-property property\\\">defaultValue</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"为 Sequelize 添加该模型，向 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">sequelize.js</code>\"\n    }\n  }), \" 添加如下代码：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> servicePixivCollectionModel <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"path/to/ServicePixivCollection\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> serviceProcessModel <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"path/to/ServiceProcess\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nsequelize<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">define</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"ServicePixivCollection\\\"</span><span class=\\\"token punctuation\\\">,</span> servicePixivCollectionModel<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nsequelize<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">define</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"ServiceProcess\\\"</span><span class=\\\"token punctuation\\\">,</span> serviceProcessModel<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"配置扫描图片的间隔时间和本地图片路径，编写 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">config.js</code>\"\n    }\n  }), \" 如下:\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\">module<span class=\\\"token punctuation\\\">.</span>exports <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">pixiv</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token literal-property property\\\">randomGetFromCollection</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">duration</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">3600</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">path</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">\\\"C:\\\\\\\\path\\\\\\\\to\\\\\\\\collection\\\"</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"扫描指定目录的图片文件，图片文件名称应满足从 Pixiv 下载图片的名称格式。例如：\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">95400283_p0.jpg</code>\"\n    }\n  }), \"，\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">95400283</code>\"\n    }\n  }), \" 为数据库中的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">picId</code>\"\n    }\n  }), \"，\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">_p0</code>\"\n    }\n  }), \" 的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">0</code>\"\n    }\n  }), \" 为 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">picIndex</code>\"\n    }\n  }), \"，\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">.jpg</code>\"\n    }\n  }), \" 中的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">jpg</code>\"\n    }\n  }), \" 为 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">picType</code>\"\n    }\n  }), \"。编写生成图片索引的代码 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">pixiv.js</code>\"\n    }\n  }), \" 如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> readdir<span class=\\\"token punctuation\\\">,</span> stat <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"fs/promises\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> path <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"path\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> config <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"path/to/config\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>pixiv<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> Sequelize <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"path/to/sequelize\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">generateCollectionIndex</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> serviceName <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"Generate Collection Index\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> bToMB <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">1024</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">1024</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// File size with decimal places</span>\\n  <span class=\\\"token keyword\\\">const</span> fileSizeReservedDecimalPlace <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">3</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> fileSizeReservedDecimalNum <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">10</span> <span class=\\\"token operator\\\">**</span> fileSizeReservedDecimalPlace<span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> sequelize <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">Sequelize</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> ServicePixivCollection <span class=\\\"token operator\\\">=</span> sequelize<span class=\\\"token punctuation\\\">.</span>models<span class=\\\"token punctuation\\\">.</span>ServicePixivCollection<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> ServiceProcess <span class=\\\"token operator\\\">=</span> sequelize<span class=\\\"token punctuation\\\">.</span>models<span class=\\\"token punctuation\\\">.</span>ServiceProcess<span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">let</span> collectionPaths <span class=\\\"token operator\\\">=</span> config<span class=\\\"token punctuation\\\">.</span>generateCollectionIndex<span class=\\\"token punctuation\\\">.</span>path<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>Array<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">isArray</span><span class=\\\"token punctuation\\\">(</span>collectionPaths<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    collectionPaths <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span>collectionPaths<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token comment\\\">// Get filenames in collection paths</span>\\n  <span class=\\\"token keyword\\\">let</span> allFiles <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">const</span> collectionPath <span class=\\\"token keyword\\\">of</span> collectionPaths<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">let</span> files <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n    files <span class=\\\"token operator\\\">=</span> files<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">concat</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">readdir</span><span class=\\\"token punctuation\\\">(</span>collectionPath<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">// Only keep files with Pixiv naming style</span>\\n    <span class=\\\"token keyword\\\">const</span> reg <span class=\\\"token operator\\\">=</span> <span class=\\\"token regex\\\"><span class=\\\"token regex-delimiter\\\">/</span><span class=\\\"token regex-source language-regex\\\">^\\\\d+_p\\\\d+.(jpg|png|gif)$</span><span class=\\\"token regex-delimiter\\\">/</span></span><span class=\\\"token punctuation\\\">;</span>\\n    files <span class=\\\"token operator\\\">=</span> files<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">filename</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">return</span> reg<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">test</span><span class=\\\"token punctuation\\\">(</span>filename<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">// Get file stat and resolve file info</span>\\n    <span class=\\\"token keyword\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">let</span> i <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span> i <span class=\\\"token operator\\\">&lt;</span> files<span class=\\\"token punctuation\\\">.</span>length<span class=\\\"token punctuation\\\">;</span> i<span class=\\\"token operator\\\">++</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">const</span> filename <span class=\\\"token operator\\\">=</span> files<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">const</span> filePath <span class=\\\"token operator\\\">=</span> path<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">join</span><span class=\\\"token punctuation\\\">(</span>collectionPath<span class=\\\"token punctuation\\\">,</span> filename<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> picIdSplitArr <span class=\\\"token operator\\\">=</span> filename<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">split</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"_p\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">const</span> picId <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">Number</span><span class=\\\"token punctuation\\\">(</span>picIdSplitArr<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> picIndexSplitArr <span class=\\\"token operator\\\">=</span> picIdSplitArr<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">split</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\".\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">const</span> picIndex <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">Number</span><span class=\\\"token punctuation\\\">(</span>picIndexSplitArr<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> picType <span class=\\\"token operator\\\">=</span> picIndexSplitArr<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">const</span> picStat <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">stat</span><span class=\\\"token punctuation\\\">(</span>filePath<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">const</span> picSize <span class=\\\"token operator\\\">=</span>\\n        Math<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">floor</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span>picStat<span class=\\\"token punctuation\\\">.</span>size <span class=\\\"token operator\\\">/</span> bToMB<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">*</span> fileSizeReservedDecimalNum<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">/</span>\\n        fileSizeReservedDecimalNum<span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// MB</span>\\n      <span class=\\\"token keyword\\\">const</span> picCreatedAt <span class=\\\"token operator\\\">=</span> picStat<span class=\\\"token punctuation\\\">.</span>mtimeMs<span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// ms</span>\\n\\n      files<span class=\\\"token punctuation\\\">[</span>i<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token literal-property property\\\">picName</span><span class=\\\"token operator\\\">:</span> filename<span class=\\\"token punctuation\\\">,</span>\\n        picId<span class=\\\"token punctuation\\\">,</span>\\n        picIndex<span class=\\\"token punctuation\\\">,</span>\\n        picType<span class=\\\"token punctuation\\\">,</span>\\n        picSize<span class=\\\"token punctuation\\\">,</span>\\n        picCreatedAt<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token comment\\\">// Only keep files that recently saved</span>\\n    <span class=\\\"token keyword\\\">const</span> serviceProcess <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> ServiceProcess<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">findOne</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">where</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span> serviceName<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token literal-property property\\\">serviceConfig</span><span class=\\\"token operator\\\">:</span> collectionPath <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>serviceProcess<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// Only update or create Pixiv artwork that saved after last time this service is done</span>\\n      <span class=\\\"token keyword\\\">let</span> lastUpdateIndexTime <span class=\\\"token operator\\\">=</span> serviceProcess<span class=\\\"token punctuation\\\">.</span>dataValues<span class=\\\"token punctuation\\\">.</span>lastExecAt<span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>lastUpdateIndexTime<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        lastUpdateIndexTime <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span>lastUpdateIndexTime<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getTime</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        files <span class=\\\"token operator\\\">=</span> files<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">pic</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token keyword\\\">return</span> pic<span class=\\\"token punctuation\\\">.</span>picCreatedAt <span class=\\\"token operator\\\">></span> lastUpdateIndexTime<span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">await</span> ServiceProcess<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">create</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n        serviceName<span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token literal-property property\\\">serviceConfig</span><span class=\\\"token operator\\\">:</span> collectionPath<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    allFiles <span class=\\\"token operator\\\">=</span> allFiles<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">concat</span><span class=\\\"token punctuation\\\">(</span>files<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> updateIndexAt <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">toISOString</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Update or create pic index</span>\\n  <span class=\\\"token keyword\\\">for</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">const</span> picFile <span class=\\\"token keyword\\\">of</span> allFiles<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// 注意：此处的 updateOrCreate() 为笔者自定义的方法</span>\\n    <span class=\\\"token comment\\\">// 其作用为：当存在 item 时，更新 item；不存在时，创建 item</span>\\n    <span class=\\\"token keyword\\\">await</span> sequelize<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">updateOrCreate</span><span class=\\\"token punctuation\\\">(</span>\\n      ServicePixivCollection<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token literal-property property\\\">picId</span><span class=\\\"token operator\\\">:</span> picFile<span class=\\\"token punctuation\\\">.</span>picId<span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token literal-property property\\\">picIndex</span><span class=\\\"token operator\\\">:</span> picFile<span class=\\\"token punctuation\\\">.</span>picIndex<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n      picFile<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token comment\\\">// Update service process record</span>\\n  ServiceProcess<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">update</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">lastExecAt</span><span class=\\\"token operator\\\">:</span> updateIndexAt<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">where</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span> serviceName <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  ServiceProcess<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">increment</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"haveExecTime\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">where</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span> serviceName <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\nmodule<span class=\\\"token punctuation\\\">.</span>exports <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  generateCollectionIndex<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"设置定时扫描图片，基于 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">toad-scheduler</code>\"\n    }\n  }), \" 库编写服务代码如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span>\\n  ToadScheduler<span class=\\\"token punctuation\\\">,</span>\\n  SimpleIntervalJob<span class=\\\"token punctuation\\\">,</span>\\n  AsyncTask<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"toad-scheduler\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> pixivTask <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"path/to/pixiv\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> config <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"path/to/config\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>pixiv<span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">initService</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> taskGenerateCollectionIndex <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">AsyncTask</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token string\\\">\\\"Generate Pixiv Collection Index\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">await</span> pixivTask<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">generateCollectionIndex</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">error</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">error</span><span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> jobGenerateCollectionIndex <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">SimpleIntervalJob</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">seconds</span><span class=\\\"token operator\\\">:</span> config<span class=\\\"token punctuation\\\">.</span>generateCollectionIndex<span class=\\\"token punctuation\\\">.</span>duration<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">runImmediately</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    taskGenerateCollectionIndex<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> scheduler <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">ToadScheduler</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  scheduler<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">addSimpleIntervalJob</span><span class=\\\"token punctuation\\\">(</span>jobGenerateCollectionIndex<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\nmodule<span class=\\\"token punctuation\\\">.</span>exports <span class=\\\"token operator\\\">=</span> initService<span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"程序启动时，运行 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">initService()</code>\"\n    }\n  }), \" 即可。服务器将自动读取指定目录下的 Pixiv 图片文件，并在数据库中建立索引。\", React.createElement(_components.a, {\n    href: \"#%E9%9A%8F%E6%9C%BA%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E4%B8%80%E4%B8%AA-pixiv-%E5%9B%BE%E7%89%87%E8%AE%BF%E9%97%AE%E5%9C%B0%E5%9D%80\"\n  }, \"下一步\"), \"，我们将随机从数据库中读取一张作品的信息。\"), \"\\n\", React.createElement(_components.h3, null, \"思路：爬取 Pixiv 图片的源文件地址\"), \"\\n\", React.createElement(_components.p, null, \"如果使用亲自获取图片并转发的方法，除了前面需要初始化数据库的图片索引信息外，还需要构建 Axios 请求，爬取网页源代码，从中读取 Artwork 的下载链接等信息，再上传到数据库。\"), \"\\n\", React.createElement(_components.p, null, \"例如，对于下载 \", React.createElement(_components.a, {\n    href: \"https://www.pixiv.net/artworks/95400283\"\n  }, React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">95400283_p0.jpg</code>\"\n    }\n  })), \"，最少需要获取其源文件链接 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">https://i.pximg.net/img-original/img/2022/01/09/07/27/17/95400283_p0.jpg</code>\"\n    }\n  }), \" 中的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">/2022/01/09/07/27/17</code>\"\n    }\n  }), \" 部分，并上传到数据库中。\"), \"\\n\", React.createElement(_components.p, null, \"更多的，在爬取源代码时，可以记录下图片的作者信息，图片是否可以在工作时安全观看（登录后才能爬取此类内容，可能需要在请求时添加个人账户信息）等，对日后处理展示内容大有裨益。\"), \"\\n\", React.createElement(_components.p, null, \"处理网页源代码时，可以使用 \", React.createElement(_components.a, {\n    href: \"https://github.com/cheeriojs/cheerio\"\n  }, \"cheerio\"), \" 库增加效率。\"), \"\\n\", React.createElement(_components.h2, null, \"为 Telegram Bot 添加随机获取 Pixiv 图片的接口\"), \"\\n\", React.createElement(_components.h3, null, \"随机获取数据库中的一个 Pixiv 图片访问地址\"), \"\\n\", React.createElement(_components.p, null, \"编写 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">randomGetPixivCollection.js</code>\"\n    }\n  }), \" 代码如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> Sequelize <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"path/to/sequelize\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">randomGetPixivCollection</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> sequelize <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">Sequelize</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> ServicePixivCollection <span class=\\\"token operator\\\">=</span> sequelize<span class=\\\"token punctuation\\\">.</span>models<span class=\\\"token punctuation\\\">.</span>ServicePixivCollection<span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">// Gain the total number of Pixiv artworks</span>\\n    <span class=\\\"token keyword\\\">const</span> artworksCount <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> ServicePixivCollection<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">count</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">// Generate a random value</span>\\n    <span class=\\\"token keyword\\\">const</span> randomArtworkId <span class=\\\"token operator\\\">=</span> Math<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">floor</span><span class=\\\"token punctuation\\\">(</span>Math<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">random</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">*</span> artworksCount<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">+</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">// Get random artwork</span>\\n    <span class=\\\"token keyword\\\">const</span> artwork <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> ServicePixivCollection<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">findOne</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">where</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">id</span><span class=\\\"token operator\\\">:</span> randomArtworkId <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">// Resolve artwork object</span>\\n    <span class=\\\"token keyword\\\">const</span> data <span class=\\\"token operator\\\">=</span> artwork<span class=\\\"token punctuation\\\">.</span>dataValues<span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> picId <span class=\\\"token operator\\\">=</span> data<span class=\\\"token punctuation\\\">.</span>picId<span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> picIndex <span class=\\\"token operator\\\">=</span> data<span class=\\\"token punctuation\\\">.</span>picIndex<span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> picType <span class=\\\"token operator\\\">=</span> data<span class=\\\"token punctuation\\\">.</span>picType<span class=\\\"token punctuation\\\">;</span>\\n\\n    data<span class=\\\"token punctuation\\\">.</span>picName <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picId<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">_p</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picIndex<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">.</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picType<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n    data<span class=\\\"token punctuation\\\">.</span>picNameMD <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picId<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\\\\\\\_p</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picIndex<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">\\\\\\\\.</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picType<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n    data<span class=\\\"token punctuation\\\">.</span>picUrl <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">https://www.pixiv.net/artworks/</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picId<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">let</span> picProxyUrlParam<span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>picIndex <span class=\\\"token operator\\\">></span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      picProxyUrlParam <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picId<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">-</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picIndex <span class=\\\"token operator\\\">+</span> <span class=\\\"token number\\\">1</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">.</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picType<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      picProxyUrlParam <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picId<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">.</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picType<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n    data<span class=\\\"token punctuation\\\">.</span>picProxyUrl <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">https://pixiv.cat/</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picProxyUrlParam<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">ok</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n      data<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">error</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token literal-property property\\\">ok</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token literal-property property\\\">data</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">,</span>\\n      error<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\nmodule<span class=\\\"token punctuation\\\">.</span>exports <span class=\\\"token operator\\\">=</span> randomGetPixivCollection<span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"根据 Pixiv.cat 网站的使用说明，对单张图片的 Pixiv 作品，应访问 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">https://pixiv.cat/${picId}.${picType}</code>\"\n    }\n  }), \"。而对于多张图片的 Pixiv 作品（漫画），应访问 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">https://pixiv.cat/${picId}-${picIndex + 1}.${picType}</code>\"\n    }\n  }), \"。\"), \"\\n\", React.createElement(_components.p, null, \"可能会影响体验，需要改进的地方是：当作品名为 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">${picId}_p0.${picType}</code>\"\n    }\n  }), \" 时，我们不知道该作品是否为单张图片，还是漫画作品，无法正确判断应该访问的 URL 链接。\", React.createElement(_components.a, {\n    href: \"#%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-pixiv-%E5%9B%BE%E7%89%87%E4%BB%A3%E7%90%86\"\n  }, \"在后面\"), \"，我们将针对此情况做处理。\"), \"\\n\", React.createElement(_components.h3, null, \"添加 Telegram Bot 命令\"), \"\\n\", React.createElement(_components.p, null, \"接下来为 Bot 添加指令，以调用随机获取图片的接口。同样，这里给出使用 Pixiv 图片代理的具体实现，以及亲自获取图片并转发的可能思路。\"), \"\\n\", React.createElement(_components.h4, null, \"直接使用 Pixiv 图片代理\"), \"\\n\", React.createElement(_components.p, null, \"注意，使用这种方式上传的图片\", React.createElement(_components.strong, null, \"不超过 5 MB\"), \"。\"), \"\\n\", React.createElement(_components.p, null, \"编写 Bot 的配置如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\">bot<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">onText</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token regex\\\"><span class=\\\"token regex-delimiter\\\">/</span><span class=\\\"token regex-source language-regex\\\">\\\\/random_pixiv</span><span class=\\\"token regex-delimiter\\\">/</span></span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">msg</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> chatId <span class=\\\"token operator\\\">=</span> msg<span class=\\\"token punctuation\\\">.</span>chat<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> res <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">randomGetPixivCollection</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>res<span class=\\\"token punctuation\\\">.</span>ok <span class=\\\"token operator\\\">===</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// Send placeholder message</span>\\n    <span class=\\\"token keyword\\\">const</span> placeholderMessage <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> bot<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendMessage</span><span class=\\\"token punctuation\\\">(</span>\\n      chatId<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">Geeeeting a random Pixiv artwork ...</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> data <span class=\\\"token operator\\\">=</span> res<span class=\\\"token punctuation\\\">.</span>data<span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span>\\n      id<span class=\\\"token punctuation\\\">,</span>\\n      picNameMD<span class=\\\"token punctuation\\\">,</span>\\n      picUrl<span class=\\\"token punctuation\\\">,</span>\\n      picSize<span class=\\\"token punctuation\\\">,</span>\\n      picProxyUrl<span class=\\\"token punctuation\\\">,</span>\\n      picId<span class=\\\"token punctuation\\\">,</span>\\n      picIndex<span class=\\\"token punctuation\\\">,</span>\\n      picType<span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> data<span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> caption <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">[source](</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picUrl<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">)</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">let</span> msgReplied <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>picSize <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// Artwork size is smaller than 5 MB, send photo message</span>\\n      <span class=\\\"token keyword\\\">const</span> sendPhotoOptions <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n        caption<span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token literal-property property\\\">parse_mode</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"MarkdownV2\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token literal-property property\\\">disable_web_page_preview</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">await</span> bot<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendPhoto</span><span class=\\\"token punctuation\\\">(</span>chatId<span class=\\\"token punctuation\\\">,</span> picProxyUrl<span class=\\\"token punctuation\\\">,</span> sendPhotoOptions<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n        msgReplied <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>err<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>picIndex <span class=\\\"token operator\\\">==</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n            <span class=\\\"token comment\\\">// Comic mode artwork with index=0 may send failed</span>\\n            <span class=\\\"token comment\\\">// Use comic mode url instead</span>\\n            <span class=\\\"token keyword\\\">const</span> picProxyUrl <span class=\\\"token operator\\\">=</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">https://pixiv.cat/</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picId<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">-1.</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>picType<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">;</span>\\n            <span class=\\\"token keyword\\\">await</span> bot<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendPhoto</span><span class=\\\"token punctuation\\\">(</span>chatId<span class=\\\"token punctuation\\\">,</span> picProxyUrl<span class=\\\"token punctuation\\\">,</span> sendPhotoOptions<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n            msgReplied <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">;</span>\\n          <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>err<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n            <span class=\\\"token comment\\\">//</span>\\n          <span class=\\\"token punctuation\\\">}</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token comment\\\">// Artwork size is not smaller than 5 MB or send failed again,</span>\\n    <span class=\\\"token comment\\\">// send caption message</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>msgReplied<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">await</span> bot<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendMessage</span><span class=\\\"token punctuation\\\">(</span>chatId<span class=\\\"token punctuation\\\">,</span> caption<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token literal-property property\\\">parse_mode</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"MarkdownV2\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n        <span class=\\\"token literal-property property\\\">disable_web_page_preview</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token comment\\\">// Remove placeholder message</span>\\n    bot<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">deleteMessage</span><span class=\\\"token punctuation\\\">(</span>chatId<span class=\\\"token punctuation\\\">,</span> placeholderMessage<span class=\\\"token punctuation\\\">.</span>message_id<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n    bot<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendMessage</span><span class=\\\"token punctuation\\\">(</span>\\n      chatId<span class=\\\"token punctuation\\\">,</span>\\n      <span class=\\\"token string\\\">\\\"Get random pixiv artwork failed. You may try to call it again later!\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n    <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"在上面这段代码中，当以 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">bot.sendPhoto()</code>\"\n    }\n  }), \" 的方法尝试发送 5 MB 以下的图片失败时，首先重新构建请求 URL 为 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">https://pixiv.cat/${data.picId}-1.${data.picType}</code>\"\n    }\n  }), \"，再次进行发送。如果还是失败（可能图片被作者删除），则发送简单的链接文本。由此，解决了前面提到的无法判断作品是否为漫画作品的问题。\"), \"\\n\", React.createElement(_components.p, null, \"与 Telegram 上的机器人对话，发送命令 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">\\\\random_pixiv</code>\"\n    }\n  }), \"，结果如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/c9dcfa09ee8cc8c2f2392dd2f3a930ef/a2b88/bot-service.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 116.02564102564101%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABJ0AAASdAHeZh94AAAEXElEQVR42p2VbUyTVxiG3w2VtoAtLYxKW1poSy0tWLAUZAhEdKggjAgqKChUqQoosgl+xI/oYIIxcRI2dY44Fw04F3UapsEoE50JMFwk02xz/9iPZXFZzJYsZnrttMRl2XTBneTKmzznPfc55znPh2SblYNrzgISs1/DkTUPTXwiKrMd/QyPIB1dUiq6RPdz0Yv52JkZWNKyMCanI6kMZkI1EYSqI4iMNlBasZqislXIVWrkSjX+eY3Vicbi+A+cRFjHkYJVEUx6SUI+OYj97YcY/GqMnvPD5C8qQ5IkFJHRKE3TmRoTPyEkRXgkk16WcNps9Jwd4N3OM2zd1kFNfQvBkych02hRxdpRGm0TQpKLE8qmBGHSR1O/vplrJ47zcedhcgt8qCOiCBYbhscmvJigQjYFjSqExYtXMHCpn659bTRsamVDbSNBYWrC4/6HoFqpYEWFj0Od3Wxt2seu5hZOHunCZHcRoregEn6coKAGZYgMo0FH08YtfPLeUa70Xqd8qY8Du1pJmDkLeXTcxAXNNhESYTJWVlbx808P+fXBQ37/7QnrVm9ka+0bxM9wo9CZJy64e08bzXW1vNm4matne/n0xCmGbwxRuGAxc9JzMMQ7CTVYUU3Uhz7fBr4dGaWhro69zds5fqiTXTt2UFK4nPx5RcKHM17Mh3l5RRze38Ho0B3OfNjD5dMXaN2yl0pvEzVVdbg8mchexIdZ2fMpL1zKzb4Bxr4f45vbX9O+s42chUspzC8la24Bsmmxzxb02/6BZEjOwF2whBwRg/PLveRXrSejeDkmTzbxs/OwpuWIAuBBJdIqXCx46supwq+h2pgAYVrj+FcXhxQm0irELBJ7ejKR9hTkpgQUcU5khniUlkTkeisKQXCUKUCY326woHF6MC2qxFRQgXGhOEDhSrQZeUhpuQuort2E1Z2OPiGBZdVrWFFTS+XaeuYVL6HM66PCV0/5mvVUCJvVnYlCuCAyaRaWkpoAccVerKVr0WUXIh07cZKh0Tu84jQS5Yjm/eMd+MfZvj6iUix4G6t5/McjnjwJmFnmXUdQhEFc3/bsK3/wUTcXrlwmM9fNq3NT2dO+PbDwdZ+X5Ox0Fhbnc/X6JZ6OZd61QlCPWuS3ymT/C2UA8SjvHDkW+PFe/0UGTnUycuMmPIaKxjoOth6g5+gpNu/e9DfBdeOCzylp0kGRu/5x99Z3DJ7vZvizfsa+fEB13UYKSoto2dOKyhbJuYunA/+Vrqp5pqD/1f1IHce6ePTLI+723+fO56OMXL3NDyM/0rTtLQwpJuobG9C7zHg3VI4LVvn+JegX0jrcTEtMRdrxdjv37t2np+scvd3XOH/yMn1nrguhnZg9DhqbGyipLMMx28WtwS8oFj1nSpQRjdkhCq9d1Ep7IOi1jplMc7qRrKJbWTyzA53Lj79zxYhA1iWJjiZ2jHF5MLrS0CYkC1yBLhftFIsdKePdLjWTOKFhEIkQm5LOn5upQa0t52CWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"Bot service\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/c9dcfa09ee8cc8c2f2392dd2f3a930ef/39c09/bot-service.png\\\"\\n        srcset=\\\"/static/c9dcfa09ee8cc8c2f2392dd2f3a930ef/680fe/bot-service.png 156w,\\n/static/c9dcfa09ee8cc8c2f2392dd2f3a930ef/17474/bot-service.png 312w,\\n/static/c9dcfa09ee8cc8c2f2392dd2f3a930ef/39c09/bot-service.png 624w,\\n/static/c9dcfa09ee8cc8c2f2392dd2f3a930ef/a2b88/bot-service.png 908w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.h4, null, \"思路：获取 Pixiv 图片并转发\"), \"\\n\", React.createElement(_components.p, null, \"注意，使用这种方式上传的图片\", React.createElement(_components.strong, null, \"不超过 10 MB\"), \"。\"), \"\\n\", React.createElement(_components.p, null, \"我们无法直接在 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">bot.sendPhoto()</code>\"\n    }\n  }), \" 方法中使用 Pixiv 源站图片的获取链接，这是因为 Pixiv 设置了反爬虫机制，只接收请求头的 Referer 包含 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">https://www.pixiv.net/</code>\"\n    }\n  }), \" 的请求。\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/62dbc84a41dc64b10cc5ba3494ed81c4/5f4af/pixiv-request-referer.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 46.15384615384615%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABJ0AAASdAHeZh94AAABrUlEQVR42lVS2XKjMBDkPzY+gGBscwkQiMPGxkm8TlK5SMpJ7N3K/v9P9M7IDlV56JoWSD2jbhllvcLxzxeub7aYuB48P4IzmRGmms+9ELN5QDXAdO7DtBxYtgvbmWs+Ni9/wLBtE3Up8Ny9Y/9+wOH4D79396iXLQ7UqHvbo9t/4PP4hc/DX0iZww0KJNUdLMfDxWCMwcjCYHiCIUSC6+0ORVkjywuNXJU9l5lCGMUIwoiq6HkQCvgBVYJ/BnOjJKHt7g43u1s8PD7h8ekZL90rute3E3/psNlcYbVaE1o0XNctls0K6/XmVNtW88WigTEa20izElEsYdoO3JmvPQtF2nP2NIySHkJI/d2devpfnGSEXK8NNpYXQZgQYhKSZH6I4cjEr4shVUubPRiamjPYMx7kG/yPwdyw7AlEomjCDHm5QFE3ero0VUjSXCfJm1mUD3yL9uJnoT5lFpSqRlE1UOWSsIDUgZSo6ElxWBE1EGRJTEikohtJfU1umOkAK73mZ3aeMMeSzNYHeBOJpfQ8eMqmaSlpaqAqKEJKqRfUlPdwY/aUfbx0pmCt/4UpHIu1kbwGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"请求需包含 Referer\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/62dbc84a41dc64b10cc5ba3494ed81c4/39c09/pixiv-request-referer.png\\\"\\n        srcset=\\\"/static/62dbc84a41dc64b10cc5ba3494ed81c4/680fe/pixiv-request-referer.png 156w,\\n/static/62dbc84a41dc64b10cc5ba3494ed81c4/17474/pixiv-request-referer.png 312w,\\n/static/62dbc84a41dc64b10cc5ba3494ed81c4/39c09/pixiv-request-referer.png 624w,\\n/static/62dbc84a41dc64b10cc5ba3494ed81c4/5f4af/pixiv-request-referer.png 665w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"因此，我们需要在自己的服务器上构造 Axios 请求，设置 Referer 请求头，然后发送请求向 Pixiv 服务器获取图片，再将图片转为 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">multipart/form-data</code>\"\n    }\n  }), \" 格式发送给 Telegram 会话。\"), \"\\n\", React.createElement(_components.h2, null, \"为 Koa 添加随机获取 Pixiv 图片的接口\"), \"\\n\", React.createElement(_components.p, null, \"Koa 应用程序本身也提供了路由功能，在这里可以很轻松地将获取随机 Pixiv 图片的服务对接到 Koa 上去。\"), \"\\n\", React.createElement(_components.p, null, \"编写路由文件如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> router <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"koa-router\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> randomGetPixivCollection <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"path/to/randomGetPixivCollection\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nrouter<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"/random\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">ctx</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> res <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">randomGetPixivCollection</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>res<span class=\\\"token punctuation\\\">.</span>ok <span class=\\\"token operator\\\">===</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    ctx<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">redirect</span><span class=\\\"token punctuation\\\">(</span>res<span class=\\\"token punctuation\\\">.</span>data<span class=\\\"token punctuation\\\">.</span>picProxyUrl<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n    ctx<span class=\\\"token punctuation\\\">.</span>body <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"Get random Pixiv artwork failed.\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\nmodule<span class=\\\"token punctuation\\\">.</span>exports <span class=\\\"token operator\\\">=</span> router<span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"然而，这里并没有解决前面提到的漫画作品问题，留待用户在跳转后自行操作。\"), \"\\n\", React.createElement(_components.h2, null, \"参考文章\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, React.createElement(_components.a, {\n    href: \"https://blog.csdn.net/weixin_45826022/article/details/109406389\"\n  }, \"爬取 pixiv 每日推荐\")), \"\\n\"));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import GATSBY_COMPILED_MDX from \"/home/runner/work/homepage/homepage/blog/posts/random-get-me-a-picture.mdx\";\nimport {Fancybox} from \"@fancyapps/ui\";\nimport {MDXProvider} from \"@mdx-js/react\";\nimport dayjs from \"dayjs\";\nimport {Link} from \"gatsby\";\nimport * as React from \"react\";\nimport Card from \"../components/card\";\nimport Category from \"../components/category\";\nimport SEO from \"../components/seo\";\nimport Tag from \"../components/tag\";\nconst FancyBoxImage = props => {\n  const {alt = \"The author is too lazy to give an alt\", src, ...restProps} = props;\n  return React.createElement(\"a\", {\n    href: src,\n    \"data-fancybox\": \"gallery\",\n    \"data-caption\": alt\n  }, React.createElement(\"img\", Object.assign({\n    src: src,\n    alt: alt\n  }, restProps)));\n};\nconst ALink = _ref => {\n  let {href = \"\", children} = _ref;\n  const isExternalHref = !(href !== null && href !== void 0 && href.startsWith(\"#\"));\n  const parsedHref = isExternalHref ? href : `#${encodeURIComponent(href.slice(1))}`;\n  return React.createElement(\"a\", {\n    href: parsedHref,\n    target: isExternalHref ? \"_blank\" : undefined,\n    rel: \"noreferrer\"\n  }, children);\n};\nconst components = {\n  a: ALink,\n  img: FancyBoxImage,\n  Card,\n  Link\n};\nconst PostTemplate = _ref2 => {\n  let {children, data} = _ref2;\n  const {mdx: {frontmatter: {title, date: dateString, updated: updatedDateString, categories, tags, timeliness}}} = data;\n  const articleRef = React.useRef(null);\n  const date = dayjs(dateString);\n  const updatedDate = updatedDateString ? dayjs(updatedDateString) : date;\n  const today = dayjs();\n  const diffDays = today.diff(updatedDate, \"days\");\n  React.useEffect(() => {\n    var _articleRef$current;\n    const optimizedImageLinks = (_articleRef$current = articleRef.current) === null || _articleRef$current === void 0 ? void 0 : _articleRef$current.querySelectorAll(\"a.gatsby-resp-image-link\");\n    optimizedImageLinks === null || optimizedImageLinks === void 0 ? void 0 : optimizedImageLinks.forEach(link => {\n      const image = link.children.item(1);\n      link.setAttribute(\"data-fancybox\", \"gallery\");\n      link.setAttribute(\"data-caption\", image.alt);\n    });\n    Fancybox.bind(\"[data-fancybox]\");\n    return () => Fancybox.unbind(\"[data-fancybox]\");\n  }, []);\n  return React.createElement(\"div\", {\n    className: \"mx-auto flex max-w-xl flex-col gap-y-12\"\n  }, React.createElement(\"div\", {\n    className: \"flex flex-col gap-4\"\n  }, (categories === null || categories === void 0 ? void 0 : categories.length) && React.createElement(Category, {\n    name: categories[0],\n    className: \"item-selectable\"\n  }), React.createElement(\"h1\", {\n    className: \"text-3xl font-bold\"\n  }, title), React.createElement(\"div\", {\n    className: \"item-secondary flex flex-col gap-2 lg:flex-row\"\n  }, dateString && React.createElement(\"span\", {\n    title: `首次发布于：${date.toString()}\\n最后更新于：${updatedDate.toString()}`\n  }, date.format(\"MM 月 DD 日 YYYY 年\")), (tags === null || tags === void 0 ? void 0 : tags.length) && React.createElement(\"div\", {\n    className: \"flex flex-1 flex-wrap gap-2 lg:before:content-['\\u2022']\"\n  }, tags.map(tag => React.createElement(Tag, {\n    key: tag,\n    name: tag,\n    className: \"item-secondary item-selectable\"\n  }))))), React.createElement(\"article\", {\n    ref: articleRef,\n    className: \"heti post-entry\"\n  }, timeliness !== false && diffDays > 365 && React.createElement(\"blockquote\", {\n    className: \"border-l-4 border-orange-400\"\n  }, \"\\u8FD9\\u662F\\u4E00\\u7BC7\", React.createElement(\"strong\", null, \"\\u6700\\u540E\\u66F4\\u65B0\\u4E8E \", diffDays, \" \\u5929\\u524D\"), \"\\u7684\\u535A\\u5BA2\\uFF0C\\u5185\\u5BB9\\u53EF\\u80FD\\u968F\\u7740\\u65F6\\u95F4\\u7684\\u63A8\\u79FB\\u800C\\u53D8\\u5F97\\u4E0D\\u518D\\u9002\\u7528\\uFF0C\\u5EFA\\u8BAE\\u60A8\\u4ED4\\u7EC6\\u8BC4\\u4F30\\u4FE1\\u606F\\u7684\\u6709\\u6548\\u6027\\u3002\"), React.createElement(MDXProvider, {\n    components: components\n  }, children)));\n};\nconst query = \"2697480803\";\nexport const Head = _ref3 => {\n  let {data} = _ref3;\n  return React.createElement(SEO, {\n    title: String(data.mdx.frontmatter.title)\n  });\n};\nPostTemplate\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PostTemplate, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\n"],"names":["_createMdxContent","props","_components","Object","assign","p","a","span","h2","h3","h4","strong","ul","li","_provideComponents","components","React","href","dangerouslySetInnerHTML","__html","wrapper","MDXLayout","_ref","children","isExternalHref","startsWith","parsedHref","encodeURIComponent","slice","target","undefined","rel","img","alt","src","restProps","Card","Link","PostTemplate","_ref2","data","mdx","frontmatter","title","date","dateString","updated","updatedDateString","categories","tags","timeliness","articleRef","dayjs","updatedDate","diffDays","diff","_articleRef$current","optimizedImageLinks","current","querySelectorAll","forEach","link","image","item","setAttribute","Fancybox","bind","unbind","className","length","Category","name","toString","format","map","tag","Tag","key","ref","MDXProvider","Head","_ref3","SEO","String","GatsbyMDXWrapper","GATSBY_COMPILED_MDX"],"sourceRoot":""}