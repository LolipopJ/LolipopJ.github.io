{"version":3,"file":"component---src-templates-post-tsx-content-file-path-blog-posts-backup-mc-server-mdx-201448c886ef9c06e00e.js","mappings":"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","sources":["webpack://homepage/./blog/posts/backup-mc-server.mdx","webpack://homepage/./src/templates/post.tsx"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    h2: \"h2\",\n    h3: \"h3\",\n    span: \"span\",\n    blockquote: \"blockquote\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.p, null, \"笔者最近在 OpenWRT 软路由上部署了一个 Minecraft 服务器，出于对数据安全的焦虑，于是折腾了一下存档备份的相关事宜，记录为此文。\"), \"\\n\", React.createElement(_components.p, null, \"在 CurseForge 等模组站上已有方便好用的 Minecraft 服务器存档备份插件，除非您喜欢折腾或高自由度的定制，不用像笔者这样编写一整个脚本。\"), \"\\n\", React.createElement(_components.p, null, \"完整的脚本\", React.createElement(_components.a, {\n    href: \"https://github.com/LolipopJ/LolipopJ.github.io/blob/cd9d45af2a97f596ec6b3ada4c069f88a9e9bbd7/source/static/scripts/backup-mc-server.js\"\n  }, \"可见此\"), \"。\"), \"\\n\", React.createElement(_components.h2, null, \"编写备份脚本\"), \"\\n\", React.createElement(_components.h3, null, \"前置准备\"), \"\\n\", React.createElement(_components.p, null, \"为了脚本编写方便，约定应该在 Minecraft 服务器的根目录执行脚本。校验当前脚本的执行目录：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> cwd <span class=\\\"token operator\\\">=</span> process<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">cwd</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>fs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">existsSync</span><span class=\\\"token punctuation\\\">(</span>path<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span>cwd<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"eula.txt\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">throw</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Error</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token string\\\">\\\"You should execute this script at root dir of MineCraft server where `eula.txt` exists.\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"支持指定备份文件存储的目录 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">BACKUP_DIR</code>\"\n    }\n  }), \"，同时 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">checkupDir()</code>\"\n    }\n  }), \" 确保目录存在：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">BACKUP_DIR</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"backups\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">checkupDir</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">dir</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>fs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">existsSync</span><span class=\\\"token punctuation\\\">(</span>dir<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    fs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">mkdirSync</span><span class=\\\"token punctuation\\\">(</span>dir<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token literal-property property\\\">recursive</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> backupDir <span class=\\\"token operator\\\">=</span> path<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span>cwd<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token constant\\\">BACKUP_DIR</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token function\\\">checkupDir</span><span class=\\\"token punctuation\\\">(</span>backupDir<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, null, \"生成备份文件\"), \"\\n\", React.createElement(_components.p, null, \"支持指定备份文件的列表，除了最重要的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">world/</code>\"\n    }\n  }), \" 以外，还可以备份 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">server.properties</code>\"\n    }\n  }), \"、\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">world_nether/</code>\"\n    }\n  }), \" 和 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">world_the_end/</code>\"\n    }\n  }), \" 等文件或目录。\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">BACKUP_FILES</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span>\\n  <span class=\\\"token string\\\">\\\"banned-ips.json\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">\\\"banned-players.json\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">\\\"config\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">\\\"mods\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">\\\"ops.json\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">\\\"server.properties\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">\\\"whitelist.json\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">\\\"world\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">\\\"world_nether\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">\\\"world_the_end\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> resolvedBackupFiles <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">BACKUP_FILES</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">file</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>fs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">existsSync</span><span class=\\\"token punctuation\\\">(</span>path<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span>cwd<span class=\\\"token punctuation\\\">,</span> file<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"原生 Node 并没有提供打包压缩的方法，为了避免引入其它的依赖，考虑使用系统自带的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">tar</code>\"\n    }\n  }), \" 命令实现。为此，需要使用到 Node 的 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">child_process</code>\"\n    }\n  }), \"：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> child_process <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"child_process\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> util <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"util\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> exec <span class=\\\"token operator\\\">=</span> util<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">promisify</span><span class=\\\"token punctuation\\\">(</span>child_process<span class=\\\"token punctuation\\\">.</span>exec<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"现在，可以通过 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">exec()</code>\"\n    }\n  }), \" 来执行系统上的命令了。可编写文件备份方法如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> backupFilename <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">genFilename</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 省略文件名生成方法...</span>\\n<span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">exec</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token string\\\">tar -czf </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>backupFilename<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\"> </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>resolvedBackupFiles<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">join</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\" \\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"需注意的是，我们在执行 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">tar</code>\"\n    }\n  }), \" 命令时，常传入 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">-v</code>\"\n    }\n  }), \" 标识，在屏幕上打印压缩或解压的文件列表（很酷）。但是，在使用 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">exec()</code>\"\n    }\n  }), \" 时，子进程会将命令的标准输出或错误一并返回，如果文件数量过多，标准输出超过预设大小，会导致报错：\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">RangeError [ERR_CHILD_PROCESS_STDIO_MAXBUFFER]: stdout maxBuffer length exceeded</code>\"\n    }\n  }), \"。用 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">child_process.spawn()</code>\"\n    }\n  }), \" 可以避免这个问题，但考虑到我们并不在乎压缩命令的执行过程，最好的办法就是去掉 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">-v</code>\"\n    }\n  }), \" 标识。\"), \"\\n\", React.createElement(_components.p, null, \"到此为止，已经能够将所需的 Minecraft 服务器存档文件打包压缩，备份到系统本地了。\"), \"\\n\", React.createElement(_components.h3, null, \"移除历史备份文件\"), \"\\n\", React.createElement(_components.p, null, \"即使每天执行一次备份任务，长久累积也将占用大量的空间，更何况一个备份的大小已然几百 MB 起步。因此需考虑本地保留的备份文件数量，及时移除历史的备份文件。\"), \"\\n\", React.createElement(_components.p, null, \"首先需要获取备份目录下已有的备份文件信息：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> filenames <span class=\\\"token operator\\\">=</span> fs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">readdirSync</span><span class=\\\"token punctuation\\\">(</span>backupDir<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> backupFileList <span class=\\\"token operator\\\">=</span> filenames<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">filename</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n  fs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">statSync</span><span class=\\\"token punctuation\\\">(</span>path<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span>backupDir<span class=\\\"token punctuation\\\">,</span> filename<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"支持指定保存的备份文件数量，得到需要移除的文件列表：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">BACKUP_MAX_NUM</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">7</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 保留最新的 N 个备份文件，此处为 7 个</span>\\n\\n<span class=\\\"token keyword\\\">const</span> backupFiles <span class=\\\"token operator\\\">=</span> backupFileList\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">file</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> file<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">isFile</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sort</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">a<span class=\\\"token punctuation\\\">,</span> b</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">return</span> b<span class=\\\"token punctuation\\\">.</span>mtimeMs <span class=\\\"token operator\\\">-</span> a<span class=\\\"token punctuation\\\">.</span>mtimeMs<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> oldBackupFiles <span class=\\\"token operator\\\">=</span> backupFiles<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">slice</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">BACKUP_MAX_NUM</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"移除这些文件即可：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> oldBackupFilenames <span class=\\\"token operator\\\">=</span> oldBackupFiles<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">file</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> file<span class=\\\"token punctuation\\\">.</span>name<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\noldBackupFilenames<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">forEach</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">filename</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  fs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">rmSync</span><span class=\\\"token punctuation\\\">(</span>path<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span>backupDir<span class=\\\"token punctuation\\\">,</span> filename<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"这样在每次执行脚本时，都会自动清理掉本地多余的备份文件，保证文件系统容量健康。\"), \"\\n\", React.createElement(_components.h2, null, \"设置定时任务\"), \"\\n\", React.createElement(_components.p, null, \"基于 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">crontab</code>\"\n    }\n  }), \" 实现定时任务调度，使用 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">crontab -e</code>\"\n    }\n  }), \" 命令编写任务列表：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\"><span class=\\\"token number\\\">0</span> <span class=\\\"token number\\\">4</span> * * * <span class=\\\"token builtin class-name\\\">cd</span> /path/to/mc-server <span class=\\\"token operator\\\">&amp;&amp;</span> <span class=\\\"token function\\\">node</span> /path/to/backup-mc-server.js</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"笔者发现定时任务实际执行时间是正午 12 点，而非预期的凌晨 4 点，推测系服务器使用的 UTC 时区导致。\"), \"\\n\", React.createElement(_components.p, null, \"尽管配置了 OpenWRT 的时区为 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">Asia/Shanghai</code>\"\n    }\n  }), \"，但仍然不生效：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">$ <span class=\\\"token function\\\">date</span> <span class=\\\"token parameter variable\\\">-R</span>\\nWed, <span class=\\\"token number\\\">15</span> May <span class=\\\"token number\\\">2024</span> 07:00:00 +0000</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"笔者通过安装 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">zoneinfo-asia</code>\"\n    }\n  }), \" 解决了问题：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">$ opkg update\\n$ opkg <span class=\\\"token function\\\">install</span> zoneinfo-asia\\nInstalling zoneinfo-asia <span class=\\\"token punctuation\\\">(</span>2023c-2<span class=\\\"token punctuation\\\">)</span> to root<span class=\\\"token punctuation\\\">..</span>.\\nDownloading https://mirrors.vsean.net/openwrt/releases/23.05.2/packages/x86_64/packages/zoneinfo-asia_2023c-2_x86_64.ipk\\nInstalling zoneinfo-core <span class=\\\"token punctuation\\\">(</span>2023c-2<span class=\\\"token punctuation\\\">)</span> to root<span class=\\\"token punctuation\\\">..</span>.\\nDownloading https://mirrors.vsean.net/openwrt/releases/23.05.2/packages/x86_64/packages/zoneinfo-core_2023c-2_x86_64.ipk\\nConfiguring zoneinfo-core.\\nConfiguring zoneinfo-asia.\\n$ /etc/init.d/system restart\\n$ <span class=\\\"token function\\\">date</span> <span class=\\\"token parameter variable\\\">-R</span>\\nWed, <span class=\\\"token number\\\">15</span> May <span class=\\\"token number\\\">2024</span> <span class=\\\"token number\\\">15</span>:00:00 +0800</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"这样，在北京时间凌晨 4 点，系统将自动调用备份脚本。如果彼时仍有用户在游玩，脚本可能会运行失败，可以在执行脚本之前关闭 Minecraft 服务器，完成后重新启动。\"), \"\\n\", React.createElement(_components.h2, null, \"（可选）通过 Alist 上传到云端\"), \"\\n\", React.createElement(_components.blockquote, null, \"\\n\", React.createElement(_components.p, null, \"为了这盘醋，包了这顿饺子。\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"万一硬盘挂了呢？笔者认为保存在软路由本地丝毫没有安全感，于是决定在备份后即时上传到云端。\"), \"\\n\", React.createElement(_components.p, null, \"笔者已经在软路由上安装并配置好了 Alist，连接到了自己的 OneDrive。下面将进一步实现上传备份文件到 OneDrive 或任何其他的云盘。\"), \"\\n\", React.createElement(_components.h3, null, \"获取 Alist token\"), \"\\n\", React.createElement(_components.p, null, \"调用 Alist 接口时需要传入 token，因此首先需要获取 token：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">ALIST_ADDRESS</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"YOUR_ALIST_ADDRESS\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">ALIST_USERNAME</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"YOUR_ALIST_USERNAME\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">ALIST_PASSWORD</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"YOUR_ALIST_PASSWORD\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> headers <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Headers</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nheaders<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Content-Type\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"application/json\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> raw <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">stringify</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">username</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token constant\\\">ALIST_USERNAME</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">password</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token constant\\\">ALIST_PASSWORD</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> requestOptions <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">method</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"POST\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  headers<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> raw<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">redirect</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"follow\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> res <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">fetch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span><span class=\\\"token constant\\\">ALIST_ADDRESS</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">/api/auth/login</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span> requestOptions<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> resText <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">text</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> resObj <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">parse</span><span class=\\\"token punctuation\\\">(</span>resText<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> alistToken <span class=\\\"token operator\\\">=</span> resObj<span class=\\\"token punctuation\\\">.</span>data<span class=\\\"token punctuation\\\">.</span>token<span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, null, \"上传备份文件到云盘\"), \"\\n\", React.createElement(_components.p, null, \"现在，编写 Alist 上传文件的方法：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">ALIST_BACKUP_DIR</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"/path/to/mc-backups\\\"</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> backupFile <span class=\\\"token operator\\\">=</span> fs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">statSync</span><span class=\\\"token punctuation\\\">(</span>backupFilename<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> backupFileBasename <span class=\\\"token operator\\\">=</span> path<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">basename</span><span class=\\\"token punctuation\\\">(</span>backupFilename<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> alistFilePath <span class=\\\"token operator\\\">=</span> path<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">ALIST_BACKUP_DIR</span><span class=\\\"token punctuation\\\">,</span> backupFileBasename<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> headers <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Headers</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nheaders<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Authorization\\\"</span><span class=\\\"token punctuation\\\">,</span> alistToken<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nheaders<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"As-Task\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"true\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nheaders<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Content-Length\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>backupFile<span class=\\\"token punctuation\\\">.</span>size<span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nheaders<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"File-Path\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token function\\\">encodeURIComponent</span><span class=\\\"token punctuation\\\">(</span>alistFilePath<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> fileStream <span class=\\\"token operator\\\">=</span> fs<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createReadStream</span><span class=\\\"token punctuation\\\">(</span>backupFilename<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> requestOptions <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">method</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"PUT\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  headers<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> fileStream<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">redirect</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"follow\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">duplex</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"half\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">fetch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span><span class=\\\"token constant\\\">ALIST_ADDRESS</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">/api/fs/put</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span> requestOptions<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"通过 \", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<code class=\\\"language-text\\\">headers.append(\\\"As-Task\\\", \\\"true\\\");</code>\"\n    }\n  }), \" 将文件上传设为任务，避免阻塞其它命令的执行。在 Alist 管理后台可以看到上传的进度：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/56bd3a0983c8f0f3ca6a30b43eb440df/5dded/upload-to-alist.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 21.153846153846153%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAy0lEQVR42nXOzXKDIBQFYJ8hP2IRFFTkR5k0McF02kW26fu/z+mVTKerLr6Bc8/A3IKPZ/CwggsBLhvowcBYh360eBMy4xvqfvO/lEPh4wkdPa5qmT9J9zuW24rTZcH+yEiZ7fJJuWQ4sOql/LMnO8ZQWO+guxacVxjDjPT1wGC2LS22zgYPFwKmGOG8R2cGiFaSBkKprCaaGNGgaOMnhvSNg34H7yf4jyd0XKHmhHa6QU0p3/VMM8pNuEK6BdKeIXtHLGpi+xEXpfEDQfpv4fwGtJQAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"upload-to-alist\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/56bd3a0983c8f0f3ca6a30b43eb440df/39c09/upload-to-alist.png\\\"\\n        srcset=\\\"/static/56bd3a0983c8f0f3ca6a30b43eb440df/680fe/upload-to-alist.png 156w,\\n/static/56bd3a0983c8f0f3ca6a30b43eb440df/17474/upload-to-alist.png 312w,\\n/static/56bd3a0983c8f0f3ca6a30b43eb440df/39c09/upload-to-alist.png 624w,\\n/static/56bd3a0983c8f0f3ca6a30b43eb440df/6d2da/upload-to-alist.png 936w,\\n/static/56bd3a0983c8f0f3ca6a30b43eb440df/5a791/upload-to-alist.png 1248w,\\n/static/56bd3a0983c8f0f3ca6a30b43eb440df/5dded/upload-to-alist.png 1588w\\\"\\n        sizes=\\\"(max-width: 624px) 100vw, 624px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"到这一步，执行备份脚本时，将自动把新生成的备份文件上传到云盘。\"), \"\\n\", React.createElement(_components.h3, null, \"移除云盘历史备份文件\"), \"\\n\", React.createElement(_components.p, null, \"同样，云盘的空间也不是无限的，我们采取与移除本地历史备份文件相同的策略。\"), \"\\n\", React.createElement(_components.p, null, \"首先获取云盘上已有的备份文件列表：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> headers <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Headers</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nheaders<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Authorization\\\"</span><span class=\\\"token punctuation\\\">,</span> alistToken<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nheaders<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Content-Type\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"application/json\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> raw <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">stringify</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">path</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token constant\\\">ALIST_BACKUP_DIR</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> requestOptions <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">method</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"POST\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">headers</span><span class=\\\"token operator\\\">:</span> headers<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> raw<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">redirect</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"follow\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> res <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">fetch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span><span class=\\\"token constant\\\">ALIST_ADDRESS</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">/api/fs/list</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span> requestOptions<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> resText <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">text</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> resObj <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">parse</span><span class=\\\"token punctuation\\\">(</span>resText<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> backupDirFileList <span class=\\\"token operator\\\">=</span> resObj<span class=\\\"token punctuation\\\">.</span>data<span class=\\\"token punctuation\\\">.</span>content <span class=\\\"token operator\\\">||</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"获取需要移除的备份文件列表：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> backupFiles <span class=\\\"token operator\\\">=</span> backupDirFileList\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">filter</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">file</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token operator\\\">!</span>file<span class=\\\"token punctuation\\\">.</span>is_dir<span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sort</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">a<span class=\\\"token punctuation\\\">,</span> b</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>a<span class=\\\"token punctuation\\\">.</span>modified <span class=\\\"token operator\\\">></span> b<span class=\\\"token punctuation\\\">.</span>modified<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">return</span> <span class=\\\"token operator\\\">-</span><span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>a<span class=\\\"token punctuation\\\">.</span>modified <span class=\\\"token operator\\\">&lt;</span> b<span class=\\\"token punctuation\\\">.</span>modified<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">return</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">return</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// 由于新的备份文件正在上传中，因此应当保留最新的 BACKUP_MAX_NUM - 1 个备份文件</span>\\n<span class=\\\"token keyword\\\">const</span> oldBackupFiles <span class=\\\"token operator\\\">=</span> backupFiles<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">slice</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token constant\\\">BACKUP_MAX_NUM</span> <span class=\\\"token operator\\\">-</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">const</span> oldBackupFilenames <span class=\\\"token operator\\\">=</span> oldBackupFiles<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">map</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">file</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> file<span class=\\\"token punctuation\\\">.</span>name<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"最后，移除这些文件即可：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"js\\\"><pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token keyword\\\">const</span> headers <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Headers</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nheaders<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Authorization\\\"</span><span class=\\\"token punctuation\\\">,</span> alistToken<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\nheaders<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">append</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">\\\"Content-Type\\\"</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"application/json\\\"</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> raw <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">JSON</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">stringify</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">names</span><span class=\\\"token operator\\\">:</span> oldBackupFilenames<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">dir</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token constant\\\">ALIST_BACKUP_DIR</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> requestOptions <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token literal-property property\\\">method</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"POST\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">headers</span><span class=\\\"token operator\\\">:</span> headers<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">body</span><span class=\\\"token operator\\\">:</span> raw<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token literal-property property\\\">redirect</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">\\\"follow\\\"</span><span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">fetch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token template-punctuation string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span><span class=\\\"token constant\\\">ALIST_ADDRESS</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\">/api/fs/remove</span><span class=\\\"token template-punctuation string\\\">`</span></span><span class=\\\"token punctuation\\\">,</span> requestOptions<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"这样在每次执行脚本时，云盘的系统容量健康也得到了保障。\"), \"\\n\", React.createElement(_components.h2, null, \"结尾\"), \"\\n\", React.createElement(_components.p, null, \"稍微润色优化一下备份脚本，执行的输出结果如下：\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"bash\\\"><pre class=\\\"language-bash\\\"><code class=\\\"language-bash\\\">$ <span class=\\\"token function\\\">node</span> /path/to/backup-mc-server.js\\nCreate <span class=\\\"token function\\\">dir</span> <span class=\\\"token variable\\\"><span class=\\\"token variable\\\">`</span>/path/to/mc-server/backups<span class=\\\"token variable\\\">`</span></span> successfully.\\nCreating backup <span class=\\\"token function\\\">file</span> <span class=\\\"token variable\\\"><span class=\\\"token variable\\\">`</span>/path/to/mc-server/backups/backup-mcserver-2024-05-11-11-10-51.tar.gz<span class=\\\"token variable\\\">`</span></span> <span class=\\\"token punctuation\\\">..</span>.\\nCreate backup <span class=\\\"token function\\\">file</span> <span class=\\\"token variable\\\"><span class=\\\"token variable\\\">`</span>/path/to/mc-server/backups/backup-mcserver-2024-05-11-11-10-51.tar.gz<span class=\\\"token variable\\\">`</span></span> successfully.\\nLog <span class=\\\"token keyword\\\">in</span> alist successfully.\\nStart upload task successfully: <span class=\\\"token builtin class-name\\\">local</span> <span class=\\\"token function\\\">file</span> <span class=\\\"token variable\\\"><span class=\\\"token variable\\\">`</span>/path/to/mc-server/backups/backup-mcserver-2024-05-11-11-10-51.tar.gz<span class=\\\"token variable\\\">`</span></span> <span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">></span> alist <span class=\\\"token variable\\\"><span class=\\\"token variable\\\">`</span>/path/to/alist/backups/backup-mcserver-2024-05-11-11-10-51.tar.gz<span class=\\\"token variable\\\">`</span></span><span class=\\\"token builtin class-name\\\">.</span>\\n\\n<span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">=</span>\\nBackup <span class=\\\"token function\\\">file</span> is generated: <span class=\\\"token boolean\\\">true</span>\\nOld backup files are removed: <span class=\\\"token boolean\\\">true</span>\\nTask that upload backup <span class=\\\"token function\\\">file</span> to alist is started: <span class=\\\"token boolean\\\">true</span>\\nOld backup files <span class=\\\"token keyword\\\">in</span> alist are removed: <span class=\\\"token boolean\\\">true</span>\\n<span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">==</span><span class=\\\"token operator\\\">=</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"啊，满满的安心感！收工。\"));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import GATSBY_COMPILED_MDX from \"/home/runner/work/homepage/homepage/blog/posts/backup-mc-server.mdx\";\nimport {Fancybox} from \"@fancyapps/ui\";\nimport {MDXProvider} from \"@mdx-js/react\";\nimport dayjs from \"dayjs\";\nimport {Link} from \"gatsby\";\nimport * as React from \"react\";\nimport Card from \"../components/card\";\nimport Category from \"../components/category\";\nimport SEO from \"../components/seo\";\nimport Tag from \"../components/tag\";\nconst FancyBoxImage = props => {\n  const {alt = \"The author is too lazy to give an alt\", src, ...restProps} = props;\n  return React.createElement(\"a\", {\n    href: src,\n    \"data-fancybox\": \"gallery\",\n    \"data-caption\": alt\n  }, React.createElement(\"img\", Object.assign({\n    src: src,\n    alt: alt\n  }, restProps)));\n};\nconst ALink = _ref => {\n  let {href = \"\", children} = _ref;\n  const isExternalHref = !(href !== null && href !== void 0 && href.startsWith(\"#\"));\n  const parsedHref = isExternalHref ? href : `#${encodeURIComponent(href.slice(1))}`;\n  return React.createElement(\"a\", {\n    href: parsedHref,\n    target: isExternalHref ? \"_blank\" : undefined,\n    rel: \"noreferrer\"\n  }, children);\n};\nconst components = {\n  a: ALink,\n  img: FancyBoxImage,\n  Card,\n  Link\n};\nconst PostTemplate = _ref2 => {\n  let {children, data} = _ref2;\n  const {mdx: {fields: {isDraft}, frontmatter: {title, date: dateString, updated: updatedDateString, categories, tags, timeliness}}} = data;\n  const articleRef = React.useRef(null);\n  const date = dayjs(dateString);\n  const updatedDate = updatedDateString ? dayjs(updatedDateString) : date;\n  const today = dayjs();\n  const diffDays = today.diff(updatedDate, \"days\");\n  React.useEffect(() => {\n    var _articleRef$current;\n    const optimizedImageLinks = (_articleRef$current = articleRef.current) === null || _articleRef$current === void 0 ? void 0 : _articleRef$current.querySelectorAll(\"a.gatsby-resp-image-link\");\n    optimizedImageLinks === null || optimizedImageLinks === void 0 ? void 0 : optimizedImageLinks.forEach(link => {\n      const image = link.children.item(1);\n      link.setAttribute(\"data-fancybox\", \"gallery\");\n      link.setAttribute(\"data-caption\", image.alt);\n    });\n    Fancybox.bind(\"[data-fancybox]\");\n    return () => Fancybox.unbind(\"[data-fancybox]\");\n  }, []);\n  return React.createElement(\"div\", {\n    className: \"mx-auto flex max-w-xl flex-col gap-y-12\"\n  }, React.createElement(\"div\", {\n    className: \"flex flex-col gap-4\"\n  }, (categories === null || categories === void 0 ? void 0 : categories.length) && React.createElement(Category, {\n    name: categories[0],\n    className: \"item-selectable\"\n  }), React.createElement(\"h1\", {\n    className: \"text-3xl font-bold\"\n  }, title), React.createElement(\"div\", {\n    className: \"item-secondary flex flex-col gap-2 lg:flex-row\"\n  }, dateString && React.createElement(\"span\", {\n    title: `首次发布于：${date.toString()}\\n最后更新于：${updatedDate.toString()}`\n  }, date.format(\"MM 月 DD 日 YYYY 年\")), (tags === null || tags === void 0 ? void 0 : tags.length) && React.createElement(\"div\", {\n    className: \"flex flex-1 flex-wrap gap-2 lg:before:content-['\\u2022']\"\n  }, tags.map(tag => React.createElement(Tag, {\n    key: tag,\n    name: tag,\n    className: \"item-secondary item-selectable\"\n  }))))), React.createElement(\"article\", {\n    ref: articleRef,\n    className: \"heti post-entry\"\n  }, isDraft && React.createElement(\"blockquote\", {\n    className: \"!border-red-400\"\n  }, \"\\u8FD9\\u662F\\u4E00\\u7BC7\", React.createElement(\"strong\", null, \"\\u672A\\u6B63\\u5F0F\\u53D1\\u5E03\"), \"\\u7684\\u535A\\u5BA2\\uFF0C\\u5185\\u5BB9\\u53EF\\u80FD\\u5C1A\\u672A\\u64B0\\u5199\\u5B8C\\u5168\\u6216\\u5B58\\u5728\\u4E00\\u4E9B\\u7EB0\\u6F0F\\uFF0C\\u5EFA\\u8BAE\\u60A8\\u4ED4\\u7EC6\\u8BC4\\u4F30\\u4FE1\\u606F\\u7684\\u6709\\u6548\\u6027\\u3002\"), timeliness !== false && diffDays > 365 && React.createElement(\"blockquote\", {\n    className: \"!border-orange-400\"\n  }, \"\\u8FD9\\u662F\\u4E00\\u7BC7\", React.createElement(\"strong\", null, \"\\u6700\\u540E\\u66F4\\u65B0\\u4E8E \", diffDays, \" \\u5929\\u524D\"), \"\\u7684\\u535A\\u5BA2\\uFF0C\\u5185\\u5BB9\\u53EF\\u80FD\\u968F\\u7740\\u65F6\\u95F4\\u7684\\u63A8\\u79FB\\u800C\\u53D8\\u5F97\\u4E0D\\u518D\\u9002\\u7528\\uFF0C\\u5EFA\\u8BAE\\u60A8\\u4ED4\\u7EC6\\u8BC4\\u4F30\\u4FE1\\u606F\\u7684\\u6709\\u6548\\u6027\\u3002\"), React.createElement(MDXProvider, {\n    components: components\n  }, children)));\n};\nconst query = \"2264136072\";\nexport const Head = _ref3 => {\n  let {data} = _ref3;\n  return React.createElement(SEO, {\n    title: String(data.mdx.frontmatter.title)\n  });\n};\nPostTemplate\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PostTemplate, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\n"],"names":["_createMdxContent","props","_components","Object","assign","p","a","h2","h3","span","blockquote","_provideComponents","components","React","href","dangerouslySetInnerHTML","__html","wrapper","MDXLayout","_ref","children","isExternalHref","startsWith","parsedHref","encodeURIComponent","slice","target","undefined","rel","img","alt","src","restProps","Card","Link","PostTemplate","_ref2","data","mdx","fields","isDraft","frontmatter","title","date","dateString","updated","updatedDateString","categories","tags","timeliness","articleRef","dayjs","updatedDate","diffDays","diff","_articleRef$current","optimizedImageLinks","current","querySelectorAll","forEach","link","image","item","setAttribute","Fancybox","bind","unbind","className","length","Category","name","toString","format","map","tag","Tag","key","ref","MDXProvider","Head","_ref3","SEO","String","GatsbyMDXWrapper","GATSBY_COMPILED_MDX"],"sourceRoot":""}