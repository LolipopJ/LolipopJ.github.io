"use strict";(self.webpackChunkhomepage=self.webpackChunkhomepage||[]).push([[2232],{7012:function(e,t,n){n.r(t),n.d(t,{Head:function(){return b},default:function(){return _}});var a=n(8453),l=n(6540);function r(e){const t=Object.assign({p:"p",span:"span",h2:"h2",a:"a",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",h3:"h3",strong:"strong",ol:"ol",li:"li"},(0,a.R)(),e.components);return l.createElement(l.Fragment,null,l.createElement(t.p,null,"假设，您身边有两台电脑，一台打算用来做 PostgreSQL 数据库服务器，一台用来做客户端。服务器上的 PostgreSQL 14 安装在 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">C:\\Program Files\\PostgreSQL\\14</code>'}})," 目录下，数据库文件保存在 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">C:\\Program Files\\PostgreSQL\\14\\data</code>'}})," 目录，欲访问的数据库名为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">db_name</code>'}}),"，访问数据库的用户为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">db_user</code>'}}),"。"),"\n",l.createElement(t.h2,null,"配置 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">postgresql.conf</code>'}})),"\n",l.createElement(t.p,null,"编辑数据库配置文件 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">C:\\Program Files\\PostgreSQL\\14\\data\\postgresql.conf</code>'}}),"，设置监听的远程连接地址。将 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">listen_addresses</code>'}})," 项的值设置为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">*</code>'}}),"，如下所示："),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="conf"><pre class="language-conf"><code class="language-conf"># - Connection Settings -\n\nlisten_addresses = &#39;*&#39;  # what IP address(es) to listen on</code></pre></div>'}}),"\n",l.createElement(t.h2,null,"配置 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">pg_hba.conf</code>'}})),"\n",l.createElement(t.p,null,"编辑数据库客户端认证配置文件 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">C:\\Program Files\\PostgreSQL\\14\\data\\pg_hba.conf</code>'}}),"，设置允许连接到数据库的客户端 IP 地址。"),"\n",l.createElement(t.p,null,"该文件的注释处已经给出了各种配置的详细说明。这里，我们将重点放在对允许的远程连接地址的配置上。"),"\n",l.createElement(t.p,null,l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">pg_hba.conf</code>'}})," 对 ADDRESS 地址的解析基于 ",l.createElement(t.a,{href:"https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing"},"CIDR 无类别域间路由"),"。"),"\n",l.createElement(t.p,null,"那么，对于 IPv4 地址，有如下五种典型情况："),"\n",l.createElement(t.table,null,l.createElement(t.thead,null,l.createElement(t.tr,null,l.createElement(t.th,null,"ADDRESS"),l.createElement(t.th,null,"说明"))),l.createElement(t.tbody,null,l.createElement(t.tr,null,l.createElement(t.td,null,"210.41.111.111/32"),l.createElement(t.td,null,"仅允许 IP 地址为 210.41.111.111 的远程连接请求")),l.createElement(t.tr,null,l.createElement(t.td,null,"210.41.111.0/24"),l.createElement(t.td,null,"允许 IP 地址为 210.41.111.* 的远程连接请求")),l.createElement(t.tr,null,l.createElement(t.td,null,"210.41.0.0/16"),l.createElement(t.td,null,"允许 IP 地址为 210.41.*.* 的远程连接请求")),l.createElement(t.tr,null,l.createElement(t.td,null,"210.0.0.0/8"),l.createElement(t.td,null,"允许 IP 地址为 210.*.*.* 的远程连接请求")),l.createElement(t.tr,null,l.createElement(t.td,null,"0.0.0.0/0"),l.createElement(t.td,null,"允许所有 IP 地址的远程连接请求")))),"\n",l.createElement(t.p,null,"那么，如果我们的客户端的 IP 地址为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">210.41.112.112</code>'}}),"，可以添加条目如下："),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="conf"><pre class="language-conf"><code class="language-conf"># TYPE  DATABASE        USER            ADDRESS                 METHOD\nhost    db_name         db_user         210.41.112.112/32       scram-sha-256\n# host    db_name         db_user         210.41.112.0/24         scram-sha-256\n# host    db_name         db_user         210.41.0.0/16           scram-sha-256\n# host    db_name         db_user         210.0.0.0/8             scram-sha-256\n# host    db_name         db_user         0.0.0.0/0               scram-sha-256</code></pre></div>'}}),"\n",l.createElement(t.p,null,"更小的范围，意味着更高的安全性。"),"\n",l.createElement(t.h2,null,"重启数据库服务"),"\n",l.createElement(t.p,null,"为了让配置生效，我们需要重启启动 PostgreSQL 数据库。"),"\n",l.createElement(t.p,null,"在 Windows 端，PostgreSQL 作为一个服务运行。按 Windows 键，搜索 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">service</code>'}}),"，进入服务应用，找到 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">postgresql-x64-*</code>'}})," 服务，右键重新启动即可。"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/f61b9606a191670104b47319a7e27772/d2c2a/restart-pgsql.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 73.07692307692307%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABJ0AAASdAHeZh94AAAC1klEQVR42o2U76/aVBjH+X/VxOluFqNzyd4u8a0vfasxcToTjTPZchGHK4wyKLT0Ny0/Wi4tUKBQCnw8LbleY+L0Sb55en59zvOc55xWwk8eE753RfD+A8IPHgh/xfzDT1l8/DnxvYdE9z57tz4Sc+4/Ir56RCTWVEzbZWB72EMDw3HpqTbLRcx0Nme5WbHfZ+x2+3dqvxc+3ZVzKx1FwRDQXxsaXz19yTe/NPj5D51ntT7PJZ3XPZeG6peSVA+p7128UNkn2q8Vl+ZggqSYVE6nE5vNRkCH9HUbzRoSxmtWac5qmzEObtiI3XdZTn6i1PFc+HPpk03KaBKwTvc4wyEVhO1F2G1rRrencjzm3FqxyHCGWJrCbDqC04HjYX9RnnFZm9KVGyhyE2Og3QJTFD+ho1nl960JHpLm8aLRpyrrvBSqtQe0VAc7WBLtTphhwo/XTZ7XOyiqfgGmaUownZLnOVmWsRc6HA5i5Mx37RlfVOd8KSU8qS545ayRrZCuv8K6ScX4nIfPLB7/5FDrWBfgbrfDMAyCICBJEuJ4wWa9LlPWxdl6tk6yjMizHadjxswXmWwXZRbpNuGNVKfbfoPa791FWEDP5zN/twKoOT6qqqJqOo5j8cqM+L415sUg4ofeksEo4q0s87ar0GrJd8Ai1X9aAfSmM8JgyngyEYUZUzNivm2Oedr0+VqeY0yX2KbBQNcxTfO/gNA3HBFhD0NMTpI1J1HpiWexmgdF2UTfEkmSkFut/wM8l69IU/uYllUWbivuZLvT5SaKyfIjq9WKZrOBLNIujqYEbrfbfwW644DRyGc8nuD7PsulSNG2uZnPyye3FsXzPI8wDMUZO3dVLqCFL8DF9TmU1+eALKK5vr6mVvud36pVOp0OrutiiYjjOGYuwEWqxSYlsNjVdYco4k3X63U0TRNtp9w1iiIisWA2m/2loq8AFSrHi7b4mSwWi3Lun18dSMSRK1hoAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="重启 PostgreSQL 数据库"\n        title=""\n        src="/static/f61b9606a191670104b47319a7e27772/39c09/restart-pgsql.png"\n        srcset="/static/f61b9606a191670104b47319a7e27772/680fe/restart-pgsql.png 156w,\n/static/f61b9606a191670104b47319a7e27772/17474/restart-pgsql.png 312w,\n/static/f61b9606a191670104b47319a7e27772/39c09/restart-pgsql.png 624w,\n/static/f61b9606a191670104b47319a7e27772/d2c2a/restart-pgsql.png 929w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",l.createElement(t.h2,null,"连接到数据库"),"\n",l.createElement(t.h3,null,"同一路由器下"),"\n",l.createElement(t.p,null,"配置 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">pg_hba.conf</code>'}}),"，允许相同路由器下其它主机的连接请求。例如，允许 IP 地址为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">192.168.0.0</code>'}})," 至 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">192.168.255.255</code>'}})," 的连接请求："),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="conf"><pre class="language-conf"><code class="language-conf"># TYPE  DATABASE        USER            ADDRESS                 METHOD\nhost    db_name         db_user         192.168.0.0/16          scram-sha-256</code></pre></div>'}}),"\n",l.createElement(t.p,null,"重新启动数据库服务。"),"\n",l.createElement(t.p,null,"假设服务器的内网 IP 地址为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">192.168.1.104</code>'}}),"，数据库监听端口为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">5432</code>'}}),"。那么，当我们通过客户端连接远程数据库时，主机名应填写 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">192.168.1.104</code>'}}),"，端口应填写 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">5432</code>'}}),"，这样，我们就能顺利访问到服务器上的数据库了。"),"\n",l.createElement(t.h3,null,"远程连接"),"\n",l.createElement(t.p,null,"假如您的用作客户端和服务器的电脑分隔两地，现在想要远程连接服务器上的数据库，该怎么办呢？下面是我常用的办法。"),"\n",l.createElement(t.p,null,"首先，需要获取服务器的公网 IP 地址，可以在",l.createElement(t.a,{href:"https://www.ip138.com/"},"这里"),"查询。这里假设服务器通过路由器与公网连接。"),"\n",l.createElement(t.p,null,"接着，配置路由器的",l.createElement(t.strong,null,"虚拟服务器"),"。可以通过如下步骤实现："),"\n",l.createElement(t.ol,null,"\n",l.createElement(t.li,null,"将服务器的内网 IP 地址与它的硬件 MAC 地址绑定。别忘了在服务器的网络属性处，关闭随机硬件地址功能。"),"\n",l.createElement(t.li,null,"配置虚拟服务器，映射路由器的外部端口为服务器的数据库端口。"),"\n"),"\n",l.createElement(t.p,null,"最后，修改 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">pg_hba.conf</code>'}}),"，根据客户端的公网 IP 地址进行配置。如果客户端的网络环境经常变化，尽管不安全，但也可以考虑设置允许所有 IP 地址进行连接。"),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="conf"><pre class="language-conf"><code class="language-conf"># TYPE  DATABASE        USER            ADDRESS                 METHOD\nhost    db_name         db_user         0.0.0.0/0               scram-sha-256\nhost    db_name         db_user         ::/0                    scram-sha-256</code></pre></div>'}}),"\n",l.createElement(t.p,null,"重新启动数据库服务。"),"\n",l.createElement(t.p,null,"例如，路由器的公网 IP 地址为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">210.41.111.111</code>'}}),"，服务器的内网 IP 地址为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">192.168.1.104</code>'}}),"，虚拟服务器外部端口为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">22212</code>'}}),"，数据库监听端口为 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">5432</code>'}}),"。那么，当我们通过客户端连接远程数据库时，主机名应填写 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">210.41.111.111</code>'}}),"，端口应填写 ",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">22212</code>'}}),"，这样，我们就能顺利访问到服务器上的数据库了。"))}var s=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,a.R)(),e.components);return t?l.createElement(t,e,l.createElement(r,e)):r(e)},c=n(197),o=n(4353),g=n.n(o),m=n(4810),d=n(6947),u=n(4017),i=n(1042),p=n(1038);const E={a:e=>{let{href:t="",children:n}=e;const a=!(null!=t&&t.startsWith("#")),r=a?t:`#${encodeURIComponent(t.slice(1))}`;return l.createElement("a",{href:r,target:a?"_blank":void 0,rel:"noreferrer"},n)},img:e=>{const{alt:t="The author is too lazy to give an alt",src:n,...a}=e;return l.createElement("a",{href:n,"data-fancybox":"gallery","data-caption":t},l.createElement("img",Object.assign({src:n,alt:t},a)))},Card:d.A,Link:m.N_},h=e=>{let{children:t,data:n}=e;const{mdx:{frontmatter:{title:r,date:s,updated:o,categories:m,tags:d,timeliness:i=!0}}}=n,h=l.useRef(null),b=g()(s),_=o?g()(o):b,f=g()().diff(_,"days");return l.useEffect((()=>{var e;const t=null===(e=h.current)||void 0===e?void 0:e.querySelectorAll("a.gatsby-resp-image-link");return null==t||t.forEach((e=>{const t=e.children.item(1);e.setAttribute("data-fancybox","gallery"),e.setAttribute("data-caption",t.alt)})),c.lX.bind("[data-fancybox]"),()=>c.lX.unbind("[data-fancybox]")}),[]),l.createElement("div",{className:"mx-auto flex max-w-xl flex-col gap-y-12"},l.createElement("div",{className:"flex flex-col gap-4"},(null==m?void 0:m.length)&&l.createElement(u.A,{name:m[0],className:"item-selectable"}),l.createElement("h1",{className:"text-3xl font-bold"},r),l.createElement("div",{className:"item-secondary flex flex-col gap-2 lg:flex-row"},s&&l.createElement("span",{title:`首次发布于：${b.toString()}\n最后更新于：${_.toString()}`},b.format("MM 月 DD 日 YYYY 年")),(null==d?void 0:d.length)&&l.createElement("div",{className:"flex flex-1 flex-wrap gap-2 lg:before:content-['•']"},d.map((e=>l.createElement(p.A,{key:e,name:e,className:"item-secondary item-selectable"})))))),l.createElement("article",{ref:h,className:"heti post-entry"},i&&f>365&&l.createElement("blockquote",{className:"border-l-4 border-orange-400"},"这是一篇",l.createElement("strong",null,"最后更新于 ",f," 天前"),"的博客，内容可能随着时间的推移而变得不再适用，建议您仔细评估信息的有效性。"),l.createElement(a.x,{components:E},t)))},b=e=>{let{data:t}=e;return l.createElement(i.A,{title:String(t.mdx.frontmatter.title)})};function _(e){return l.createElement(h,e,l.createElement(s,e))}}}]);
//# sourceMappingURL=component---src-templates-post-tsx-content-file-path-blog-posts-connect-with-pgsql-mdx-458ebd12fdee02c865e4.js.map