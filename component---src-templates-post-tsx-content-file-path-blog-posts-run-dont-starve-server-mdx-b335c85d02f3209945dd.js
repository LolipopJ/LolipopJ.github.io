"use strict";(self.webpackChunkhomepage=self.webpackChunkhomepage||[]).push([[4318],{8170:function(e,a,n){n.r(a),n.d(a,{Head:function(){return v},default:function(){return E}});var t=n(8453),s=n(6540);function l(e){const a=Object.assign({p:"p",ul:"ul",li:"li",a:"a",h2:"h2",span:"span",strong:"strong",h3:"h3",h4:"h4",ol:"ol"},(0,t.R)(),e.components);return s.createElement(s.Fragment,null,s.createElement(a.p,null,"本文重现了笔者在自己的 CentOS 7 (64-bit) 系统中部署饥荒联机版服务器的全过程，供君参考。"),"\n",s.createElement(a.p,null,"Steam 版的饥荒联机版与 Wegame 版数据不互通，也无法相互联机。"),"\n",s.createElement(a.p,null,"笔者主要参考了如下两个部署教程："),"\n",s.createElement(a.ul,null,"\n",s.createElement(a.li,null,s.createElement(a.a,{href:"https://dontstarve.fandom.com/wiki/Guides/Don%E2%80%99t_Starve_Together_Dedicated_Servers"},"Guides/Don’t Starve Together Dedicated Servers")),"\n",s.createElement(a.li,null,s.createElement(a.a,{href:"https://steamcommunity.com/sharedfiles/filedetails/?id=590565473"},"How to setup dedicated server with cave on Linux")),"\n"),"\n",s.createElement(a.h2,null,"安装 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steamcmd</code>'}})),"\n",s.createElement(a.p,null,"安装的步骤可以直接参考 SteamCMD 的",s.createElement(a.a,{href:"https://developer.valvesoftware.com/wiki/SteamCMD"},"官方文档"),"（",s.createElement(a.a,{href:"https://developer.valvesoftware.com/w/index.php?title=SteamCMD:zh-cn&uselang=zh"},"中文版"),"）。"),"\n",s.createElement(a.p,null,"需要注意的是，SteamCMD 仅提供 32 位二进制文件。如果您的系统仅能运行 64 位进程（例如 OpenWRT 系统），将",s.createElement(a.strong,null,"不能"),"正常使用。"),"\n",s.createElement(a.p,null,"为了安全考虑，",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steamcmd</code>'}})," 官方建议创建新的系统用户运行，而不是拥有最高命令权限的 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">root</code>'}})," 用户。因此，首先创建一个名为 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steam</code>'}})," 的用户："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 创建 steam 用户</span>\n<span class="token function">sudo</span> <span class="token function">useradd</span> <span class="token parameter variable">-m</span> steam\n<span class="token comment"># 修改 steam 用户登录密码</span>\n<span class="token function">sudo</span> <span class="token function">passwd</span> steam</code></pre></div>'}}),"\n",s.createElement(a.p,null,"对于 64 位系统，需要安装如下的必要依赖以运行 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steamcmd</code>'}}),"："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> glibc.i686 libstdc++.i686</code></pre></div>'}}),"\n",s.createElement(a.p,null,"切换至 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steam</code>'}})," 用户："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">su</span> - steam</code></pre></div>'}}),"\n",s.createElement(a.p,null,"安装 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steamcmd</code>'}}),"："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~\n<span class="token function">curl</span> <span class="token parameter variable">-sqL</span> <span class="token string">"https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz"</span> <span class="token operator">|</span> <span class="token function">tar</span> zxvf -</code></pre></div>'}}),"\n",s.createElement(a.p,null,"运行 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steamcmd</code>'}}),"："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">/home/steam/steamcmd.sh</code></pre></div>'}}),"\n",s.createElement(a.p,null,"耐心等待更新文件下载、安装完毕……"),"\n",s.createElement(a.h2,null,"安装饥荒联机版"),"\n",s.createElement(a.p,null,"安装饥荒联机版运行的必要依赖："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> libcurl.i686\n<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/lib/libcurl.so.4 /usr/lib/libcurl-gnutls.so.4</code></pre></div>'}}),"\n",s.createElement(a.p,null,"设置饥荒联机版安装目录："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">Steam<span class="token operator">></span> force_install_dir /home/steam/steamapps/DST</code></pre></div>'}}),"\n",s.createElement(a.p,null,"匿名登录到 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steamcmd</code>'}}),"："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">Steam<span class="token operator">></span> login anonymous</code></pre></div>'}}),"\n",s.createElement(a.p,null,"安装饥荒联机版："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">Steam<span class="token operator">></span> app_update <span class="token number">343050</span> validate</code></pre></div>'}}),"\n",s.createElement(a.p,null,"测试饥荒联机版的运行。特别的，由于相对路径的缘故，执行 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">dontstarve_dedicated_server_nullrenderer</code>'}})," 前一定要先移动到它所在的目录："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /home/steam/steamapps/DST/bin\n./dontstarve_dedicated_server_nullrenderer</code></pre></div>'}}),"\n",s.createElement(a.p,null,"如果没有其它的报错，那么打印内容大致如下："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="plaintext"><pre class="language-plaintext"><code class="language-plaintext">$ ./dontstarve_dedicated_server_nullrenderer\n./dontstarve_dedicated_server_nullrenderer: /lib/libcurl-gnutls.so.4: no version information available (required by ./dontstarve_dedicated_server_nullrenderer)\n[00:00:00]: PersistRootStorage is now /home/steam/.klei//DoNotStarveTogether/Cluster_1/Master/\n[00:00:00]: Starting Up\n[00:00:00]: Version: 617969\n[00:00:00]: Current time: Tue Jul  2 18:22:40 2024\n\n[00:00:00]: System Name: Linux\n[00:00:00]: Host Name: iZ2vc17uca9zl48iicx7ojZ\n[00:00:00]: Release(Kernel) Version: 3.10.0-1160.108.1.el7.x86_64\n[00:00:00]: Kernel Build Timestamp: #1 SMP Thu Jan 25 16:17:31 UTC 2024\n[00:00:00]: Machine Arch: x86_64\n[00:00:00]: Don\'t Starve Together: 617969 LINUX\n[00:00:00]: Build Date: 9567\n[00:00:00]: Mode: 32-bit\n...</code></pre></div>'}}),"\n",s.createElement(a.p,null,"此时，会自动创建存档目录 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/.klei/DoNotStarveTogether/Cluster_1</code>'}}),"，如果后续不再需要可直接删除。"),"\n",s.createElement(a.h2,null,"添加饥荒联机版服务器管理脚本"),"\n",s.createElement(a.p,null,s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">screen</code>'}})," 命令可以用来创建独立的命令行窗口执行进程，方便对进程的管理，例如追踪运行的日志信息。笔者选用它来管理饥荒联机版服务器的进程。"),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">screen</span></code></pre></div>'}}),"\n",s.createElement(a.p,null,"首先创建存放脚本的文件夹："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> /home/steam/scripts</code></pre></div>'}}),"\n",s.createElement(a.p,null,"下面开始编写管理服务器过程中最常用的两个脚本。"),"\n",s.createElement(a.h3,null,"自动更新脚本"),"\n",s.createElement(a.p,null,"创建自动更新饥荒联机版的脚本 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/scripts/update_dst.sh</code>'}}),"，编写内容如下："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh"><span class="token shebang important">#!/bin/sh</span>\n\n<span class="token comment"># 更新饥荒联机版</span>\n<span class="token builtin class-name">cd</span> /home/steam\n./steamcmd.sh +@ShutdownOnFailedCommand <span class="token number">1</span> +@NoPromptForPassword <span class="token number">1</span> +force_install_dir /home/steam/steamapps/DST +login anonymous +app_update <span class="token number">343050</span> validate +quit\n\n<span class="token comment"># 更新已安装的模组</span>\n<span class="token builtin class-name">cd</span> /home/steam/steamapps/DST/bin\n./dontstarve_dedicated_server_nullrenderer <span class="token parameter variable">-cluster</span> CustomSaveName <span class="token parameter variable">-only_update_server_mods</span></code></pre></div>'}}),"\n",s.createElement(a.p,null,"其中 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">CustomSaveName</code>'}})," 为您的存档目录名称，可自定义修改，如不配置将默认使用 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Cluster_1</code>'}}),"。"),"\n",s.createElement(a.p,null,"添加脚本的执行权限，后略："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">chmod</span> +x /home/steam/scripts/update_dst.sh</code></pre></div>'}}),"\n",s.createElement(a.h3,null,"启动（重启）服务器脚本"),"\n",s.createElement(a.p,null,"创建启动（重启）饥荒联机版服务器的脚本 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/scripts/start_dst.sh</code>'}}),"，编写内容如下："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh"><span class="token shebang important">#!/bin/sh</span>\n\n<span class="token comment"># 保存服务器数据并退出</span>\n<span class="token function">screen</span> <span class="token parameter variable">-S</span> dst_master <span class="token parameter variable">-X</span> stuff <span class="token string">$\'c_shutdown()<span class="token entity" title="\\n">\\n</span>\'</span>\n<span class="token function">screen</span> <span class="token parameter variable">-S</span> dst_caves <span class="token parameter variable">-X</span> stuff <span class="token string">$\'c_shutdown()<span class="token entity" title="\\n">\\n</span>\'</span>\n\n<span class="token comment"># 更新饥荒联机版</span>\n/home/steam/scripts/update_dst.sh\n\n<span class="token builtin class-name">cd</span> /home/steam/steamapps/DST/bin\n<span class="token comment"># 启动地上世界服务器</span>\n<span class="token function">screen</span> <span class="token parameter variable">-dmS</span> dst_master ./dontstarve_dedicated_server_nullrenderer <span class="token parameter variable">-cluster</span> CustomSaveName <span class="token parameter variable">-console</span> <span class="token parameter variable">-shard</span> Master\n<span class="token comment"># 启动洞穴世界服务器</span>\n<span class="token function">screen</span> <span class="token parameter variable">-dmS</span> dst_caves ./dontstarve_dedicated_server_nullrenderer <span class="token parameter variable">-cluster</span> CustomSaveName <span class="token parameter variable">-console</span> <span class="token parameter variable">-shard</span> Caves</code></pre></div>'}}),"\n",s.createElement(a.p,null,"脚本将自动保存服务器数据（如果不使用 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">c_shutdown()</code>'}})," 而直接关闭 Screen 的话，将丢失度过黑夜前未保存的所有数据），检查并安装饥荒联机版更新包，最后重新启动服务器。"),"\n",s.createElement(a.p,null,"服务器启动后，执行命令 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">screen -r dst_master</code>'}})," 或 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">screen -r dst_caves</code>'}})," 查看日志，您会发现打印有如下内容："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="plaintext"><pre class="language-plaintext"><code class="language-plaintext">[00:00:05]: [200] Account Failed (6): "E_INVALID_TOKEN"\n[00:00:05]: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n[00:00:05]: !!!! Your Server Will Not Start !!!!\n[00:00:05]: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n[00:00:05]: No auth token could be found.\n[00:00:05]: Please visit https://accounts.klei.com/account/game/servers?game=DontStarveTogether\n[00:00:05]: to generate server configuration files</code></pre></div>'}}),"\n",s.createElement(a.p,null,"这意味着我们最后还需要配置 Auth Token 等信息，使得服务器能正确地注册并被联机用户发现。"),"\n",s.createElement(a.h2,null,"正式启动饥荒联机版服务器"),"\n",s.createElement(a.p,null,"访问 ",s.createElement(a.a,{href:"https://accounts.klei.com/account/game/servers?game=DontStarveTogether%EF%BC%8C%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E9%A5%A5%E8%8D%92%E8%81%94%E6%9C%BA%E7%89%88%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B9%B6%E8%8E%B7%E5%8F%96"},"https://accounts.klei.com/account/game/servers?game=DontStarveTogether，创建一个饥荒联机版服务器并获取")," Auth Token："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/a0a0194249afcf682bd917ca2daf9b9c/7960f/add-new-server.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 58.97435897435898%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB10lEQVR42o2SaW7bMBCFdYhaEmlK1L5ZshxbSWHZTr3UbVAU6BmK3idXfn2kUANpmyA/PsyQMxwO59G5nL/hcPmO1f0jqu4BKqoQxjUCWuNLXUKGhUWEOUSQ33yfvqsyktp9j77TNCvkzRrV8gHdMKJo16iXA8pugwVtv9wwRrhfcS+re8yjwiJ1gSieiNOG6xzOoAVqrZCmKbIkRkFbFTmKPEeTZ+gSjbIoUNJPogiBUlBSWuZkEyvLdb9D3y3hxCYpCGzQJs/nN+Y3pLVKTZj8kOgwREBCraF1iCxjh5KJWZahLEvMZrMXeJ73blzmx0nKguysbVus7+6QJAmqqkLT1LygenHA9/23C7oux0ZRFJ9pCvV9j9WKA+faFwKCzJg0deviA61rDr4Gc5OEBc1s6rrGOO6w3W7RLhqkcUxhikkYxuqqxLJrEXFWgp1KXvY3ni3IJ5tOFk2Dp69XnPcjvpyOePp8xuXxgCPXp8POcj7scdyN+DRu/+HEvDyOKE4ExxUKPwaJ518f8fxzwLWXnJeEprKBQQqLMvbP3n/wfQ+aP8YxsqehQJ8HlkixfV/YOb4P3womKG5kChqVfSEx8yiCZwLT35O81cQMdi3lq0z/dMr7DbseTe8G854uAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="创建服务器"\n        title=""\n        src="/static/a0a0194249afcf682bd917ca2daf9b9c/39c09/add-new-server.png"\n        srcset="/static/a0a0194249afcf682bd917ca2daf9b9c/680fe/add-new-server.png 156w,\n/static/a0a0194249afcf682bd917ca2daf9b9c/17474/add-new-server.png 312w,\n/static/a0a0194249afcf682bd917ca2daf9b9c/39c09/add-new-server.png 624w,\n/static/a0a0194249afcf682bd917ca2daf9b9c/6d2da/add-new-server.png 936w,\n/static/a0a0194249afcf682bd917ca2daf9b9c/5a791/add-new-server.png 1248w,\n/static/a0a0194249afcf682bd917ca2daf9b9c/7960f/add-new-server.png 1274w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",s.createElement(a.p,null,"填写基本的配置信息："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/fb7ba8d30c59840a7e74c2a0e9fdc787/9cea8/configure-server.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 58.97435897435898%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB60lEQVR42pWSy3KbMBSGeYTGNhiQQDZggbAxUJvijA12bNwOTtLpZdFd153u+gqZ6XP/lWCSyaZpuvhGl3P06eiiXVcfcGjukRV75KstkkWOQGTwwxR0GoGwEM4kAp30fZtx2C6H5c5gOgFMGmBMfTnu57RAKEEON1iAixQ8nIMFMZgvpIRLyQzOVElDOX4Of4KwPs9yA2jGeIwwirDZbBCJGENdhzE2oRsmTPP/cBwHGiEEQoqK9QpFGiNLhCRGGnOEIUckNwt5CM/zIGQ/8H14khlX8bCLi0h0MsYYNNu2MZ/P8f58xrssASMmfEbhuwTUJiCUQm2qUIuoHFNC4TouDMPAYDDAcDiELk82mXq9cLFY4PbuFttdhSzL8Xa16lhJ1uv1M4q+LQoUkjzPkaapXJPBdV2wyaQ/shK2bYvm3KAsS2QySc0lSdK1f0PFFUr6JHyssL1ccDweu8dRlT0mL5fLf6KE3R0qoWVZnfByaVFXOxxvDmiaEw6HQ8d+v0dVVS9S1zV83wNVr6wqjOZLNO1HlNsa5e4G2/qI00lx6qp+ndDvHkwzLYJ97uHX1zV+fCrx8z7Fl0qAy68gRE8cxy+ifok6srpHTTcp7rIRHi5XePgW4/dnC9+vr/BmMII+GmH0StQXUsI/a+VlZHpOQPkAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="配置服务器"\n        title=""\n        src="/static/fb7ba8d30c59840a7e74c2a0e9fdc787/39c09/configure-server.png"\n        srcset="/static/fb7ba8d30c59840a7e74c2a0e9fdc787/680fe/configure-server.png 156w,\n/static/fb7ba8d30c59840a7e74c2a0e9fdc787/17474/configure-server.png 312w,\n/static/fb7ba8d30c59840a7e74c2a0e9fdc787/39c09/configure-server.png 624w,\n/static/fb7ba8d30c59840a7e74c2a0e9fdc787/6d2da/configure-server.png 936w,\n/static/fb7ba8d30c59840a7e74c2a0e9fdc787/5a791/configure-server.png 1248w,\n/static/fb7ba8d30c59840a7e74c2a0e9fdc787/9cea8/configure-server.png 1278w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",s.createElement(a.p,null,"下载设置并上传到主机，将解压后的文件放置到存档目录："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">unzip</span> DST_Lolipop.zip\n<span class="token function">mv</span> MyDediServer /home/steam/.klei/DoNotStarveTogether/CustomSaveName\n\n<span class="token comment"># 如果使用了 root 用户解压，别忘了修改文件夹所有权</span>\n<span class="token comment"># chown -R steam /home/steam/.klei/DoNotStarveTogether/CustomSaveName</span></code></pre></div>'}}),"\n",s.createElement(a.p,null,"最后的最后，执行前面编写的启动脚本："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">/home/steam/scripts/start_dst.sh</code></pre></div>'}}),"\n",s.createElement(a.p,null,"在游戏大厅里搜索服务器，开始愉快地玩耍吧！"),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/dccabeadd2ce744948942e66220bb6c0/c2d13/search-server.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 53.84615384615385%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVUlEQVR42k2S23PSQBTG0elYaIu9ULTYAqXkQiAECIRLSLkVQm6UdKp2Rmd01Jc6fXa8PPVNH/XZP/bz7AbUh282e3bz2/Odc2L9XheBa+PSd+DZEyycKbzZBCHtlyR/PoUzHdPZBa4WLq6XPq4CBzehjU93L3D7LsTCHsK3xxhYFmLxjQcwShkM6gU0hDTqxTS0QgotOYOmlIGp5qCLT3msW8liqBfRKR0hHCn4/eM9ft2/wZfbEK/cGpLxh4jt7sRx0RLh9cuY90pwSJ6p/JVP8cV5ha/rmN2W0G8IMPUSLEMjJ+Ri0sHB7hYBtzcx0s8w78pwuhI8Aro9GS7fR7EoLvMzj2IMaJRPUKPMK2dHaCo5mORw/3ECsZ3EI4waRfj0ssthpehH8584vCNhToq+ZZhankDHUIUMdOUEVj2PAwZMJja5Zb8fARdWBZcDEtlk3wHFmdiDa6htiBg0CmirWVSKVGslC6txihSzvJdMYGpIK5DK6xVYq5ox0ArIxDJnwFlbRIea1SLbqvCMMoyA6T0C7ie36IKMJcECBjuPwGz9vznBCs7szowIaNZOUaYaVgna1XIE3EYstbdDnVU4ZDnUaByoa6NoZVpnyzOn9aIp8pqPDQHXsyr6egEjo4h5X4wsHxJ11hZ48Z2eBN9SCKzCZg0wZR6zOwImzQIC2r8NdIRDGS/dBn7ev8a3Ox/fPz/H148O2MTEnhzSEGsCamUB9YoIXaMZa6uoqRJJgFYuoizlIeSP0amL+HBjIZxqdK8Kz11gOqEZnLsYDcdIp1L4A1a8ZL1LfNxBAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="搜索服务器"\n        title=""\n        src="/static/dccabeadd2ce744948942e66220bb6c0/39c09/search-server.png"\n        srcset="/static/dccabeadd2ce744948942e66220bb6c0/680fe/search-server.png 156w,\n/static/dccabeadd2ce744948942e66220bb6c0/17474/search-server.png 312w,\n/static/dccabeadd2ce744948942e66220bb6c0/39c09/search-server.png 624w,\n/static/dccabeadd2ce744948942e66220bb6c0/6d2da/search-server.png 936w,\n/static/dccabeadd2ce744948942e66220bb6c0/5a791/search-server.png 1248w,\n/static/dccabeadd2ce744948942e66220bb6c0/c2d13/search-server.png 2560w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",s.createElement(a.h2,null,"饥荒联机版服务器运维"),"\n",s.createElement(a.h3,null,"添加模组"),"\n",s.createElement(a.p,null,"在饥荒联机版服务器添加并启用模组，需配置两部分内容。"),"\n",s.createElement(a.h4,null,"下载模组"),"\n",s.createElement(a.p,null,"第一部分是告诉服务器要下载哪些模组。编辑 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/steamapps/DST/mods/dedicated_server_mods_setup.lua</code>'}}),"，使用指令 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">ServerModSetup()</code>'}})," 或 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">ServerModCollectionSetup()</code>'}})," 添加需要下载的模组，例如："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="lua"><pre class="language-lua"><code class="language-lua"><span class="token comment">-- /home/steam/steamapps/DST/mods/dedicated_server_mods_setup.lua</span>\n<span class="token function">ServerModSetup</span><span class="token punctuation">(</span><span class="token string">"345692228"</span><span class="token punctuation">)</span>\n<span class="token function">ServerModCollectionSetup</span><span class="token punctuation">(</span><span class="token string">"3286974182"</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",s.createElement(a.p,null,"通过上面的配置，服务器将自动下载 Steam 创意工坊上的模组 ",s.createElement(a.a,{href:"https://steamcommunity.com/sharedfiles/filedetails/?id=345692228"},"#345692228"),"，以及模组集合 ",s.createElement(a.a,{href:"https://steamcommunity.com/sharedfiles/filedetails/?id=3286974182"},"#3286974182")," 中的所有模组。"),"\n",s.createElement(a.p,null,"由于每次执行 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steamcmd.sh</code>'}})," 命令检查游戏更新后会重置 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">dedicated_server_mods_setup.lua</code>'}}),"，建议手动备份该文件，这样的话未来增删模组时可以直接复用。例如："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">cp</span> dedicated_server_mods_setup.lua dedicated_server_mods_setup.temp.lua</code></pre></div>'}}),"\n",s.createElement(a.p,null,"优化前面我们编写的更新服务器脚本 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/scripts/update_dst.sh</code>'}}),"，在检查游戏更新之后还原备份文件："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /home/steam\n./steamcmd.sh +@ShutdownOnFailedCommand <span class="token number">1</span> +@NoPromptForPassword <span class="token number">1</span> +force_install_dir /home/steam/steamapps/DST +login anonymous +app_update <span class="token number">343050</span> validate +quit\n\n<span class="token comment"># 还原备份文件</span>\n<span class="token builtin class-name">cd</span> /home/steam/steamapps/DST/mods\n<span class="token function">cp</span> dedicated_server_mods_setup.temp.lua dedicated_server_mods_setup.lua\n\n<span class="token builtin class-name">cd</span> /home/steam/steamapps/DST/bin\n./dontstarve_dedicated_server_nullrenderer <span class="token parameter variable">-cluster</span> CustomSaveName <span class="token parameter variable">-only_update_server_mods</span></code></pre></div>'}}),"\n",s.createElement(a.h4,null,"启用模组"),"\n",s.createElement(a.p,null,"第二部分是告诉服务器要启用哪些模组。有两种配置方式，选择其一即可："),"\n",s.createElement(a.ol,null,"\n",s.createElement(a.li,null,s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/.klei/DoNotStarveTogether/CustomSaveName/Caves/modoverrides.lua</code>'}})," 用于管理洞穴世界模组的启用与配置；",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/.klei/DoNotStarveTogether/CustomSaveName/Master/modoverrides.lua</code>'}})," 用于管理地上世界模组的启用与配置。"),"\n",s.createElement(a.li,null,s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/steamapps/DST/mods/modsettings.lua</code>'}})," 用于管理模组的启用。需留意的是：1）本方式通常用于模组的开发调试；2）不能对模组进行详细设置，模组将始终使用默认配置；3）使用部分模组时可能会报错，此时请切换为第一种配置方法。"),"\n"),"\n",s.createElement(a.p,null,"笔者选用第一种配置方法，新建文件 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">modoverrides.lua</code>'}}),"，编写内容如下："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="lua"><pre class="language-lua"><code class="language-lua"><span class="token comment">-- modoverrides.lua</span>\n<span class="token keyword">return</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">[</span><span class="token string">"workshop-345692228"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> enabled <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">[</span><span class="token string">"workshop-xxxxxxxxx"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> enabled <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",s.createElement(a.p,null,"需注意的是，",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">modoverrides.lua</code>'}})," 不支持一键启用某个模组合集的所有模组，还是需要获取这些模组的编号并编写配置。"),"\n",s.createElement(a.p,null,"添加可执行权限并拷贝到对应目录："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">chmod</span> +x modoverrides.lua\n<span class="token function">cp</span> modoverrides.lua /home/steam/.klei/DoNotStarveTogether/CustomSaveName/Caves/\n<span class="token function">cp</span> modoverrides.lua /home/steam/.klei/DoNotStarveTogether/CustomSaveName/Master/</code></pre></div>'}}),"\n",s.createElement(a.p,null,"执行脚本 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/scripts/start_dst.sh</code>'}})," 重启服务器即可。"),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 624px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/c2081c1bc80a0c171185d416d53f1f30/c2d13/server-with-mods.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 53.84615384615385%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACMElEQVR42m2Sy44TMRBF+2Gnn3a/03lnEhE0ZNAMQSiakE4nAyMNrJBYg8SGDQghNFuExB+x4iNgx0/wGZeyLSIWLG7crqqcui7bWq/X2G4btG2Lptlht2tov0VDsd1OxRqtXWNq9vs9xU3dYd/i6tDi+c1TXF9f4XKzgWVbFnxuI+g48FwL3LFQCoY8cuAzG4zyPclQU4zTd0R1dcL1XtULz0ZBeRm6sChvceYilxHKNNYqkhizfooOxQe9FGeLHi6WYzxYjrBc1Oh3JTzuYkJrEgfIkwiJCCBjHx3OYDHXQUaBXIbUyWhQxrrb19tn+PX9E358e0/rR/z++RlfPjzRuTIJ4HscgcdIHKHPwRwHlks/KQGLJNRQpUFhgIfNHbx7tTnq9m2Ldj3TuUL6UKdT6pBjn8BHYHYERrRGGJYCjm2bmfxHjmNrYCYD9Kg2I7dRQA4ZARl1MEA1RwMcaKClZf8DVk1UjBGwJGCVCyxOupgOMoiwo92aGdIx/8KUxl0B1zGgMo9wOu/i7rxCkYU61uGOdqggalzKqYw8KJalbsa4i1FlAiVJOSzTACHN5fFqgjcvH+L1ixUuz0cIaF4VHTGlW1W3nJLiwKNn4xmHnKkZ+jQ/00mtZp4BKnId0+0J36X359IfOQaVoMb0Ggg67mcY1hJDekJ9imuHQkhUZY6yyFFpFai7Je0LFGpfFTqX5xlq+p5NevQ+C0xHNR5dzHF+b4rV/ROcnU4ghcQf/6wWxPOPREEAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="服务器模组"\n        title=""\n        src="/static/c2081c1bc80a0c171185d416d53f1f30/39c09/server-with-mods.png"\n        srcset="/static/c2081c1bc80a0c171185d416d53f1f30/680fe/server-with-mods.png 156w,\n/static/c2081c1bc80a0c171185d416d53f1f30/17474/server-with-mods.png 312w,\n/static/c2081c1bc80a0c171185d416d53f1f30/39c09/server-with-mods.png 624w,\n/static/c2081c1bc80a0c171185d416d53f1f30/6d2da/server-with-mods.png 936w,\n/static/c2081c1bc80a0c171185d416d53f1f30/5a791/server-with-mods.png 1248w,\n/static/c2081c1bc80a0c171185d416d53f1f30/c2d13/server-with-mods.png 2560w"\n        sizes="(max-width: 624px) 100vw, 624px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",s.createElement(a.h3,null,"自定义世界"),"\n",s.createElement(a.p,null,"笔者建议在电脑上手动启动一个自定义好的世界，再将生成的配置文件 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">worldgenoverride.lua</code>'}})," 和 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">leveldataoverride.lua</code>'}})," 分别粘贴到服务器的对应文件夹里。地上世界和洞穴世界的配置文件有所区别，不要搞混喽："),"\n",s.createElement(a.ul,null,"\n",s.createElement(a.li,null,s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/.klei/DoNotStarveTogether/CustomSaveName/Caves/leveldataoverride.lua</code>'}})),"\n",s.createElement(a.li,null,s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/.klei/DoNotStarveTogether/CustomSaveName/Caves/worldgenoverride.lua</code>'}})),"\n",s.createElement(a.li,null,s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/.klei/DoNotStarveTogether/CustomSaveName/Master/leveldataoverride.lua</code>'}})),"\n",s.createElement(a.li,null,s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/.klei/DoNotStarveTogether/CustomSaveName/Master/worldgenoverride.lua</code>'}})),"\n"),"\n",s.createElement(a.p,null,"其中，",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">worldgenoverride.lua</code>'}})," 是世界生成规则，修改后需要重新生成世界才能生效。"),"\n",s.createElement(a.h3,null,"进一步配置服务器"),"\n",s.createElement(a.p,null,"之前步骤中下载的基本配置已足够支持正常游玩。如果还想要更深度的定制，可以参考",s.createElement(a.a,{href:"https://steamcommunity.com/sharedfiles/filedetails/?id=1616647350"},"此文档"),"，按需修改以下三个文件："),"\n",s.createElement(a.ul,null,"\n",s.createElement(a.li,null,s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/.klei/DoNotStarveTogether/CustomSaveName/cluster.ini</code>'}})),"\n",s.createElement(a.li,null,s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/.klei/DoNotStarveTogether/CustomSaveName/Caves/server.ini</code>'}})),"\n",s.createElement(a.li,null,s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/home/steam/.klei/DoNotStarveTogether/CustomSaveName/Master/server.ini</code>'}})),"\n"),"\n",s.createElement(a.h3,null,"定时重启并更新服务器"),"\n",s.createElement(a.p,null,"可以使用 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">crontab</code>'}})," 命令实现，但默认情况下，我们新建的 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steam</code>'}})," 用户是没有使用该命令的权限的，需要首先切到管理员用户添加权限："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">echo</span> steam <span class="token operator">>></span> /etc/cron.allow</code></pre></div>'}}),"\n",s.createElement(a.p,null,"切回 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">steam</code>'}})," 用户，编辑计划任务 ",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">crontab -e</code>'}}),"，添加如下内容："),"\n",s.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="plaintext"><pre class="language-plaintext"><code class="language-plaintext">0 6 * * * /home/steam/scripts/start_dst.sh</code></pre></div>'}}),"\n",s.createElement(a.p,null,"上面的配置表示，在系统时间每天凌晨 6 点整，自动重启并更新饥荒联机版服务器。"))}var c=function(e){void 0===e&&(e={});const{wrapper:a}=Object.assign({},(0,t.R)(),e.components);return a?s.createElement(a,e,s.createElement(l,e)):l(e)},r=n(197),o=n(4353),d=n.n(o),p=n(4810),m=n(6947),i=n(4017),g=n(1042),u=n(1038);const h={a:e=>{let{href:a="",children:n}=e;const t=!(null!=a&&a.startsWith("#")),l=t?a:`#${encodeURIComponent(a.slice(1))}`;return s.createElement("a",{href:l,target:t?"_blank":void 0,rel:"noreferrer"},n)},img:e=>{const{alt:a="The author is too lazy to give an alt",src:n,...t}=e;return s.createElement("a",{href:n,"data-fancybox":"gallery","data-caption":a},s.createElement("img",Object.assign({src:n,alt:a},t)))},Card:m.A,Link:p.N_},b=e=>{let{children:a,data:n}=e;const{mdx:{frontmatter:{title:l,date:c,updated:o,categories:p,tags:m,timeliness:g=!0}}}=n,b=s.useRef(null),v=d()(c),E=o?d()(o):v,_=d()().diff(E,"days");return s.useEffect((()=>{var e;const a=null===(e=b.current)||void 0===e?void 0:e.querySelectorAll("a.gatsby-resp-image-link");return null==a||a.forEach((e=>{const a=e.children.item(1);e.setAttribute("data-fancybox","gallery"),e.setAttribute("data-caption",a.alt)})),r.lX.bind("[data-fancybox]"),()=>r.lX.unbind("[data-fancybox]")}),[]),s.createElement("div",{className:"mx-auto flex max-w-xl flex-col gap-y-12"},s.createElement("div",{className:"flex flex-col gap-4"},(null==p?void 0:p.length)&&s.createElement(i.A,{name:p[0],className:"item-selectable"}),s.createElement("h1",{className:"text-3xl font-bold"},l),s.createElement("div",{className:"item-secondary flex flex-col gap-2 lg:flex-row"},c&&s.createElement("span",{title:`首次发布于：${v.toString()}\n最后更新于：${E.toString()}`},v.format("MM 月 DD 日 YYYY 年")),(null==m?void 0:m.length)&&s.createElement("div",{className:"flex flex-1 flex-wrap gap-2 lg:before:content-['•']"},m.map((e=>s.createElement(u.A,{key:e,name:e,className:"item-secondary item-selectable"})))))),s.createElement("article",{ref:b,className:"heti post-entry"},g&&_>365&&s.createElement("blockquote",{className:"border-l-4 border-orange-400"},"这是一篇",s.createElement("strong",null,"最后更新于 ",_," 天前"),"的博客，内容可能随着时间的推移而变得不再适用，建议您仔细评估信息的有效性。"),s.createElement(t.x,{components:h},a)))},v=e=>{let{data:a}=e;return s.createElement(g.A,{title:String(a.mdx.frontmatter.title)})};function E(e){return s.createElement(b,e,s.createElement(c,e))}}}]);
//# sourceMappingURL=component---src-templates-post-tsx-content-file-path-blog-posts-run-dont-starve-server-mdx-b335c85d02f3209945dd.js.map